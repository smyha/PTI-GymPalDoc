<!DOCTYPE html>
<html>
<head>
<title>GYMPAL.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="gympal-fitness-platform-with-social-ai-and-orchestration">GymPal: Fitness Platform with Social, AI and Orchestration</h1>
<h2 id="%F0%9F%93%8B-table-of-contents">ğŸ“‹ Table of Contents</h2>
<ul>
<li><a href="#gympal-fitness-platform-with-social-ai-and-orchestration">GymPal: Fitness Platform with Social, AI and Orchestration</a>
<ul>
<li><a href="#-table-of-contents">ğŸ“‹ Table of Contents</a></li>
<li><a href="#1-project-vision-and-scope-%EF%B8%8F">1. Project Vision and Scope ğŸ—ï¸</a>
<ul>
<li><a href="#vision">Vision</a></li>
<li><a href="#key-objectives">Key objectives</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#main-use-cases">Main Use Cases</a></li>
</ul>
</li>
<li><a href="#2-proposed-technology-stack-">2. Proposed Technology Stack ğŸ’»</a>
<ul>
<li><a href="#final-decision">Final Decision</a></li>
<li><a href="#frontend">Frontend</a></li>
<li><a href="#backend">Backend</a></li>
<li><a href="#backend-architecture">Backend Architecture</a>
<ul>
<li><a href="#backend-project-structure">Backend Project Structure</a></li>
<li><a href="#openapi-documentation-status">OpenAPI Documentation Status</a></li>
<li><a href="#database-migrations">Database Migrations</a></li>
</ul>
</li>
<li><a href="#1-user-personal-information"><strong>1. User Personal Information</strong></a>
<ul>
<li><a href="#get-apiv1userspersonalinfo"><strong>GET /api/v1/users/personal/info</strong></a></li>
<li><a href="#put-apiv1userspersonalinfo"><strong>PUT /api/v1/users/personal/info</strong></a></li>
<li><a href="#get-apiv1userspersonalobjectives"><strong>GET /api/v1/users/personal/objectives</strong></a></li>
<li><a href="#put-apiv1userspersonalobjectives"><strong>PUT /api/v1/users/personal/objectives</strong></a></li>
<li><a href="#get-apiv1userspersonaldietary-preferences"><strong>GET /api/v1/users/personal/dietary-preferences</strong></a></li>
<li><a href="#put-apiv1userspersonaldietary-preferences"><strong>PUT /api/v1/users/personal/dietary-preferences</strong></a></li>
</ul>
</li>
<li><a href="#2-custom-routines"><strong>2. Custom Routines</strong></a>
<ul>
<li><a href="#get-apiv1workoutsroutines"><strong>GET /api/v1/workouts/routines</strong></a></li>
<li><a href="#post-apiv1workoutsroutines"><strong>POST /api/v1/workouts/routines</strong></a></li>
<li><a href="#get-apiv1workoutsroutinessearch"><strong>GET /api/v1/workouts/routines/search</strong></a></li>
<li><a href="#post-apiv1workoutsroutinesroutineidshare"><strong>POST /api/v1/workouts/routines/:routineId/share</strong></a></li>
</ul>
</li>
<li><a href="#3-advanced-social-posts"><strong>3. Advanced Social Posts</strong></a>
<ul>
<li><a href="#get-apiv1socialposts"><strong>GET /api/v1/social/posts</strong></a></li>
<li><a href="#post-apiv1socialposts"><strong>POST /api/v1/social/posts</strong></a></li>
<li><a href="#post-apiv1socialpostspostidshare"><strong>POST /api/v1/social/posts/:postId/share</strong></a></li>
<li><a href="#post-apiv1socialpostspostidrepost"><strong>POST /api/v1/social/posts/:postId/repost</strong></a></li>
<li><a href="#get-apiv1socialpoststrending"><strong>GET /api/v1/social/posts/trending</strong></a></li>
<li><a href="#get-apiv1socialpostssearch"><strong>GET /api/v1/social/posts/search</strong></a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li><a href="#infrastructure-and-devops">Infrastructure and DevOps</a></li>
<li><a href="#integrations">Integrations</a>
<ul>
<li><a href="#api-framework-decision">API Framework Decision</a></li>
</ul>
</li>
<li><a href="#data-architecture">Data Architecture</a></li>
<li><a href="#data-architecture-simplified-version">Data Architecture (Simplified Version)</a></li>
<li><a href="#database-schema">Database Schema</a>
<ul>
<li><a href="#main-tables">Main Tables</a></li>
<li><a href="#row-level-security-rls">Row Level Security (RLS)</a></li>
<li><a href="#indexes-and-optimization">Indexes and Optimization</a></li>
<li><a href="#database-schema-diagrams">Database Schema Diagrams</a>
<ul>
<li><a href="#main-er-diagram---core-entities">Main ER Diagram - Core Entities</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#principal-er-diagram-simplified">Principal ER Diagram (Simplified)</a>
- <a href="#social-relationships-diagram">Social Relationships Diagram</a>
- <a href="#workouts-and-exercises-diagram">Workouts and Exercises Diagram</a>
- <a href="#user-statistics-diagram">User Statistics Diagram</a>
- <a href="#indexes-and-performance-diagram">Indexes and Performance Diagram</a>
- <a href="#row-level-security-rls-diagram">Row Level Security (RLS) Diagram</a>
<ul>
<li><a href="#3-software-architecture-">3. Software Architecture ğŸ”„</a>
<ul>
<li><a href="#capability-map">Capability Map</a></li>
<li><a href="#logical-diagram-high-level">Logical Diagram (High Level)</a></li>
<li><a href="#frontend-architecture-feature-slice">Frontend Architecture (Feature-Slice)</a></li>
<li><a href="#frontend-directory-structure">Frontend Directory Structure</a></li>
<li><a href="#microservices-communication-async--sync">Microservices Communication (async + sync)</a></li>
<li><a href="#user-state">User State</a></li>
<li><a href="#ai-chatbot-state">AI Chatbot State</a></li>
<li><a href="#client-server-communication-login--data-fetch">Client-Server Communication (Login + Data Fetch)</a></li>
<li><a href="#backend-frontend-communication-ssrcsr">Backend-Frontend Communication (SSR/CSR)</a></li>
<li><a href="#realtime-via-websocket-notifications">Realtime via WebSocket (notifications)</a></li>
<li><a href="#api-request-lifecycle">API Request Lifecycle</a></li>
<li><a href="#session-lifecycle-tokens">Session Lifecycle (tokens)</a></li>
<li><a href="#backend-architecture-layers">Backend Architecture (Layers)</a></li>
<li><a href="#detailed-service-communication-flow-with-queues">Detailed Service Communication Flow (with queues)</a></li>
<li><a href="#ai-recommendation-system-flow">AI Recommendation System Flow</a></li>
<li><a href="#auth-security-validation-and-authentication-flow">AUTH Security Validation and Authentication Flow</a></li>
<li><a href="#real-time-events-and-websocket-communication-flow">Real-time Events and WebSocket Communication Flow</a></li>
<li><a href="#admin-management-and-monitoring-flow">Admin Management and Monitoring Flow</a></li>
<li><a href="#scalability-and-load-balancing-flow">Scalability and Load Balancing Flow</a></li>
<li><a href="#microservices-architecture">Microservices Architecture</a></li>
<li><a href="#complete-data-flow">Complete Data Flow</a></li>
<li><a href="#schedule-and-calendar-flow">Schedule and Calendar Flow</a></li>
<li><a href="#calorie-tracker-flow">Calorie Tracker Flow</a></li>
<li><a href="#weekly-calendar-view">Weekly Calendar View</a></li>
<li><a href="#calorie-tracker-dashboard">Calorie Tracker Dashboard</a>
<ul>
<li><a href="#user-journey-diagram">User Journey Diagram</a></li>
</ul>
</li>
<li><a href="#detailed-typescript-types">Detailed TypeScript Types</a></li>
<li><a href="#domain-models-typescript">Domain Models (TypeScript)</a></li>
<li><a href="#repositories-supabasepostgres">Repositories (Supabase/Postgres)</a></li>
<li><a href="#services-bussiness">Services (Bussiness)</a></li>
<li><a href="#controllers-hono">Controllers (Hono)</a></li>
<li><a href="#ai-orchestration-n8ndify">AI Orchestration (n8n/Dify)</a></li>
</ul>
</li>
<li><a href="#33-detailed-backend-structure">3.3 Detailed Backend Structure</a>
<ul>
<li><a href="#configuration-config">Configuration (config/)</a>
<ul>
<li><a href="#envts---gesti%C3%B3n-de-variables-de-entorno">env.ts - GestiÃ³n de Variables de Entorno</a></li>
</ul>
</li>
<li><a href="#documentation-doc">Documentation (doc/)</a>
<ul>
<li><a href="#schemasts---api-documentation-schemas">schemas.ts - API Documentation Schemas</a></li>
</ul>
</li>
<li><a href="#libraries-lib">Libraries (lib/)</a>
<ul>
<li><a href="#dbts---database-client">db.ts - Database Client</a></li>
<li><a href="#mailerts---email-service">mailer.ts - Email Service</a></li>
</ul>
</li>
<li><a href="#controllers-srchandler">Controllers (src/handler/)</a>
<ul>
<li><a href="#authhandlerts---authentication-controllers">auth.handler.ts - Authentication Controllers</a></li>
<li><a href="#userhandlerts---user-controllers">user.handler.ts - User Controllers</a></li>
</ul>
</li>
<li><a href="#routes-srcroutes">Routes (src/routes/)</a>
<ul>
<li><a href="#authroutests---authentication-routes">auth.routes.ts - Authentication Routes</a></li>
<li><a href="#userroutests---user-routes">user.routes.ts - User Routes</a></li>
</ul>
</li>
<li><a href="#ai-and-recommendations">AI and Recommendations</a></li>
</ul>
</li>
<li><a href="#41-frontend-api-client">4.1 Frontend API Client</a></li>
<li><a href="#43-testing-strategy">4.3 Testing Strategy</a>
<ul>
<li><a href="#testing-pyramid">Testing Pyramid</a></li>
<li><a href="#layered-testing-strategy">Layered Testing Strategy</a></li>
<li><a href="#testing-flow-in-cicd">Testing Flow in CI/CD</a></li>
<li><a href="#testing-coverage">Testing Coverage</a></li>
<li><a href="#test-examples">Test Examples</a></li>
</ul>
</li>
<li><a href="#5-ai-integration-detailed">5. AI Integration (Detailed)</a>
<ul>
<li><a href="#dify-client">Dify Client</a></li>
<li><a href="#context-builder">Context Builder</a></li>
<li><a href="#frontend-chat-component">Frontend Chat Component</a></li>
</ul>
</li>
<li><a href="#6-security-and-compliance-">6. Security and Compliance ğŸ”</a>
<ul>
<li><a href="#security-principles">Security Principles</a></li>
<li><a href="#authentication-and-authorization">Authentication and Authorization</a></li>
<li><a href="#auth-middleware-implementation">Auth Middleware Implementation</a></li>
<li><a href="#rate-limiting">Rate Limiting</a></li>
<li><a href="#input-validation">Input Validation</a></li>
<li><a href="#security-headers">Security Headers</a></li>
<li><a href="#cors-configuration">CORS Configuration</a></li>
<li><a href="#additional-security-measures">Additional Security Measures</a></li>
</ul>
</li>
<li><a href="#7-devops-cicd-and-gitops-">7. DevOps, CI/CD and GitOps ğŸš€</a>
<ul>
<li><a href="#infrastructure-architecture">Infrastructure Architecture</a></li>
<li><a href="#cicd-pipeline">CI/CD Pipeline</a></li>
<li><a href="#cd-pipeline">CD Pipeline</a></li>
<li><a href="#kubernetes-manifests">Kubernetes Manifests</a></li>
<li><a href="#kustomization">Kustomization</a></li>
<li><a href="#docker-compose-local-development">Docker Compose (Local Development)</a></li>
<li><a href="#monitoring">Monitoring</a></li>
</ul>
</li>
<li><a href="#8-monitoring-and-observability-">8. Monitoring and Observability ğŸ“ˆ</a></li>
<li><a href="#9-work-plan-and-team-organization-">9. Work Plan and Team Organization ğŸ‘¥</a>
<ul>
<li><a href="#roles">Roles</a></li>
<li><a href="#roadmap-october---december-2025">Roadmap (October - December 2025)</a>
<ul>
<li><a href="#phase-1-initial-setup-7-oct---3-nov">Phase 1: Initial Setup (7 Oct - 3 Nov)</a></li>
<li><a href="#phase-2-backend-core-4-nov---24-nov">Phase 2: Backend Core (4 Nov - 24 Nov)</a></li>
<li><a href="#phase-3-ai-integration-25-nov---8-dec">Phase 3: AI Integration (25 Nov - 8 Dec)</a></li>
<li><a href="#phase-4-devops--scale-9-dec---19-dec">Phase 4: DevOps &amp; Scale (9 Dec - 19 Dec)</a></li>
</ul>
</li>
<li><a href="#delivery-schedule">Delivery Schedule</a></li>
</ul>
</li>
<li><a href="#10-methodology-standards-and-quality-">10. Methodology, Standards and Quality ğŸ§­</a></li>
<li><a href="#11-communication-flows-and-orchestration-">11. Communication Flows and Orchestration ğŸ”„</a>
<ul>
<li><a href="#diagram-registration-and-authentication-flow">Diagram: Registration and Authentication Flow</a></li>
<li><a href="#diagram-workout-routine-generation-and-tracking">Diagram: Workout Routine Generation and Tracking</a></li>
<li><a href="#diagram-social-interaction-follow-notify-feed">Diagram: Social Interaction (follow, notify, feed)</a></li>
<li><a href="#diagram-social-post-lifecycle">Diagram: Social Post Lifecycle</a></li>
<li><a href="#n8n-flows-examples">n8n Flows (examples)</a>
<ul>
<li><a href="#1-workflow-telegram-chatbot">1. Workflow: Telegram Chatbot</a></li>
<li><a href="#2-workflow-daily-reminders">2. Workflow: Daily Reminders</a></li>
<li><a href="#3-workflow-content-moderation">3. Workflow: Content Moderation</a></li>
<li><a href="#4-workflow-ai-plan-generation">4. Workflow: AI Plan Generation</a></li>
<li><a href="#5-workflow-calorie-tracking-notifications">5. Workflow: Calorie Tracking Notifications</a></li>
<li><a href="#6-workflow-social-engagement">6. Workflow: Social Engagement</a></li>
</ul>
</li>
<li><a href="#sequence-web-ai-chat">Sequence (Web AI Chat)</a></li>
<li><a href="#sequence-workout-plan-generation">Sequence (workout plan generation)</a></li>
<li><a href="#sequence-social-post-and-notification">Sequence (social post and notification)</a></li>
<li><a href="#social-interactions-post-feed-like-comment">Social Interactions: Post, Feed, Like, Comment</a></li>
<li><a href="#basic-moderation-reports">Basic Moderation (reports)</a></li>
<li><a href="#user-interaction-diagrams-mermaid">User Interaction Diagrams (Mermaid)</a></li>
<li><a href="#publish-post">Publish Post</a></li>
<li><a href="#view-feed">View Feed</a></li>
<li><a href="#like-and-comment">Like and Comment</a></li>
<li><a href="#follow-user">Follow User</a></li>
<li><a href="#content-moderation">Content Moderation</a></li>
<li><a href="#backend-class-diagram-social">Backend Class Diagram (Social)</a></li>
<li><a href="#frontend-class-diagram-social">Frontend Class Diagram (Social)</a></li>
<li><a href="#er-training-data-flow">ER: Training Data Flow</a></li>
<li><a href="#er-nutrition-data-flow">ER: Nutrition Data Flow</a></li>
<li><a href="#er-social-data-flow">ER: Social Data Flow</a></li>
<li><a href="#er-ai-recommendations-data-flow">ER: AI Recommendations Data Flow</a></li>
<li><a href="#er-notifications-data-flow">ER: Notifications Data Flow</a></li>
<li><a href="#dependencies-and-health-checks">Dependencies and Health Checks</a></li>
<li><a href="#threat-model-and-security">Threat Model and Security</a></li>
<li><a href="#monitoring--observability-stack">Monitoring &amp; Observability Stack</a></li>
</ul>
</li>
<li><a href="#12-ai-integration-chatbot-and-recommender-">12. AI Integration (Chatbot and Recommender) ğŸ¤–</a>
<ul>
<li><a href="#ai-architecture">AI Architecture</a></li>
<li><a href="#ai-chatbot-flow">AI Chatbot Flow</a></li>
<li><a href="#recommendation-system">Recommendation System</a></li>
<li><a href="#ai-evaluation-and-metrics">AI Evaluation and Metrics</a></li>
</ul>
</li>
<li><a href="#13-startup-guide-%EF%B8%8F">13. Startup Guide âš™ï¸</a>
<ul>
<li><a href="#development-flow">Development Flow</a></li>
<li><a href="#development-urls">Development URLs</a>
<ul>
<li><a href="#backend-api-port-3000"><strong>Backend API (Port 3000)</strong></a></li>
<li><a href="#local-supabase-ports-54321-54329"><strong>Local Supabase (Ports 54321-54329)</strong></a></li>
<li><a href="#specific-api-endpoints"><strong>Specific API Endpoints</strong></a></li>
<li><a href="#testing-and-development"><strong>Testing and Development</strong></a></li>
</ul>
</li>
<li><a href="#actual-backend-project-structure">Actual Backend Project Structure</a></li>
<li><a href="#actual-frontend-project-structure">Actual Frontend Project Structure</a></li>
<li><a href="#module-structure-details">Module Structure Details</a>
<ul>
<li><a href="#-frontend---nextjs-14-architecture"><strong>ğŸ“ Frontend - Next.js 14 Architecture</strong></a></li>
<li><a href="#-backend---business-modules"><strong>ğŸ“ Backend - Business Modules</strong></a></li>
<li><a href="#-srcroutes---route-handlers"><strong>ğŸ“ src/routes/ - Route Handlers</strong></a></li>
<li><a href="#-srcshared---shared-utilities"><strong>ğŸ“ src/shared/ - Shared Utilities</strong></a></li>
<li><a href="#-supabase---database"><strong>ğŸ“ supabase/ - Database</strong></a></li>
<li><a href="#automation-scripts"><strong>Automation Scripts</strong></a></li>
</ul>
</li>
<li><a href="#available-development-commands">Available Development Commands</a></li>
<li><a href="#cicd-pipeline-1">CI/CD Pipeline</a>
<ul>
<li><a href="#main-pipeline---push-to-main"><strong>Main Pipeline - Push to Main</strong></a></li>
<li><a href="#detailed-testing-pipeline"><strong>Detailed Testing Pipeline</strong></a></li>
<li><a href="#deploy-pipeline-with-argocd"><strong>Deploy Pipeline with ArgoCD</strong></a></li>
<li><a href="#code-quality-pipeline"><strong>Code Quality Pipeline</strong></a></li>
<li><a href="#monitoring--notifications-pipeline"><strong>Monitoring &amp; Notifications Pipeline</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#14-kpis-and-success-metrics-">14. KPIs and Success Metrics ğŸ¯</a>
<ul>
<li><a href="#metrics-dashboard">Metrics Dashboard</a></li>
</ul>
</li>
<li><a href="#15-appendices-">15. Appendices ğŸ“</a>
<ul>
<li><a href="#blockchain-integration-optional">Blockchain Integration (Optional)</a></li>
<li><a href="#technology-roadmap">Technology Roadmap</a></li>
<li><a href="#project-gantt-chart">Project Gantt Chart</a></li>
<li><a href="#roles-gantt-chart">Roles Gantt Chart</a></li>
</ul>
</li>
<li><a href="#16-to-do-list-by-roles-">16. TO-DO List by Roles ğŸ‘¥</a>
<ul>
<li><a href="#-frontend-developer">ğŸ¨ Frontend Developer</a></li>
<li><a href="#%EF%B8%8F-backend-developer">âš™ï¸ Backend Developer</a></li>
<li><a href="#-devopssre-engineer">ğŸš€ DevOps/SRE Engineer</a></li>
<li><a href="#-aiintegrations-developer">ğŸ¤– AI/Integrations Developer</a></li>
<li><a href="#-productqa-engineer">ğŸ“‹ Product/QA Engineer</a></li>
</ul>
</li>
<li><a href="#-weekly-objectives">ğŸ¯ Weekly Objectives</a>
<ul>
<li><a href="#week-1-7-13-oct">Week 1 (7-13 Oct)</a></li>
<li><a href="#week-2-14-20-oct">Week 2 (14-20 Oct)</a></li>
<li><a href="#week-3-21-27-oct">Week 3 (21-27 Oct)</a></li>
<li><a href="#week-4-28-oct---3-nov">Week 4 (28 Oct - 3 Nov)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-project-vision-and-scope-%F0%9F%8F%97%EF%B8%8F">1. Project Vision and Scope ğŸ—ï¸</h2>
<h3 id="vision">Vision</h3>
<p>GymPal is a web application (with desktop option via Electron) for managing personalized training and nutrition. Users will be able to generate routines and diets adapted to their physique, goals and pace; share posts with routines, achievements and recommendations; interact with other users through ratings and comments; and receive help from an AI chatbot and an active recommendation engine.</p>
<h3 id="key-objectives">Key objectives</h3>
<ul>
<li><strong>Intelligent generation</strong> of personalized routines and diets.</li>
<li><strong>Fitness social network</strong>: posts, comments, likes and profile following.</li>
<li><strong>AI Chatbot</strong> in the web by session and as automated chatbot (n8n) in Telegram/WhatsApp/Gmail.</li>
<li><strong>Recommendation system</strong> (Dify AI) for users, routines, diets and content.</li>
<li><strong>Scalable and secure architecture</strong> with microservices, CI/CD and observability.</li>
</ul>
<h3 id="requirements">Requirements</h3>
<ul>
<li>Client-server; REST APIs; microservice patterns; Docker containers; Kubernetes.</li>
<li>Security: OAuth2/OIDC, JWT, HTTPS, Policies, TLS Secrets.</li>
<li>External API integration and workflow orchestration with n8n.</li>
<li>GitOps with ArgoCD; monitoring with Prometheus + Grafana + Promtail.</li>
<li>Transactional email with Proton Mail; complete technical documentation.</li>
<li>AI Integration: Chatbot and recommendations with Dify AI; LLM for planned generation.</li>
<li>Blockchain service (optional) for achievement certification or evidence sealing.</li>
</ul>
<h3 id="main-use-cases">Main Use Cases</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Fitness User"
    UC1[Register and configure profile]
    UC2[Generate personalized training plan]
    UC3[Track progress and record logs]
    UC4[Generate nutritional plan]
    UC5[Interact with AI chatbot]
  end
  
  subgraph "Social Network"
    UC6[Post achievements and routines]
    UC7[Follow other users]
    UC8[Comment and like]
    UC9[Receive notifications]
  end
  
  subgraph "Administration"
    UC10[Moderate content]
    UC11[Manage users]
    UC12[Monitor metrics]
  end
  
  subgraph "AI and Recommendations"
    UC13[Receive personalized recommendations]
    UC14[Contextual chat with AI]
    UC15[Automatic plan generation]
  end
</div></code></pre>
<hr>
<h2 id="2-proposed-technology-stack-%F0%9F%92%BB">2. Proposed Technology Stack ğŸ’»</h2>
<h3 id="final-decision">Final Decision</h3>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Technology</th>
<th>Justification</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Frontend</strong></td>
<td>Next.js 14 (App Router) + Zustand</td>
<td>SSR, SEO, File-based routing</td>
</tr>
<tr>
<td><strong>UI Components</strong></td>
<td>shadcn/ui + Tailwind</td>
<td>Modern, accessible, customizable</td>
</tr>
<tr>
<td><strong>Backend</strong></td>
<td>Hono + TypeScript</td>
<td>10x faster than Express, TS-first</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>Supabase (Postgres)</td>
<td>Complete BaaS, integrated Auth</td>
</tr>
<tr>
<td><strong>Auth</strong></td>
<td>Supabase Auth (OAuth2)</td>
<td>OAuth2/OIDC out-of-the-box</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>Supabase Storage</td>
<td>S3-compatible, integrated with Auth</td>
</tr>
<tr>
<td><strong>AI Platform</strong></td>
<td>Dify AI</td>
<td>LLM orchestration, prompts management</td>
</tr>
<tr>
<td><strong>Containerization</strong></td>
<td>Docker</td>
<td>De facto standard</td>
</tr>
<tr>
<td><strong>Orchestration</strong></td>
<td>Kubernetes (kind local)</td>
<td>Academic requirement</td>
</tr>
<tr>
<td><strong>GitOps</strong></td>
<td>ArgoCD</td>
<td>Declarative deployments</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Prometheus + Grafana</td>
<td>Metrics and dashboards</td>
</tr>
<tr>
<td><strong>Logs</strong></td>
<td>Loki + Promtail</td>
<td>Log aggregation</td>
</tr>
<tr>
<td><strong>Package Manager</strong></td>
<td>npm/yarn</td>
<td>Dependency management</td>
</tr>
<tr>
<td><strong>Testing</strong></td>
<td>Vitest + Supertest</td>
<td>Modern and fast testing</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Zod</td>
<td>Runtime type-safe validation</td>
</tr>
</tbody>
</table>
<h3 id="frontend">Frontend</h3>
<ul>
<li><strong>Next.js 14</strong> (App Router) + <strong>TypeScript</strong>.</li>
<li><strong>Tailwind CSS</strong> + <strong>shadcn/ui</strong> for modern and accessible UI.</li>
<li><strong>Auth</strong> with OAuth2/OIDC via Supabase Auth or Auth.js.</li>
<li><strong>State</strong>: React Query/Server Actions, Zustand where appropriate.</li>
<li><strong>SSR/ISR</strong> for SEO and performance.</li>
</ul>
<h3 id="backend">Backend</h3>
<ul>
<li><strong>Node.js + TypeScript</strong> with <strong>Hono</strong> for REST APIs and WebSocket.</li>
<li><strong>Supabase</strong> (PostgreSQL, Auth, Storage, Realtime) as backend accelerator.</li>
<li><strong>n8n</strong> for workflow orchestration (chatbots in Telegram/WhatsApp, emails, cron).</li>
<li><strong>Dify AI</strong> for recommender and AI flows; integration via API.</li>
<li><strong>Proton Mail</strong> (or SMTP compatible) for emails.</li>
</ul>
<h3 id="backend-architecture">Backend Architecture</h3>
<h4 id="backend-project-structure">Backend Project Structure</h4>
<pre class="hljs"><code><div>backend/
â”œâ”€â”€ config/           # Environment variables configuration
â”‚   â””â”€â”€ env.ts        # Variable validation with Zod
â”œâ”€â”€ doc/             # API documentation schemas
â”‚   â””â”€â”€ schemas.ts    # Zod schemas for validation
â”œâ”€â”€ lib/             # Shared libraries
â”‚   â”œâ”€â”€ db.ts        # Supabase client with helpers
â”‚   â”œâ”€â”€ auth.ts      # JWT authentication utilities
â”‚   â”œâ”€â”€ mailer.ts    # Email service with Nodemailer
â”‚   â””â”€â”€ types.ts     # Database types
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/      # ğŸ¯ Professional Controllers (Handlers)
â”‚   â”‚   â”œâ”€â”€ auth.handler.ts          # Authentication with OpenAPI docs
â”‚   â”‚   â”œâ”€â”€ user.handler.ts          # User management with validation
â”‚   â”‚   â”œâ”€â”€ workout.handler.ts       # Workouts and exercises
â”‚   â”‚   â”œâ”€â”€ social.handler.ts        # Social features
â”‚   â”‚   â”œâ”€â”€ personal.handler.ts      # User personal information
â”‚   â”‚   â”œâ”€â”€ routines.handler.ts      # Custom routines
â”‚   â”‚   â”œâ”€â”€ posts.handler.ts         # Advanced social posts
â”‚   â”‚   â”œâ”€â”€ dashboard.handler.ts     # Analytics and statistics
â”‚   â”‚   â””â”€â”€ settings.handler.ts      # User configuration
â”‚   â”œâ”€â”€ modules/     # ğŸ“¦ Functionality Modules (Services)
â”‚   â”‚   â”œâ”€â”€ auth/    # Complete authentication module
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts    # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.types.ts      # Specific types
â”‚   â”‚   â”‚   â””â”€â”€ auth.middleware.ts # Specific middleware
â”‚   â”‚   â”œâ”€â”€ users/   # Complete users module
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts    # User logic
â”‚   â”‚   â”‚   â”œâ”€â”€ user.types.ts      # User types
â”‚   â”‚   â”‚   â””â”€â”€ user.middleware.ts # User validation
â”‚   â”‚   â”œâ”€â”€ workouts/ # Complete workouts module
â”‚   â”‚   â”‚   â”œâ”€â”€ workout.service.ts    # Workout logic
â”‚   â”‚   â”‚   â”œâ”€â”€ workout.types.ts      # Workout types
â”‚   â”‚   â”‚   â””â”€â”€ workout.middleware.ts # Workout validation
â”‚   â”‚   â”œâ”€â”€ social/   # Complete social module
â”‚   â”‚   â”‚   â”œâ”€â”€ social.service.ts    # Social logic
â”‚   â”‚   â”‚   â”œâ”€â”€ social.types.ts      # Social types
â”‚   â”‚   â”‚   â””â”€â”€ social.middleware.ts # Social validation
â”‚   â”‚   â””â”€â”€ ai/       # AI module 
â”‚   â”œâ”€â”€ shared/      # ğŸ”§ Shared utilities
â”‚   â”‚   â”œâ”€â”€ middleware/ # Global middlewares
â”‚   â”‚   â”‚   â”œâ”€â”€ error.middleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ rate-limit.middleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ validation.middleware.ts
â”‚   â”‚   â””â”€â”€ utils/   # Common utilities
â”‚   â”‚       â”œâ”€â”€ helpers.ts
â”‚   â”‚       â”œâ”€â”€ constants.ts
â”‚   â”‚       â””â”€â”€ response.ts
â”‚   â””â”€â”€ index.ts     # ğŸš€ Optimized entry point
â”œâ”€â”€ supabase/        # Supabase configuration
â”‚   â”œâ”€â”€ migrations/  # Database migrations
â”‚   â”œâ”€â”€ config.toml  # Supabase configuration
â”‚   â””â”€â”€ seed.sql     # Test data
â”œâ”€â”€ tests/           # Project tests
â”œâ”€â”€ docs/            # Project documentation
â”‚   â”œâ”€â”€ README.md              # API documentation
â”‚   â””â”€â”€ OPENAPI_DOCUMENTATION.md # OpenAPI documentation summary
â”œâ”€â”€ scripts/         # Utility scripts
â”‚   â”œâ”€â”€ generate-openapi.js          # Basic OpenAPI generation
â”‚   â””â”€â”€ generate-complete-openapi-v2.js # Complete OpenAPI generation
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vitest.config.ts
â”œâ”€â”€ openapi.json     # OpenAPI 3.1 specification 
â”œâ”€â”€ env.example      # Example environment variables
â””â”€â”€ Dockerfile
</div></code></pre>
<h4 id="openapi-documentation-status">OpenAPI Documentation Status</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Authentication Flow"
    LOGIN[POST /auth/login]
    REGISTER[POST /auth/register]
    REFRESH[POST /auth/refresh]
    LOGOUT[POST /auth/logout]
    ME[GET /auth/me]
  end
  
  subgraph "User Management"
    USER_PROFILE[GET /users/:id]
    UPDATE_PROFILE[PATCH /users/:id]
    USER_SUMMARY[GET /users/:id/summary]
    USER_ACTIVITY[GET /users/:id/activity]
    AVATAR[POST /users/:id/avatar]
  end
  
  subgraph "Workout Management"
    EXERCISES[GET /exercises]
    CREATE_WORKOUT[POST /workouts]
    GET_WORKOUT[GET /workouts/:id]
    UPDATE_WORKOUT[PATCH /workouts/:id]
    LOG_WORKOUT[POST /workouts/:id/logs]
    WORKOUT_PROGRESS[GET /workouts/:id/progress]
    DELETE_WORKOUT[DELETE /workouts/:id]
  end
  
  subgraph "Nutrition Management"
    FOODS[GET /foods]
    CREATE_DIET[POST /diets]
    GET_DIET[GET /diets/:id]
    UPDATE_DIET[PATCH /diets/:id]
    DIET_MEALS[GET /diets/:id/meals]
    LOG_DIET[POST /diets/:id/logs]
  end
  
  subgraph "Schedule Management"
    CREATE_SCHEDULE[POST /schedules]
    GET_SCHEDULE[GET /schedules/:id]
    UPDATE_SCHEDULE[PATCH /schedules/:id]
    SCHEDULE_ITEMS[GET /schedules/:id/items]
    WEEKLY_VIEW[GET /schedules/weekly]
    MONTHLY_VIEW[GET /schedules/monthly]
    YEARLY_VIEW[GET /schedules/yearly]
  end
  
  subgraph "Calorie Tracking"
    LOG_CALORIES[POST /calories/log]
    GET_CALORIES[GET /calories/:date]
    CALORIE_HISTORY[GET /calories/history]
    FOOD_SEARCH[GET /foods/search]
    ADD_FOOD[POST /foods/custom]
  end
  
  subgraph "Social Features"
    FEED[GET /feed]
    CREATE_POST[POST /posts]
    LIKE_POST[POST /posts/:id/like]
    COMMENT[POST /posts/:id/comments]
    FOLLOW[POST /users/:id/follow]
    FOLLOWERS[GET /users/:id/followers]
  end
  
  subgraph "AI Features"
    AI_CHAT[POST /ai/chat]
    AI_RECOMMENDATIONS[GET /ai/recommendations]
    GENERATE_PLAN[POST /ai/generate-plan]
    CHAT_HISTORY[GET /ai/chat/history]
  end
</div></code></pre>
<p><strong>API Design Principles</strong></p>
<ul>
<li><strong>RESTful</strong> with clear resources</li>
<li><strong>Versioning</strong> in the URL (<code>/api/v1/...</code>)</li>
<li><strong>Consistent JSON</strong> responses</li>
<li><strong>Semantic HTTP codes</strong></li>
<li><strong>Cursor-based pagination</strong> for lists</li>
<li><strong>User-based rate limiting</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Category</th>
<th>Endpoints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ” <strong>Authentication</strong></td>
<td>6</td>
<td>Register, login, refresh, logout, profile, password change</td>
</tr>
<tr>
<td>ğŸ‘¤ <strong>Users</strong></td>
<td>6</td>
<td>Profile, settings, stats, public profile</td>
</tr>
<tr>
<td>ğŸ’ª <strong>Workouts</strong></td>
<td>5</td>
<td>Basic workouts CRUD</td>
</tr>
<tr>
<td>ğŸ“± <strong>Social</strong></td>
<td>11</td>
<td>Feed, posts, likes, comments, follows</td>
</tr>
<tr>
<td>ğŸ‘¤ <strong>Personal</strong></td>
<td>6</td>
<td>Personal info, objectives, dietary preferences</td>
</tr>
<tr>
<td>ğŸ‹ï¸ <strong>Routines</strong></td>
<td>7</td>
<td>Custom routines CRUD, duplicate, share</td>
</tr>
<tr>
<td>ğŸ“ <strong>Advanced Posts</strong></td>
<td>4</td>
<td>Trending, search, share, repost</td>
</tr>
<tr>
<td>ğŸ“Š <strong>Dashboard</strong></td>
<td>2</td>
<td>Stats and recent activity</td>
</tr>
<tr>
<td>âš™ï¸ <strong>Settings</strong></td>
<td>3</td>
<td>General user settings</td>
</tr>
</tbody>
</table>
<p><strong>âœ… Complete Documentation (31 Endpoints):</strong></p>
<ul>
<li><code>GET /</code> - General API information</li>
<li><code>GET /reference</code> - Interactive documentation (Scalar)</li>
<li><code>GET /openapi.json</code> - OpenAPI 3.1 specification</li>
<li><code>GET /health</code> - Server health check</li>
</ul>
<p><strong>ğŸ” Authentication (<code>/api/v1/auth</code>):</strong></p>
<ul>
<li><code>POST /register</code> - Register user</li>
<li><code>POST /login</code> - User login</li>
<li><code>POST /refresh</code> - Refresh token</li>
<li><code>POST /logout</code> - Logout</li>
<li><code>GET /me</code> - Authenticated user profile</li>
<li><code>POST /change-password</code> - Change password</li>
<li><code>POST /forgot-password</code> - Request password reset</li>
<li><code>POST /reset-password</code> - Reset password with token</li>
</ul>
<p><strong>ğŸ‘¤ Users (<code>/api/v1/users</code>):</strong></p>
<ul>
<li><code>GET /profile</code> - Get user profile</li>
<li><code>PUT /profile</code> - Update user profile</li>
<li><code>GET /settings</code> - Get user settings</li>
<li><code>PUT /settings</code> - Update user settings</li>
<li><code>GET /stats</code> - User stats</li>
<li><code>GET /:userId</code> - Get public profile</li>
<li><code>GET /:userId/summary</code> - Get public user summary</li>
<li><code>GET /:userId/activity</code> - Get user's recent activity</li>
<li><code>POST /:userId/avatar</code> - Upload user avatar</li>
</ul>
<p><strong>ğŸ“Š Personal Information (<code>/api/v1/users/personal</code>):</strong></p>
<ul>
<li><code>GET /info</code> - Get complete personal information</li>
<li><code>PUT /info</code> - Update personal info (age, gender, weight, height, BMI)</li>
<li><code>GET /objectives</code> - Get objectives &amp; experience level</li>
<li><code>PUT /objectives</code> - Update objectives &amp; experience level</li>
<li><code>GET /dietary-preferences</code> - Get dietary preferences</li>
<li><code>PUT /dietary-preferences</code> - Update dietary preferences</li>
<li><code>GET /fitness-profile</code> - Get complete fitness profile</li>
<li><code>PUT /fitness-profile</code> - Update complete fitness profile</li>
</ul>
<p><strong>ğŸ‹ï¸ Custom Routines (<code>/api/v1/workouts/routines</code>):</strong></p>
<ul>
<li><code>GET /</code> - List user routines</li>
<li><code>POST /</code> - Create new custom routine</li>
<li><code>GET /:routineId</code> - Get routine details</li>
<li><code>PUT /:routineId</code> - Update custom routine</li>
<li><code>DELETE /:routineId</code> - Delete custom routine</li>
<li><code>GET /templates</code> - Get routine templates</li>
<li><code>POST /:routineId/duplicate</code> - Duplicate existing routine</li>
<li><code>GET /search</code> - Search routines by criteria (goal, level, duration, equipment)</li>
<li><code>POST /:routineId/share</code> - Share routine with other users</li>
</ul>
<p><strong>ğŸ‘¥ Social (<code>/api/v1/social</code>):</strong></p>
<ul>
<li><code>GET /feed</code> - User social feed</li>
<li><code>GET /posts</code> - Posts by a specific user</li>
<li><code>POST /posts</code> - Create post</li>
<li><code>GET /posts/:postId</code> - Get post details</li>
<li><code>PUT /posts/:postId</code> - Update post</li>
<li><code>DELETE /posts/:postId</code> - Delete post</li>
<li><code>POST /posts/:postId/like</code> - Like/unlike post</li>
<li><code>GET /posts/:postId/comments</code> - Get post comments</li>
<li><code>POST /posts/:postId/comments</code> - Comment on post</li>
<li><code>POST /follow</code> - Follow user</li>
<li><code>POST /unfollow</code> - Unfollow user</li>
<li><code>GET /followers</code> - Get followers list</li>
<li><code>GET /following</code> - Get following users list</li>
</ul>
<p><strong>ğŸ“± Advanced Posts (<code>/api/v1/social/posts</code>):</strong></p>
<ul>
<li><code>GET /</code> - List posts with filters (type, date, user)</li>
<li><code>POST /</code> - Create new post</li>
<li><code>GET /:postId</code> - Get full post with interactions</li>
<li><code>PUT /:postId</code> - Update post</li>
<li><code>DELETE /:postId</code> - Delete post</li>
<li><code>POST /:postId/share</code> - Share/forward post</li>
<li><code>POST /:postId/repost</code> - Repost content</li>
<li><code>GET /:postId/shares</code> - Get users who shared</li>
<li><code>GET /:postId/likes</code> - Get users who liked</li>
<li><code>GET /types</code> - Get available post types (achievement, routine, tip, progress)</li>
<li><code>GET /trending</code> - Get trending posts</li>
<li><code>GET /search</code> - Search posts by content or hashtags</li>
</ul>
<p><strong>ğŸ” Authentication (6 endpoints):</strong></p>
<ul>
<li><code>POST /api/v1/auth/register</code> - User registration</li>
<li><code>POST /api/v1/auth/login</code> - Login</li>
<li><code>POST /api/v1/auth/refresh</code> - Token refresh</li>
<li><code>POST /api/v1/auth/logout</code> - Logout</li>
<li><code>GET /api/v1/auth/me</code> - Current user profile</li>
<li><code>POST /api/v1/auth/change-password</code> - Change password</li>
</ul>
<p><strong>ğŸ‘¤ User Management (6 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/users/profile</code> - Get profile</li>
<li><code>PUT /api/v1/users/profile</code> - Update profile</li>
<li><code>GET /api/v1/users/settings</code> - Get settings</li>
<li><code>PUT /api/v1/users/settings</code> - Update settings</li>
<li><code>GET /api/v1/users/stats</code> - User stats</li>
<li><code>GET /api/v1/users/{userId}/public</code> - Public profile</li>
</ul>
<p><strong>ğŸ’ª Workouts (5 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/workouts</code> - List workouts</li>
<li><code>POST /api/v1/workouts</code> - Create workout</li>
<li><code>GET /api/v1/workouts/{workoutId}</code> - Workout details</li>
<li><code>PUT /api/v1/workouts/{workoutId}</code> - Update workout</li>
<li><code>DELETE /api/v1/workouts/{workoutId}</code> - Delete workout</li>
</ul>
<p><strong>ğŸ“± Social Features (11 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/social/feed</code> - Social feed</li>
<li><code>GET /api/v1/social/posts</code> - List posts</li>
<li><code>POST /api/v1/social/posts</code> - Create post</li>
<li><code>GET /api/v1/social/posts/{postId}</code> - Post details</li>
<li><code>PUT /api/v1/social/posts/{postId}</code> - Update post</li>
<li><code>DELETE /api/v1/social/posts/{postId}</code> - Delete post</li>
<li><code>POST /api/v1/social/posts/{postId}/like</code> - Like post</li>
<li><code>GET /api/v1/social/posts/{postId}/comments</code> - Comments</li>
<li><code>POST /api/v1/social/posts/{postId}/comments</code> - Create comment</li>
<li><code>POST /api/v1/social/follow/{userId}</code> - Follow user</li>
<li><code>DELETE /api/v1/social/follow/{userId}</code> - Unfollow user</li>
</ul>
<p><strong>ğŸ‘¤ Personal Information (6 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/users/personal/info</code> - Personal information</li>
<li><code>PUT /api/v1/users/personal/info</code> - Update personal information</li>
<li><code>GET /api/v1/users/personal/objectives</code> - Fitness objectives</li>
<li><code>PUT /api/v1/users/personal/objectives</code> - Update objectives</li>
<li><code>GET /api/v1/users/personal/dietary-preferences</code> - Dietary preferences</li>
<li><code>PUT /api/v1/users/personal/dietary-preferences</code> - Update dietary preferences</li>
</ul>
<p><strong>ğŸ‹ï¸ Custom Routines (7 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/workouts/routines</code> - List routines</li>
<li><code>POST /api/v1/workouts/routines</code> - Create routine</li>
<li><code>GET /api/v1/workouts/routines/{routineId}</code> - Routine details</li>
<li><code>PUT /api/v1/workouts/routines/{routineId}</code> - Update routine</li>
<li><code>DELETE /api/v1/workouts/routines/{routineId}</code> - Delete routine</li>
<li><code>POST /api/v1/workouts/routines/{routineId}/duplicate</code> - Duplicate routine</li>
<li><code>POST /api/v1/workouts/routines/{routineId}/share</code> - Share routine</li>
</ul>
<p><strong>ğŸ“ Advanced Posts (4 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/social/posts/trending</code> - Trending posts</li>
<li><code>GET /api/v1/social/posts/search</code> - Search posts</li>
<li><code>POST /api/v1/social/posts/{postId}/share</code> - Share post</li>
<li><code>POST /api/v1/social/posts/{postId}/repost</code> - Repost</li>
</ul>
<p><strong>ğŸ“Š Dashboard (2 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/dashboard/stats</code> - Dashboard stats</li>
<li><code>GET /api/v1/dashboard/activity</code> - Recent activity</li>
</ul>
<p><strong>âš™ï¸ Settings (3 endpoints):</strong></p>
<ul>
<li><code>GET /api/v1/settings</code> - Get settings</li>
<li><code>PUT /api/v1/settings</code> - Update settings</li>
<li><code>POST /api/v1/settings/reset</code> - Reset settings</li>
</ul>
<p><strong>ğŸ“¦ NPM Scripts:</strong></p>
<ul>
<li><code>npm run dev</code> - Development server with hot reload</li>
<li><code>npm run build</code> - Production build</li>
<li><code>npm run start</code> - Production server</li>
<li><code>npm run test</code> - Run tests</li>
<li><code>npm run test:watch</code> - Watch mode tests</li>
<li><code>npm run test:coverage</code> - Test coverage</li>
<li><code>npm run lint</code> - Linting with ESLint</li>
<li><code>npm run lint:fix</code> - Linting with auto-fix</li>
<li><code>npm run format</code> - Formatting with Prettier</li>
<li><code>npm run docs:generate</code> - Generate basic OpenAPI docs</li>
<li><code>npm run docs:generate-full</code> - Generate full OpenAPI documentation</li>
<li><code>npm run docs:serve</code> - Serve interactive documentation</li>
<li><code>npm run docs:open</code> - Open docs in browser</li>
</ul>
<p><strong>ğŸš€ Technical Features:</strong></p>
<ul>
<li><strong>OpenAPI loading:</strong> From JSON file for better performance</li>
<li><strong>dotenv config:</strong> Automatic environment variable loading</li>
<li><strong>Interactive docs:</strong> Scalar API Reference at <code>/reference</code></li>
<li><strong>Automatic validation:</strong> Zod schemas for request/response</li>
<li><strong>Strict TypeScript:</strong> Strong typing throughout the project</li>
<li><strong>ES Modules:</strong> Modern modules setup</li>
<li><strong>Error handling:</strong> Consistent and professional</li>
<li><strong>Rate limiting:</strong> Protection against abuse</li>
<li><strong>Configured CORS:</strong> For development and production</li>
</ul>
<h4 id="database-migrations">Database Migrations</h4>
<p><strong><code>user_personal_info</code></strong> - Detailed personal information:</p>
<ul>
<li><code>age</code> - User age (13-120 years)</li>
<li><code>weight_kg</code> - Weight in kilograms</li>
<li><code>height_cm</code> - Height in centimeters</li>
<li><code>bmi</code> - Calculated body mass index</li>
<li><code>body_fat_percentage</code> - Body fat percentage</li>
</ul>
<p><strong><code>user_fitness_profile</code></strong> - Complete fitness profile:</p>
<ul>
<li><code>experience_level</code> - Experience level (beginner, intermediate, advanced, expert)</li>
<li><code>primary_goal</code> - Primary goal (weight_loss, muscle_gain, etc.)</li>
<li><code>secondary_goals</code> - Secondary goals (array)</li>
<li><code>workout_frequency</code> - Training frequency (1-7 days/week)</li>
<li><code>preferred_workout_duration</code> - Preferred duration in minutes</li>
<li><code>available_equipment</code> - Available equipment</li>
<li><code>workout_preferences</code> - Workout preferences (JSONB)</li>
<li><code>injury_history</code> - Injury history</li>
<li><code>medical_restrictions</code> - Medical restrictions</li>
<li><code>fitness_goals_timeline</code> - Goals timeline</li>
<li><code>motivation_level</code> - Motivation level (1-10)</li>
</ul>
<p><strong><code>user_dietary_preferences</code></strong> - Dietary preferences:</p>
<ul>
<li><code>dietary_restrictions</code> - Dietary restrictions</li>
<li><code>allergies</code> - Food allergies</li>
<li><code>food_preferences</code> - Food preferences (JSONB)</li>
<li><code>calorie_goal</code> - Daily calorie goal</li>
<li><code>protein_goal</code> - Protein goal</li>
<li><code>carb_goal</code> - Carb goal</li>
<li><code>fat_goal</code> - Fat goal</li>
<li><code>water_intake_goal</code> - Water intake goal</li>
<li><code>meal_frequency</code> - Meal frequency</li>
</ul>
<p><strong><code>shared_workouts</code></strong> - Shared routines:</p>
<ul>
<li><code>original_workout_id</code> - Original workout ID</li>
<li><code>shared_by_user_id</code> - User sharing the routine</li>
<li><code>shared_with_user_id</code> - User receiving the routine</li>
<li><code>is_accepted</code> - Acceptance status</li>
</ul>
<p><strong><code>post_shares</code></strong> - Post sharing:</p>
<ul>
<li><code>post_id</code> - Post ID</li>
<li><code>shared_by_user_id</code> - User who shares</li>
<li><code>shared_with_user_id</code> - User who receives the share</li>
<li><code>share_type</code> - Type of sharing (share, repost, forward)</li>
</ul>
<p><strong><code>post_reposts</code></strong> - Post reposts:</p>
<ul>
<li><code>original_post_id</code> - Original post ID</li>
<li><code>reposted_by_user_id</code> - User who reposts</li>
<li><code>reposted_at</code> - Repost timestamp</li>
</ul>
<p><strong>Modified Tables:</strong></p>
<ul>
<li><strong><code>profiles</code></strong> - Added <code>gender</code> and <code>fitness_level</code> fields</li>
<li><strong><code>workouts</code></strong> - Added fields for custom routines</li>
<li><strong><code>posts</code></strong> - Added fields for advanced posts</li>
</ul>
<h3 id="1-user-personal-information"><strong>1. User Personal Information</strong></h3>
<h4 id="get-apiv1userspersonalinfo"><strong>GET /api/v1/users/personal/info</strong></h4>
<p>Get complete personal user information.</p>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"male"</span>,
    <span class="hljs-attr">"weight_kg"</span>: <span class="hljs-number">75.5</span>,
    <span class="hljs-attr">"height_cm"</span>: <span class="hljs-number">180</span>,
    <span class="hljs-attr">"bmi"</span>: <span class="hljs-number">23.3</span>,
    <span class="hljs-attr">"body_fat_percentage"</span>: <span class="hljs-number">15.2</span>,
    <span class="hljs-attr">"created_at"</span>: <span class="hljs-string">"2024-01-15T10:30:00Z"</span>,
    <span class="hljs-attr">"updated_at"</span>: <span class="hljs-string">"2024-01-20T14:45:00Z"</span>
  }
}
</div></code></pre>
<h4 id="put-apiv1userspersonalinfo"><strong>PUT /api/v1/users/personal/info</strong></h4>
<p>Update personal user information.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"age"</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"male"</span>,
  <span class="hljs-attr">"weight_kg"</span>: <span class="hljs-number">75.5</span>,
  <span class="hljs-attr">"height_cm"</span>: <span class="hljs-number">180</span>
}
</div></code></pre>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"male"</span>,
    <span class="hljs-attr">"weight_kg"</span>: <span class="hljs-number">75.5</span>,
    <span class="hljs-attr">"height_cm"</span>: <span class="hljs-number">180</span>,
    <span class="hljs-attr">"bmi"</span>: <span class="hljs-number">23.3</span>,
    <span class="hljs-attr">"body_fat_percentage"</span>: <span class="hljs-number">15.2</span>,
    <span class="hljs-attr">"updated_at"</span>: <span class="hljs-string">"2024-01-20T14:45:00Z"</span>
  }
}
</div></code></pre>
<h4 id="get-apiv1userspersonalobjectives"><strong>GET /api/v1/users/personal/objectives</strong></h4>
<p>Get user fitness objectives and experience level.</p>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"experience_level"</span>: <span class="hljs-string">"intermediate"</span>,
    <span class="hljs-attr">"primary_goal"</span>: <span class="hljs-string">"muscle_gain"</span>,
    <span class="hljs-attr">"secondary_goals"</span>: [<span class="hljs-string">"strength_building"</span>, <span class="hljs-string">"flexibility"</span>],
    <span class="hljs-attr">"workout_frequency"</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">"preferred_workout_duration"</span>: <span class="hljs-number">60</span>,
    <span class="hljs-attr">"available_equipment"</span>: [<span class="hljs-string">"full_gym"</span>, <span class="hljs-string">"dumbbells"</span>],
    <span class="hljs-attr">"fitness_goals_timeline"</span>: <span class="hljs-string">"6_months"</span>,
    <span class="hljs-attr">"motivation_level"</span>: <span class="hljs-number">8</span>
  }
}
</div></code></pre>
<h4 id="put-apiv1userspersonalobjectives"><strong>PUT /api/v1/users/personal/objectives</strong></h4>
<p>Update objectives and experience level.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"experience_level"</span>: <span class="hljs-string">"intermediate"</span>,
  <span class="hljs-attr">"primary_goal"</span>: <span class="hljs-string">"muscle_gain"</span>,
  <span class="hljs-attr">"secondary_goals"</span>: [<span class="hljs-string">"strength_building"</span>],
  <span class="hljs-attr">"workout_frequency"</span>: <span class="hljs-number">4</span>,
  <span class="hljs-attr">"preferred_workout_duration"</span>: <span class="hljs-number">60</span>,
  <span class="hljs-attr">"available_equipment"</span>: [<span class="hljs-string">"full_gym"</span>, <span class="hljs-string">"dumbbells"</span>],
  <span class="hljs-attr">"fitness_goals_timeline"</span>: <span class="hljs-string">"6_months"</span>,
  <span class="hljs-attr">"motivation_level"</span>: <span class="hljs-number">8</span>
}
</div></code></pre>
<h4 id="get-apiv1userspersonaldietary-preferences"><strong>GET /api/v1/users/personal/dietary-preferences</strong></h4>
<p>Get user dietary preferences.</p>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"dietary_restrictions"</span>: [<span class="hljs-string">"high_protein"</span>, <span class="hljs-string">"dairy_free"</span>],
    <span class="hljs-attr">"allergies"</span>: [<span class="hljs-string">"nuts"</span>, <span class="hljs-string">"shellfish"</span>],
    <span class="hljs-attr">"calorie_goal"</span>: <span class="hljs-number">2500</span>,
    <span class="hljs-attr">"protein_goal"</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">"carb_goal"</span>: <span class="hljs-number">300</span>,
    <span class="hljs-attr">"fat_goal"</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">"water_intake_goal"</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-attr">"meal_frequency"</span>: <span class="hljs-number">5</span>
  }
}
</div></code></pre>
<h4 id="put-apiv1userspersonaldietary-preferences"><strong>PUT /api/v1/users/personal/dietary-preferences</strong></h4>
<p>Update dietary preferences.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"dietary_restrictions"</span>: [<span class="hljs-string">"high_protein"</span>, <span class="hljs-string">"dairy_free"</span>],
  <span class="hljs-attr">"allergies"</span>: [<span class="hljs-string">"nuts"</span>],
  <span class="hljs-attr">"calorie_goal"</span>: <span class="hljs-number">2500</span>,
  <span class="hljs-attr">"protein_goal"</span>: <span class="hljs-number">150</span>,
  <span class="hljs-attr">"carb_goal"</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">"fat_goal"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">"water_intake_goal"</span>: <span class="hljs-number">3000</span>,
  <span class="hljs-attr">"meal_frequency"</span>: <span class="hljs-number">5</span>
}
</div></code></pre>
<h3 id="2-custom-routines"><strong>2. Custom Routines</strong></h3>
<h4 id="get-apiv1workoutsroutines"><strong>GET /api/v1/workouts/routines</strong></h4>
<p>List user routines with filters.</p>
<p><strong>Query Parameters:</strong></p>
<ul>
<li><code>page</code> (number): Page (default: 1)</li>
<li><code>limit</code> (number): Items per page (default: 10)</li>
<li><code>goal</code> (string): Filter by goal</li>
<li><code>level</code> (string): Filter by level</li>
<li><code>equipment</code> (string): Filter by equipment</li>
<li><code>duration_min</code> (number): Minimum duration in minutes</li>
<li><code>duration_max</code> (number): Maximum duration in minutes</li>
</ul>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"routines"</span>: [
      {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"uuid"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Strength Routine"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Routine focused on muscle gain"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"strength"</span>,
        <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"intermediate"</span>,
        <span class="hljs-attr">"duration_minutes"</span>: <span class="hljs-number">60</span>,
        <span class="hljs-attr">"target_goal"</span>: <span class="hljs-string">"muscle_gain"</span>,
        <span class="hljs-attr">"target_level"</span>: <span class="hljs-string">"intermediate"</span>,
        <span class="hljs-attr">"days_per_week"</span>: <span class="hljs-number">4</span>,
        <span class="hljs-attr">"equipment_required"</span>: [<span class="hljs-string">"full_gym"</span>, <span class="hljs-string">"dumbbells"</span>],
        <span class="hljs-attr">"user_notes"</span>: <span class="hljs-string">"Focus on correct form"</span>,
        <span class="hljs-attr">"tags"</span>: [<span class="hljs-string">"strength"</span>, <span class="hljs-string">"hypertrophy"</span>],
        <span class="hljs-attr">"share_count"</span>: <span class="hljs-number">5</span>,
        <span class="hljs-attr">"like_count"</span>: <span class="hljs-number">12</span>,
        <span class="hljs-attr">"is_public"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"created_at"</span>: <span class="hljs-string">"2024-01-15T10:30:00Z"</span>
      }
    ],
    <span class="hljs-attr">"pagination"</span>: {
      <span class="hljs-attr">"page"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"limit"</span>: <span class="hljs-number">10</span>,
      <span class="hljs-attr">"total"</span>: <span class="hljs-number">25</span>,
      <span class="hljs-attr">"total_pages"</span>: <span class="hljs-number">3</span>
    }
  }
}
</div></code></pre>
<h4 id="post-apiv1workoutsroutines"><strong>POST /api/v1/workouts/routines</strong></h4>
<p>Create a new custom routine.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Strength Routine"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Routine focused on muscle gain"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"strength"</span>,
  <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"intermediate"</span>,
  <span class="hljs-attr">"duration_minutes"</span>: <span class="hljs-number">60</span>,
  <span class="hljs-attr">"target_goal"</span>: <span class="hljs-string">"muscle_gain"</span>,
  <span class="hljs-attr">"target_level"</span>: <span class="hljs-string">"intermediate"</span>,
  <span class="hljs-attr">"days_per_week"</span>: <span class="hljs-number">4</span>,
  <span class="hljs-attr">"equipment_required"</span>: [<span class="hljs-string">"full_gym"</span>, <span class="hljs-string">"dumbbells"</span>],
  <span class="hljs-attr">"user_notes"</span>: <span class="hljs-string">"Focus on correct form"</span>,
  <span class="hljs-attr">"tags"</span>: [<span class="hljs-string">"strength"</span>, <span class="hljs-string">"hypertrophy"</span>],
  <span class="hljs-attr">"is_public"</span>: <span class="hljs-literal">true</span>
}
</div></code></pre>
<h4 id="get-apiv1workoutsroutinessearch"><strong>GET /api/v1/workouts/routines/search</strong></h4>
<p>Search routines by criteria.</p>
<p><strong>Query Parameters:</strong></p>
<ul>
<li><code>goal</code> (string): Main goal</li>
<li><code>level</code> (string): Experience level</li>
<li><code>equipment</code> (string): Available equipment</li>
<li><code>duration_min</code> (number): Minimum duration</li>
<li><code>duration_max</code> (number): Maximum duration</li>
<li><code>days_per_week</code> (number): Days per week</li>
<li><code>tags</code> (string): Tags separated by commas</li>
</ul>
<h4 id="post-apiv1workoutsroutinesroutineidshare"><strong>POST /api/v1/workouts/routines/:routineId/share</strong></h4>
<p>Share routine with other users.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"user_ids"</span>: [<span class="hljs-string">"uuid1"</span>, <span class="hljs-string">"uuid2"</span>, <span class="hljs-string">"uuid3"</span>],
  <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Sharing this routine that has worked great for me"</span>
}
</div></code></pre>
<h3 id="3-advanced-social-posts"><strong>3. Advanced Social Posts</strong></h3>
<h4 id="get-apiv1socialposts"><strong>GET /api/v1/social/posts</strong></h4>
<p>List posts with filters.</p>
<p><strong>Query Parameters:</strong></p>
<ul>
<li><code>page</code> (number): Page</li>
<li><code>limit</code> (number): Items per page</li>
<li><code>type</code> (string): Post type (achievement, routine, tip, progress)</li>
<li><code>user_id</code> (string): Filter by user</li>
<li><code>hashtags</code> (string): Filter by hashtags</li>
<li><code>date_from</code> (string): From date (ISO)</li>
<li><code>date_to</code> (string): To date (ISO)</li>
</ul>
<p><strong>Response:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"data"</span>: {
    <span class="hljs-attr">"posts"</span>: [
      {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"uuid"</span>,
        <span class="hljs-attr">"user"</span>: {
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"uuid"</span>,
          <span class="hljs-attr">"username"</span>: <span class="hljs-string">"fitness_user"</span>,
          <span class="hljs-attr">"full_name"</span>: <span class="hljs-string">"Juan PÃ©rez"</span>,
          <span class="hljs-attr">"avatar_url"</span>: <span class="hljs-string">"https://example.com/avatar.jpg"</span>
        },
        <span class="hljs-attr">"content"</span>: <span class="hljs-string">"I achieved my 100kg bench press goal! ğŸ’ª"</span>,
        <span class="hljs-attr">"post_type"</span>: <span class="hljs-string">"achievement"</span>,
        <span class="hljs-attr">"image_urls"</span>: [<span class="hljs-string">"https://example.com/photo1.jpg"</span>],
        <span class="hljs-attr">"hashtags"</span>: [<span class="hljs-string">"#benchpress"</span>, <span class="hljs-string">"#achievement"</span>, <span class="hljs-string">"#strength"</span>],
        <span class="hljs-attr">"likes_count"</span>: <span class="hljs-number">25</span>,
        <span class="hljs-attr">"comments_count"</span>: <span class="hljs-number">8</span>,
        <span class="hljs-attr">"shares_count"</span>: <span class="hljs-number">3</span>,
        <span class="hljs-attr">"reposts_count"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">"is_original"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"created_at"</span>: <span class="hljs-string">"2024-01-20T15:30:00Z"</span>,
        <span class="hljs-attr">"workout"</span>: {
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"uuid"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Strength Routine"</span>
        }
      }
    ],
    <span class="hljs-attr">"pagination"</span>: {
      <span class="hljs-attr">"page"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"limit"</span>: <span class="hljs-number">10</span>,
      <span class="hljs-attr">"total"</span>: <span class="hljs-number">150</span>,
      <span class="hljs-attr">"total_pages"</span>: <span class="hljs-number">15</span>
    }
  }
}
</div></code></pre>
<h4 id="post-apiv1socialposts"><strong>POST /api/v1/social/posts</strong></h4>
<p>Create new post.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"content"</span>: <span class="hljs-string">"I achieved my 100kg bench press goal! ğŸ’ª"</span>,
  <span class="hljs-attr">"post_type"</span>: <span class="hljs-string">"achievement"</span>,
  <span class="hljs-attr">"image_urls"</span>: [<span class="hljs-string">"https://example.com/photo1.jpg"</span>],
  <span class="hljs-attr">"hashtags"</span>: [<span class="hljs-string">"#benchpress"</span>, <span class="hljs-string">"#achievement"</span>, <span class="hljs-string">"#strength"</span>],
  <span class="hljs-attr">"workout_id"</span>: <span class="hljs-string">"uuid"</span>,
  <span class="hljs-attr">"is_public"</span>: <span class="hljs-literal">true</span>
}
</div></code></pre>
<h4 id="post-apiv1socialpostspostidshare"><strong>POST /api/v1/social/posts/:postId/share</strong></h4>
<p>Share/forward a post.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"user_ids"</span>: [<span class="hljs-string">"uuid1"</span>, <span class="hljs-string">"uuid2"</span>],
  <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Check out this amazing achievement!"</span>,
  <span class="hljs-attr">"share_type"</span>: <span class="hljs-string">"share"</span>
}
</div></code></pre>
<h4 id="post-apiv1socialpostspostidrepost"><strong>POST /api/v1/social/posts/:postId/repost</strong></h4>
<p>Repost content.</p>
<p><strong>Request Body:</strong></p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"comment"</span>: <span class="hljs-string">"Awesome routine! I'm going to try it"</span>
}
</div></code></pre>
<h4 id="get-apiv1socialpoststrending"><strong>GET /api/v1/social/posts/trending</strong></h4>
<p>Get trending posts.</p>
<p><strong>Query Parameters:</strong></p>
<ul>
<li><code>timeframe</code> (string): Period (1h, 24h, 7d, 30d)</li>
<li><code>limit</code> (number): Number of posts</li>
</ul>
<h4 id="get-apiv1socialpostssearch"><strong>GET /api/v1/social/posts/search</strong></h4>
<p>Search posts by content or hashtags.</p>
<p><strong>Query Parameters:</strong></p>
<ul>
<li><code>q</code> (string): Search term</li>
<li><code>hashtags</code> (string): Comma-separated hashtags</li>
<li><code>type</code> (string): Post type</li>
<li><code>user_id</code> (string): Filter by user</li>
</ul>
<p><strong>ğŸ“¦ Dependency Management:</strong></p>
<ul>
<li><strong>Bun as alternative:</strong> Consider Bun for better performance</li>
<li><strong>Native ES Modules:</strong> Modern setup without transpilation</li>
<li><strong>Import maps:</strong> For better module resolution</li>
</ul>
<p><strong>ğŸ”§ Development Tools:</strong></p>
<ul>
<li><strong>Simplified scripts:</strong> More direct and efficient commands</li>
<li><strong>Minimal config:</strong> Fewer configuration files</li>
<li><strong>Improved hot reload:</strong> Faster automatic reload</li>
</ul>
<p><strong>ğŸ“š Documentation:</strong></p>
<ul>
<li><strong>Integrated API reference:</strong> Automatic docs with <a href="https://scalar.com/">Scalar</a></li>
<li><strong>OpenAPI from file:</strong> Dynamic spec loading</li>
<li><strong>Usage examples:</strong> Code examples in docs</li>
</ul>
<p><strong>ğŸš€ Performance:</strong></p>
<ul>
<li><strong>Lazy module loading:</strong> Import on demand</li>
<li><strong>Tree shaking:</strong> Remove unused code</li>
<li><strong>Optimized build:</strong> Faster, efficient builds</li>
</ul>
<p><strong>ğŸ› ï¸ Configuration:</strong></p>
<ul>
<li><strong>Environment variables:</strong> Automatic validation with Zod</li>
<li><strong>Centralized config:</strong> Single place for all config</li>
<li><strong>Generated types:</strong> TypeScript types automation</li>
<li><strong>Database:</strong> Supabase (PostgreSQL)</li>
<li><strong>Testing:</strong> Vitest + Supertest</li>
<li><strong>Linting:</strong> ESLint + Prettier</li>
<li><strong>Build:</strong> tsup for compilation</li>
</ul>
<h4 id="environment-variables">Environment Variables</h4>
<p>Create a <code>.env.example</code> and setup:</p>
<ul>
<li><code>SUPABASE_URL</code>, <code>SUPABASE_ANON_KEY</code>, <code>SUPABASE_SERVICE_KEY</code></li>
<li><code>JWT_SECRET</code>, <code>JWT_EXPIRY</code></li>
<li><code>PORT</code> (server port)</li>
<li><code>NODE_ENV</code> (development/production)</li>
<li><code>SMTP_HOST</code>, <code>SMTP_PORT</code>, <code>SMTP_USER</code>, <code>SMTP_PASS</code> (emails)</li>
</ul>
<h3 id="infrastructure-and-devops">Infrastructure and DevOps</h3>
<ul>
<li><strong>Docker</strong> + <strong>Kubernetes</strong> (local kind/minikube; managed cloud cluster as needed).</li>
<li><strong>ArgoCD</strong> (GitOps) with Helm/Kustomize.</li>
<li><strong>Prometheus + Grafana + Promtail</strong> for metrics and logs.</li>
<li><strong>Cert-Manager + Ingress NGINX</strong> for TLS/HTTPS.</li>
<li><strong>Vault/Sealed Secrets</strong> (optional) for secrets management.</li>
</ul>
<h3 id="integrations">Integrations</h3>
<ul>
<li>Messaging: Telegram/WhatsApp (via n8n, webhooks, and official/partner APIs).</li>
<li>Social Login: Google, GitHub, etc. (OAuth2/OIDC).</li>
<li>Optional: Blockchain service (Polygon/ETH testnet) for anchoring milestones.</li>
</ul>
<h4 id="api-framework-decision">API Framework Decision</h4>
<table>
<thead>
<tr>
<th>Framework</th>
<th>Location</th>
<th>Main Role</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hono</strong></td>
<td>Backend</td>
<td>Business logic, data persistence, REST APIs</td>
<td>Zustand not required</td>
</tr>
<tr>
<td><strong>Zustand</strong></td>
<td>Frontend</td>
<td>State management in React/Next.js, API communication</td>
<td>Frontend-only, not needed in backend</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>Hono (Backend):</strong></p>
<ul>
<li>Handles business logic and data persistence.</li>
<li>Provides REST APIs for frontend.</li>
<li>Zustand is not needed (Zustand is frontend-only).</li>
</ul>
</li>
<li>
<p><strong>Zustand (Frontend):</strong></p>
<ul>
<li>Client state management in React/Next.js.</li>
<li>Communicates with Hono via API calls.</li>
<li>Does not interfere with backend logic.</li>
</ul>
</li>
</ul>
<h3 id="data-architecture">Data Architecture</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Presentation Layer"
    WEB[Web App - Next.js]
    MOBILE[Mobile App - React Native]
    ADMIN[Admin Panel]
  end
  
  subgraph "API Layer"
    GATEWAY[API Gateway - Hono]
    AUTH[Auth Service]
    USER[User Service]
    WORKOUT[Workout Service]
    NUTR[Nutrition Service]
    SOCIAL[Social Service]
    AI[AI Service]
  end
  
  subgraph "Data Layer"
    POSTGRES[(PostgreSQL - Supabase)]
    STORAGE[(File Storage - Supabase)]
  end
  
  subgraph "External Services"
    DIFY[Dify AI]
    N8N[n8n Workflows]
    EMAIL[Proton Mail]
    TELEGRAM[Telegram Bot]
  end
  
  WEB --> GATEWAY
  MOBILE --> GATEWAY
  ADMIN --> GATEWAY
  
  GATEWAY --> AUTH
  GATEWAY --> USER
  GATEWAY --> WORKOUT
  GATEWAY --> NUTR
  GATEWAY --> SOCIAL
  GATEWAY --> AI
  
  USER --> POSTGRES
  WORKOUT --> POSTGRES
  NUTR --> POSTGRES
  SOCIAL --> POSTGRES
  SOCIAL --> STORAGE
  
  AI --> DIFY
  SOCIAL --> N8N
  N8N --> EMAIL
  N8N --> TELEGRAM
</div></code></pre>
<h3 id="data-architecture-simplified-version">Data Architecture (Simplified Version)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Client"
        WEB[Next.js 14 App]
    end
    
    subgraph "API Layer"
        API[Hono API Server]
        AUTH[Auth Module]
        WORKOUT[Workout Module]
        SOCIAL[Social Module]
        AI[AI Proxy]
    end
    
    subgraph "Data Layer"
        SUPA[(Supabase:\nPostgres + Auth + Storage)]
    end
    
    subgraph "External Services"
        DIFY[Dify AI]
        TELEGRAM[Telegram Bot - Optional]
    end
    
    WEB --> API
    API --> AUTH
    API --> WORKOUT
    API --> SOCIAL
    API --> AI
    
    AUTH --> SUPA
    WORKOUT --> SUPA
    SOCIAL --> SUPA
    AI --> DIFY
    AI --> TELEGRAM
</div></code></pre>
<h3 id="database-schema">Database Schema</h3>
<h4 id="main-tables">Main Tables</h4>
<pre class="hljs"><code><div><span class="hljs-comment">-- users (managed by Supabase Auth)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.profiles (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> auth.users(<span class="hljs-keyword">id</span>) PRIMARY <span class="hljs-keyword">KEY</span>,
  username <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  full_name <span class="hljs-built_in">TEXT</span>,
  avatar_url <span class="hljs-built_in">TEXT</span>,
  bio <span class="hljs-built_in">TEXT</span>,
  date_of_birth <span class="hljs-built_in">DATE</span>,
  gender <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (gender <span class="hljs-keyword">IN</span> (<span class="hljs-string">'male'</span>, <span class="hljs-string">'female'</span>, <span class="hljs-string">'other'</span>, <span class="hljs-string">'prefer_not_to_say'</span>)),
  fitness_level <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (fitness_level <span class="hljs-keyword">IN</span> (<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>, <span class="hljs-string">'expert'</span>)),
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- Detailed personal information</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.user_personal_info (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  age <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (age &gt;= <span class="hljs-number">13</span> <span class="hljs-keyword">AND</span> age &lt;= <span class="hljs-number">120</span>),
  weight_kg <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">CHECK</span> (weight_kg &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> weight_kg &lt; <span class="hljs-number">500</span>),
  height_cm <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (height_cm &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> height_cm &lt; <span class="hljs-number">300</span>),
  bmi <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">4</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">CHECK</span> (bmi &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> bmi &lt; <span class="hljs-number">100</span>),
  body_fat_percentage <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">4</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">CHECK</span> (body_fat_percentage &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> body_fat_percentage &lt;= <span class="hljs-number">100</span>),
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(user_id)
);

<span class="hljs-comment">-- Fitness profile and goals</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.user_fitness_profile (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  experience_level <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">CHECK</span> (experience_level <span class="hljs-keyword">IN</span> (<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>, <span class="hljs-string">'expert'</span>)),
  primary_goal <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">CHECK</span> (primary_goal <span class="hljs-keyword">IN</span> (<span class="hljs-string">'weight_loss'</span>, <span class="hljs-string">'muscle_gain'</span>, <span class="hljs-string">'maintain_fitness'</span>, <span class="hljs-string">'improve_endurance'</span>, <span class="hljs-string">'strength_building'</span>, <span class="hljs-string">'flexibility'</span>, <span class="hljs-string">'general_health'</span>)),
  secondary_goals <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  workout_frequency <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">CHECK</span> (workout_frequency &gt;= <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> workout_frequency &lt;= <span class="hljs-number">7</span>),
  preferred_workout_duration <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (preferred_workout_duration &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> preferred_workout_duration &lt;= <span class="hljs-number">300</span>),
  available_equipment <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span> <span class="hljs-keyword">CHECK</span> (available_equipment &lt;@ <span class="hljs-built_in">ARRAY</span>[<span class="hljs-string">'full_gym'</span>, <span class="hljs-string">'home_basic_weights'</span>, <span class="hljs-string">'no_equipment'</span>, <span class="hljs-string">'cardio_equipment'</span>, <span class="hljs-string">'resistance_bands'</span>, <span class="hljs-string">'dumbbells'</span>, <span class="hljs-string">'barbell'</span>, <span class="hljs-string">'kettlebell'</span>]),
  workout_preferences JSONB <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  injury_history <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  medical_restrictions <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  fitness_goals_timeline <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (fitness_goals_timeline <span class="hljs-keyword">IN</span> (<span class="hljs-string">'1_month'</span>, <span class="hljs-string">'3_months'</span>, <span class="hljs-string">'6_months'</span>, <span class="hljs-string">'1_year'</span>, <span class="hljs-string">'long_term'</span>)),
  motivation_level <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (motivation_level &gt;= <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> motivation_level &lt;= <span class="hljs-number">10</span>),
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(user_id)
);

<span class="hljs-comment">-- Dietary preferences</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.user_dietary_preferences (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  dietary_restrictions <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span> <span class="hljs-keyword">CHECK</span> (dietary_restrictions &lt;@ <span class="hljs-built_in">ARRAY</span>[<span class="hljs-string">'high_protein'</span>, <span class="hljs-string">'vegetarian'</span>, <span class="hljs-string">'dairy_free'</span>, <span class="hljs-string">'low_carb'</span>, <span class="hljs-string">'vegan'</span>, <span class="hljs-string">'gluten_free'</span>, <span class="hljs-string">'keto'</span>, <span class="hljs-string">'paleo'</span>, <span class="hljs-string">'mediterranean'</span>, <span class="hljs-string">'intermittent_fasting'</span>]),
  allergies <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  food_preferences JSONB <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  calorie_goal <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (calorie_goal &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> calorie_goal &lt; <span class="hljs-number">10000</span>),
  protein_goal <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (protein_goal &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> protein_goal &lt; <span class="hljs-number">500</span>),
  carb_goal <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (carb_goal &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> carb_goal &lt; <span class="hljs-number">1000</span>),
  fat_goal <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (fat_goal &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> fat_goal &lt; <span class="hljs-number">500</span>),
  water_intake_goal <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (water_intake_goal &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> water_intake_goal &lt; <span class="hljs-number">10000</span>),
  meal_frequency <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (meal_frequency &gt;= <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> meal_frequency &lt;= <span class="hljs-number">10</span>),
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(user_id)
);

<span class="hljs-comment">-- user_stats</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.user_stats (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  height_cm <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>),
  weight_kg <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>),
  body_fat_percentage <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>),
  target_weight_kg <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>),
  recorded_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- exercises (exercise library)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.exercises (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  <span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  description <span class="hljs-built_in">TEXT</span>,
  muscle_group <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  equipment <span class="hljs-built_in">TEXT</span>[],
  difficulty <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (difficulty <span class="hljs-keyword">IN</span> (<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>)),
  video_url <span class="hljs-built_in">TEXT</span>,
  image_url <span class="hljs-built_in">TEXT</span>,
  is_public <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">true</span>,
  created_by <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>),
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- workouts</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.workouts (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  <span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  description <span class="hljs-built_in">TEXT</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (<span class="hljs-keyword">type</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'strength'</span>, <span class="hljs-string">'cardio'</span>, <span class="hljs-string">'flexibility'</span>, <span class="hljs-string">'hiit'</span>, <span class="hljs-string">'mixed'</span>, <span class="hljs-string">'custom'</span>)),
  difficulty <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (difficulty <span class="hljs-keyword">IN</span> (<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>, <span class="hljs-string">'expert'</span>)),
  duration_minutes <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (duration_minutes &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> duration_minutes &lt;= <span class="hljs-number">300</span>),
  is_template <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">false</span>,
  is_public <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">false</span>,
  is_shared <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">false</span>,
  target_goal <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (target_goal <span class="hljs-keyword">IN</span> (<span class="hljs-string">'weight_loss'</span>, <span class="hljs-string">'muscle_gain'</span>, <span class="hljs-string">'maintain_fitness'</span>, <span class="hljs-string">'improve_endurance'</span>, <span class="hljs-string">'strength_building'</span>, <span class="hljs-string">'flexibility'</span>, <span class="hljs-string">'general_health'</span>)),
  target_level <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (target_level <span class="hljs-keyword">IN</span> (<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>, <span class="hljs-string">'expert'</span>)),
  days_per_week <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">CHECK</span> (days_per_week &gt;= <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> days_per_week &lt;= <span class="hljs-number">7</span>),
  equipment_required <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span> <span class="hljs-keyword">CHECK</span> (equipment_required &lt;@ <span class="hljs-built_in">ARRAY</span>[<span class="hljs-string">'full_gym'</span>, <span class="hljs-string">'home_basic_weights'</span>, <span class="hljs-string">'no_equipment'</span>, <span class="hljs-string">'cardio_equipment'</span>, <span class="hljs-string">'resistance_bands'</span>, <span class="hljs-string">'dumbbells'</span>, <span class="hljs-string">'barbell'</span>, <span class="hljs-string">'kettlebell'</span>]),
  user_notes <span class="hljs-built_in">TEXT</span>,
  tags <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  share_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  like_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- shared_workouts</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.shared_workouts (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  original_workout_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> workouts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  shared_by_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  shared_with_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  shared_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  is_accepted <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">false</span>,
  accepted_at TIMESTAMPTZ,
  <span class="hljs-keyword">UNIQUE</span>(original_workout_id, shared_with_user_id)
);

<span class="hljs-comment">-- workout_exercises (M2M relationship)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.workout_exercises (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  workout_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> workouts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  exercise_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> exercises(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  order_index <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-keyword">sets</span> <span class="hljs-built_in">INTEGER</span>,
  reps <span class="hljs-built_in">INTEGER</span>,
  weight_kg <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>),
  rest_seconds <span class="hljs-built_in">INTEGER</span>,
  notes <span class="hljs-built_in">TEXT</span>
);

<span class="hljs-comment">-- workout_sessions (completed sessions)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.workout_sessions (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  workout_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> workouts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-literal">NULL</span>,
  started_at TIMESTAMPTZ <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  completed_at TIMESTAMPTZ,
  duration_minutes <span class="hljs-built_in">INTEGER</span>,
  calories_burned <span class="hljs-built_in">INTEGER</span>,
  notes <span class="hljs-built_in">TEXT</span>,
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- Social features</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.posts (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  <span class="hljs-keyword">content</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  post_type <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">CHECK</span> (post_type <span class="hljs-keyword">IN</span> (<span class="hljs-string">'achievement'</span>, <span class="hljs-string">'routine'</span>, <span class="hljs-string">'tip'</span>, <span class="hljs-string">'progress'</span>, <span class="hljs-string">'motivation'</span>, <span class="hljs-string">'question'</span>, <span class="hljs-string">'general'</span>)),
  workout_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> workouts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-literal">NULL</span>,
  image_urls <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  video_url <span class="hljs-built_in">TEXT</span>,
  hashtags <span class="hljs-built_in">TEXT</span>[] <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'{}'</span>,
  likes_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  comments_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  shares_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  reposts_count <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  is_public <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">true</span>,
  is_original <span class="hljs-built_in">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">true</span>, <span class="hljs-comment">-- false if it's a repost</span>
  original_post_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> posts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- for reposts</span>
  shared_from_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- user who originally shared</span>
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);

<span class="hljs-comment">-- shared_posts</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.post_shares (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  post_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> posts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  shared_by_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  shared_with_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  share_type <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">CHECK</span> (share_type <span class="hljs-keyword">IN</span> (<span class="hljs-string">'share'</span>, <span class="hljs-string">'repost'</span>, <span class="hljs-string">'forward'</span>)),
  shared_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(post_id, shared_by_user_id, shared_with_user_id)
);

<span class="hljs-comment">-- reposts</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.post_reposts (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  original_post_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> posts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  reposted_by_user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  reposted_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(original_post_id, reposted_by_user_id)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.follows (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  follower_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  following_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(follower_id, following_id),
  <span class="hljs-keyword">CHECK</span> (follower_id != following_id)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.likes (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  post_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> posts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  <span class="hljs-keyword">UNIQUE</span>(user_id, post_id)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> public.comments (
  <span class="hljs-keyword">id</span> <span class="hljs-keyword">UUID</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">DEFAULT</span> gen_random_uuid(),
  user_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">profiles</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  post_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> posts(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  <span class="hljs-keyword">content</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  parent_comment_id <span class="hljs-keyword">UUID</span> <span class="hljs-keyword">REFERENCES</span> comments(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>,
  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>(),
  updated_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NOW</span>()
);
</div></code></pre>
<h4 id="row-level-security-rls">Row Level Security (RLS)</h4>
<p>Implement security policies for each table:</p>
<ul>
<li>Profiles: users can read public profiles, modify only their own</li>
<li>Workouts: read public + own workouts, modify only their own</li>
<li>Posts: read public, modify only their own</li>
</ul>
<h4 id="indexes-and-optimization">Indexes and Optimization</h4>
<pre class="hljs"><code><div><span class="hljs-comment">-- Critical indexes for performance</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_profiles_username <span class="hljs-keyword">ON</span> <span class="hljs-keyword">profiles</span>(username);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_workouts_user_id <span class="hljs-keyword">ON</span> workouts(user_id);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_posts_user_id <span class="hljs-keyword">ON</span> posts(user_id);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_posts_created_at <span class="hljs-keyword">ON</span> posts(created_at <span class="hljs-keyword">DESC</span>);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_follows_follower <span class="hljs-keyword">ON</span> <span class="hljs-keyword">follows</span>(follower_id);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_follows_following <span class="hljs-keyword">ON</span> <span class="hljs-keyword">follows</span>(following_id);
</div></code></pre>
<h4 id="database-schema-diagrams">Database Schema Diagrams</h4>
<h5 id="main-er-diagram---core-entities">Main ER Diagram - Core Entities</h5>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    %% === MAIN ENTITIES ===
    PROFILES {
        uuid id PK "Reference to auth.users"
        text username UK "Unique username"
        text full_name "Full name"
        text avatar_url "Avatar URL"
        text bio "User biography"
        date date_of_birth "Date of birth"
        text gender "Gender (male/female/other/prefer_not_to_say)"
        text fitness_level "Fitness level (beginner/intermediate/advanced/expert)"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    %% === DETAILED PERSONAL INFORMATION ===
    USER_PERSONAL_INFO {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        integer age "Age (13-120)"
        decimal weight_kg "Weight in kg"
        integer height_cm "Height in cm"
        decimal bmi "Body Mass Index"
        decimal body_fat_percentage "Body fat percentage"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    USER_FITNESS_PROFILE {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        text experience_level "Experience level"
        text primary_goal "Primary fitness goal"
        text[] secondary_goals "Secondary goals"
        integer workout_frequency "Workout frequency (1-7 days)"
        integer preferred_workout_duration "Preferred duration in minutes"
        text[] available_equipment "Available equipment"
        jsonb workout_preferences "Workout preferences"
        text[] injury_history "Injury history"
        text[] medical_restrictions "Medical restrictions"
        text fitness_goals_timeline "Goals timeline"
        integer motivation_level "Motivation level (1-10)"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    USER_DIETARY_PREFERENCES {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        text[] dietary_restrictions "Dietary restrictions"
        text[] allergies "Allergies"
        text[] preferred_cuisines "Preferred cuisines"
        text[] disliked_foods "Disliked foods"
        integer daily_calorie_target "Daily calorie target"
        decimal protein_target_percentage "Protein target (%)"
        decimal carb_target_percentage "Carbohydrate target (%)"
        decimal fat_target_percentage "Fat target (%)"
        text meal_preferences "Meal preferences"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    USER_STATS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        decimal height_cm "Height in cm"
        decimal weight_kg "Weight in kg"
        decimal body_fat_percentage "Body fat percentage"
        decimal target_weight_kg "Target weight in kg"
        timestamptz recorded_at "Record date"
    }
    
    %% === EXERCISES AND WORKOUTS ===
    EXERCISES {
        uuid id PK "Unique ID"
        text name "Exercise name"
        text description "Detailed description"
        text muscle_group "Primary muscle group"
        text[] muscle_groups "Secondary muscle groups"
        text[] equipment "Required equipment"
        text difficulty "Difficulty level (beginner/intermediate/advanced/expert)"
        text instructions "Execution instructions"
        text video_url "Demo video URL"
        text image_url "Image URL"
        text[] tags "Exercise tags"
        boolean is_public "Public visibility"
        uuid created_by FK "Exercise creator"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    WORKOUTS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        text name "Workout name"
        text description "Workout description"
        text type "Workout type"
        text difficulty "Workout difficulty"
        integer duration_minutes "Duration in minutes"
        boolean is_template "Is template"
        boolean is_public "Public visibility"
        boolean is_shared "Is shared"
        text target_goal "Workout target goal"
        text target_level "Target level"
        integer days_per_week "Days per week"
        text[] equipment_required "Required equipment"
        text user_notes "User notes"
        text[] tags "Workout tags"
        integer share_count "Share counter"
        integer like_count "Like counter"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    SHARED_WORKOUTS {
        uuid id PK "Unique ID"
        uuid original_workout_id FK "Reference to original workout"
        uuid shared_by_user_id FK "User who shares"
        uuid shared_with_user_id FK "User who receives"
        timestamptz shared_at "Share date"
        boolean is_accepted "Accepted by recipient"
        timestamptz accepted_at "Acceptance date"
    }
    
    WORKOUT_EXERCISES {
        uuid id PK "Unique ID"
        uuid workout_id FK "Reference to workout"
        uuid exercise_id FK "Reference to exercise"
        integer order_index "Order in workout"
        integer sets "Number of sets"
        integer reps "Number of repetitions"
        decimal weight_kg "Weight in kg"
        integer rest_seconds "Rest in seconds"
        text notes "Specific notes"
    }
    
    WORKOUT_SESSIONS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        uuid workout_id FK "Reference to workout"
        timestamptz started_at "Start time"
        timestamptz completed_at "Completion time"
        integer duration_minutes "Duration in minutes"
        integer calories_burned "Calories burned"
        text notes "Session notes"
        timestamptz created_at "Creation date"
    }
    
    %% === SOCIAL FEATURES ===
    POSTS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        text content "Post content"
        text post_type "Post type (achievement/routine/tip/progress/motivation/question/general)"
        uuid workout_id FK "Reference to workout (optional)"
        text[] image_urls "Image URLs"
        text video_url "Video URL"
        text[] hashtags "Post hashtags"
        integer likes_count "Likes counter"
        integer comments_count "Comments counter"
        integer shares_count "Shares counter"
        integer reposts_count "Reposts counter"
        boolean is_public "Public visibility"
        boolean is_original "Is original content"
        uuid original_post_id FK "Reference to original post (reposts)"
        uuid shared_from_user_id FK "User who originally shared"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    POST_LIKES {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        uuid post_id FK "Reference to post"
        timestamptz created_at "Creation date"
    }
    
    POST_COMMENTS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        uuid post_id FK "Reference to post"
        text content "Comment content"
        uuid parent_comment_id FK "Reference to parent comment (replies)"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    POST_SHARES {
        uuid id PK "Unique ID"
        uuid post_id FK "Reference to post"
        uuid shared_by_user_id FK "User who shares"
        uuid shared_with_user_id FK "User who receives"
        text share_type "Share type (share/repost/forward)"
        timestamptz shared_at "Share date"
    }
    
    POST_REPOSTS {
        uuid id PK "Unique ID"
        uuid original_post_id FK "Reference to original post"
        uuid reposted_by_user_id FK "User who reposts"
        timestamptz reposted_at "Repost date"
    }
    
    %% === FOLLOW SYSTEM ===
    FOLLOWS {
        uuid id PK "Unique ID"
        uuid follower_id FK "User who follows"
        uuid following_id FK "User being followed"
        timestamptz created_at "Follow date"
    }
    
    %% === USER CONFIGURATION ===
    USER_SETTINGS {
        uuid id PK "Unique ID"
        uuid user_id FK "Reference to profiles"
        boolean email_notifications "Email notifications"
        boolean push_notifications "Push notifications"
        boolean workout_reminders "Workout reminders"
        text timezone "Timezone"
        text language "Preferred language"
        text theme "App theme"
        boolean profile_visibility "Profile visibility"
        boolean workout_visibility "Workout visibility"
        boolean progress_visibility "Progress visibility"
        timestamptz created_at "Creation date"
        timestamptz updated_at "Last update date"
    }
    
    %% === MAIN RELATIONSHIPS ===
    %% User and personal information
    PROFILES ||--o{ USER_PERSONAL_INFO : "has"
    PROFILES ||--o{ USER_FITNESS_PROFILE : "has"
    PROFILES ||--o{ USER_DIETARY_PREFERENCES : "has"
    PROFILES ||--o{ USER_STATS : "records"
    PROFILES ||--o{ USER_SETTINGS : "configures"
    
    %% User and content
    PROFILES ||--o{ EXERCISES : "creates"
    PROFILES ||--o{ WORKOUTS : "creates"
    PROFILES ||--o{ POSTS : "publishes"
    PROFILES ||--o{ WORKOUT_SESSIONS : "performs"
    
    %% Social system
    PROFILES ||--o{ FOLLOWS : "follows"
    PROFILES ||--o{ FOLLOWS : "followed_by"
    PROFILES ||--o{ POST_LIKES : "likes"
    PROFILES ||--o{ POST_COMMENTS : "comments"
    PROFILES ||--o{ POST_SHARES : "shares"
    PROFILES ||--o{ POST_REPOSTS : "reposts"
    PROFILES ||--o{ SHARED_WORKOUTS : "shares_workout"
    PROFILES ||--o{ SHARED_WORKOUTS : "receives_workout"
    
    %% Workouts and exercises
    WORKOUTS ||--o{ WORKOUT_EXERCISES : "contains"
    EXERCISES ||--o{ WORKOUT_EXERCISES : "included_in"
    WORKOUTS ||--o{ WORKOUT_SESSIONS : "executed_as"
    WORKOUTS ||--o{ SHARED_WORKOUTS : "shared_as"
    WORKOUTS ||--o{ POSTS : "featured_in"
    
    %% Posts and interactions
    POSTS ||--o{ POST_LIKES : "receives_likes"
    POSTS ||--o{ POST_COMMENTS : "has_comments"
    POSTS ||--o{ POST_SHARES : "is_shared"
    POSTS ||--o{ POST_REPOSTS : "is_reposted"
    POST_COMMENTS ||--o{ POST_COMMENTS : "replies_to"
    
    %% Sharing relationships
    POSTS ||--o{ POST_SHARES : "shared_via"
    POSTS ||--o{ POST_REPOSTS : "reposted_as"
</div></code></pre>
<h1 id="principal-er-diagram-simplified">Principal ER Diagram (Simplified)</h1>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    PROFILES {
        uuid id PK
        text username UK
        text full_name
        text avatar_url
        text bio
        date date_of_birth
        text gender
        text fitness_level
        timestamptz created_at
        timestamptz updated_at
    }
    
    USER_STATS {
        uuid id PK
        uuid user_id FK
        decimal height_cm
        decimal weight_kg
        decimal body_fat_percentage
        decimal target_weight_kg
        timestamptz recorded_at
    }
    
    EXERCISES {
        uuid id PK
        text name
        text description
        text muscle_group
        text[] equipment
        text difficulty
        text video_url
        text image_url
        boolean is_public
        uuid created_by FK
        timestamptz created_at
    }
    
    WORKOUTS {
        uuid id PK
        uuid user_id FK
        text name
        text description
        text type
        text difficulty
        integer duration_minutes
        boolean is_template
        boolean is_public
        timestamptz created_at
        timestamptz updated_at
    }
    
    WORKOUT_EXERCISES {
        uuid id PK
        uuid workout_id FK
        uuid exercise_id FK
        integer order_index
        integer sets
        integer reps
        decimal weight_kg
        integer rest_seconds
        text notes
    }
    
    WORKOUT_SESSIONS {
        uuid id PK
        uuid user_id FK
        uuid workout_id FK
        timestamptz started_at
        timestamptz completed_at
        integer duration_minutes
        integer calories_burned
        text notes
        timestamptz created_at
    }
    
    POSTS {
        uuid id PK
        uuid user_id FK
        text content
        uuid workout_id FK
        text image_url
        integer likes_count
        integer comments_count
        boolean is_public
        timestamptz created_at
        timestamptz updated_at
    }
    
    FOLLOWS {
        uuid id PK
        uuid follower_id FK
        uuid following_id FK
        timestamptz created_at
    }
    
    LIKES {
        uuid id PK
        uuid user_id FK
        uuid post_id FK
        timestamptz created_at
    }
    
    COMMENTS {
        uuid id PK
        uuid user_id FK
        uuid post_id FK
        text content
        uuid parent_comment_id FK
        timestamptz created_at
        timestamptz updated_at
    }
    
    PROFILES ||--o{ USER_STATS : "has"
    PROFILES ||--o{ WORKOUTS : "creates"
    PROFILES ||--o{ EXERCISES : "creates"
    PROFILES ||--o{ POSTS : "writes"
    PROFILES ||--o{ FOLLOWS : "follower"
    PROFILES ||--o{ FOLLOWS : "following"
    PROFILES ||--o{ LIKES : "gives"
    PROFILES ||--o{ COMMENTS : "writes"
    
    WORKOUTS ||--o{ WORKOUT_EXERCISES : "contains"
    EXERCISES ||--o{ WORKOUT_EXERCISES : "included_in"
    WORKOUTS ||--o{ WORKOUT_SESSIONS : "completed_as"
    PROFILES ||--o{ WORKOUT_SESSIONS : "performs"
    
    POSTS ||--o{ LIKES : "receives"
    POSTS ||--o{ COMMENTS : "has"
    COMMENTS ||--o{ COMMENTS : "replies_to"
    WORKOUTS ||--o{ POSTS : "featured_in"
</div></code></pre>
<h5 id="social-relationships-diagram">Social Relationships Diagram</h5>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    PROFILES {
        uuid id PK
        text username UK
        text full_name
        text avatar_url
        text bio
        text fitness_level
    }
    
    POSTS {
        uuid id PK
        uuid user_id FK
        text content
        uuid workout_id FK
        text image_url
        integer likes_count
        integer comments_count
        boolean is_public
        timestamptz created_at
    }
    
    FOLLOWS {
        uuid id PK
        uuid follower_id FK
        uuid following_id FK
        timestamptz created_at
    }
    
    LIKES {
        uuid id PK
        uuid user_id FK
        uuid post_id FK
        timestamptz created_at
    }
    
    COMMENTS {
        uuid id PK
        uuid user_id FK
        uuid post_id FK
        text content
        uuid parent_comment_id FK
        timestamptz created_at
    }
    
    PROFILES ||--o{ POSTS : "creates"
    PROFILES ||--o{ FOLLOWS : "follower"
    PROFILES ||--o{ FOLLOWS : "following"
    PROFILES ||--o{ LIKES : "gives"
    PROFILES ||--o{ COMMENTS : "writes"
    
    POSTS ||--o{ LIKES : "receives"
    POSTS ||--o{ COMMENTS : "has"
    COMMENTS ||--o{ COMMENTS : "replies_to"
</div></code></pre>
<h5 id="workouts-and-exercises-diagram">Workouts and Exercises Diagram</h5>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    PROFILES {
        uuid id PK
        text username UK
        text fitness_level
    }
    
    EXERCISES {
        uuid id PK
        text name
        text muscle_group
        text[] equipment
        text difficulty
        boolean is_public
        uuid created_by FK
    }
    
    WORKOUTS {
        uuid id PK
        uuid user_id FK
        text name
        text type
        text difficulty
        integer duration_minutes
        boolean is_template
        boolean is_public
    }
    
    WORKOUT_EXERCISES {
        uuid id PK
        uuid workout_id FK
        uuid exercise_id FK
        integer order_index
        integer sets
        integer reps
        decimal weight_kg
        integer rest_seconds
        text notes
    }
    
    WORKOUT_SESSIONS {
        uuid id PK
        uuid user_id FK
        uuid workout_id FK
        timestamptz started_at
        timestamptz completed_at
        integer duration_minutes
        integer calories_burned
    }
    
    PROFILES ||--o{ EXERCISES : "creates"
    PROFILES ||--o{ WORKOUTS : "creates"
    PROFILES ||--o{ WORKOUT_SESSIONS : "performs"
    
    WORKOUTS ||--o{ WORKOUT_EXERCISES : "contains"
    EXERCISES ||--o{ WORKOUT_EXERCISES : "included_in"
    WORKOUTS ||--o{ WORKOUT_SESSIONS : "completed_as"
</div></code></pre>
<h5 id="user-statistics-diagram">User Statistics Diagram</h5>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    PROFILES {
        uuid id PK
        text username UK
        text full_name
        text fitness_level
        timestamptz created_at
    }
    
    USER_STATS {
        uuid id PK
        uuid user_id FK
        decimal height_cm
        decimal weight_kg
        decimal body_fat_percentage
        decimal target_weight_kg
        timestamptz recorded_at
    }
    
    WORKOUT_SESSIONS {
        uuid id PK
        uuid user_id FK
        uuid workout_id FK
        timestamptz started_at
        timestamptz completed_at
        integer duration_minutes
        integer calories_burned
    }
    
    PROFILES ||--o{ USER_STATS : "tracks"
    PROFILES ||--o{ WORKOUT_SESSIONS : "performs"
</div></code></pre>
<h5 id="indexes-and-performance-diagram">Indexes and Performance Diagram</h5>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Tabla: profiles"
        P1[PRIMARY KEY: id]
        P2[UNIQUE: username]
        P3[INDEX: created_at]
    end
    
    subgraph "Tabla: workouts"
        W1[PRIMARY KEY: id]
        W2[INDEX: user_id]
        W3[INDEX: type]
        W4[INDEX: is_public]
        W5[INDEX: created_at]
    end
    
    subgraph "Tabla: posts"
        PO1[PRIMARY KEY: id]
        PO2[INDEX: user_id]
        PO3[INDEX: created_at DESC]
        PO4[INDEX: is_public]
        PO5[INDEX: workout_id]
    end
    
    subgraph "Tabla: follows"
        F1[PRIMARY KEY: id]
        F2[UNIQUE: follower_id, following_id]
        F3[INDEX: follower_id]
        F4[INDEX: following_id]
    end
    
    subgraph "Tabla: likes"
        L1[PRIMARY KEY: id]
        L2[UNIQUE: user_id, post_id]
        L3[INDEX: post_id]
        L4[INDEX: user_id]
    end
    
    subgraph "Tabla: comments"
        C1[PRIMARY KEY: id]
        C2[INDEX: post_id]
        C3[INDEX: user_id]
        C4[INDEX: parent_comment_id]
        C5[INDEX: created_at]
    end
    
    subgraph "Tabla: workout_exercises"
        WE1[PRIMARY KEY: id]
        WE2[INDEX: workout_id]
        WE3[INDEX: exercise_id]
        WE4[INDEX: order_index]
    end
    
    subgraph "Tabla: workout_sessions"
        WS1[PRIMARY KEY: id]
        WS2[INDEX: user_id]
        WS3[INDEX: workout_id]
        WS4[INDEX: started_at]
        WS5[INDEX: completed_at]
    end
</div></code></pre>
<h5 id="row-level-security-rls-diagram">Row Level Security (RLS) Diagram</h5>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "RLS Policies"
        RLS1[profiles: users can read public, modify only their own]
        RLS2[workouts: read public + own, modify only own]
        RLS3[posts: read public, modify only own]
        RLS4[user_stats: only the owner can view/modify]
        RLS5[workout_sessions: only the owner can view/modify]
        RLS6[follows: only the follower can see their follows]
        RLS7[likes: only the user can see their likes]
        RLS8[comments: read public, modify only own]
    end
    
    subgraph "User Roles"
        ROLE1[authenticated: logged-in user]
        ROLE2[anon: unauthenticated user]
        ROLE3[service_role: internal services]
    end
    
    ROLE1 --> RLS1
    ROLE1 --> RLS2
    ROLE1 --> RLS3
    ROLE1 --> RLS4
    ROLE1 --> RLS5
    ROLE1 --> RLS6
    ROLE1 --> RLS7
    ROLE1 --> RLS8
    
    ROLE2 --> RLS1
    ROLE2 --> RLS2
    ROLE2 --> RLS3
    ROLE2 --> RLS8
    
    ROLE3 --> RLS1
    ROLE3 --> RLS2
    ROLE3 --> RLS3
    ROLE3 --> RLS4
    ROLE3 --> RLS5
    ROLE3 --> RLS6
    ROLE3 --> RLS7
    ROLE3 --> RLS8
</div></code></pre>
<hr>
<h2 id="3-software-architecture-%F0%9F%94%84">3. Software Architecture ğŸ”„</h2>
<h3 id="capability-map">Capability Map</h3>
<ul>
<li><strong>Auth and Profiles</strong>: registration/login, profiles, nutrition/workout goals, body metrics.</li>
<li><strong>Workout</strong>: exercises, weekly plan, progress tracking, PRs.</li>
<li><strong>Nutrition</strong>: diet templates, macros, calories, history.</li>
<li><strong>Social</strong>: posts, comments, likes, followers, reports/moderation.</li>
<li><strong>AI Chatbot</strong>: contextual assistant per user (web) and automated flows (n8n).</li>
<li><strong>Recommendations</strong>: routine suggestions, friends and content (Dify AI).</li>
<li><strong>Notifications</strong>: email, in-app, and messaging (Telegram/WhatsApp via n8n).</li>
</ul>
<h3 id="logical-diagram-high-level">Logical Diagram (High Level)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph Frontend ["Frontend: Next.js"]
    UI["UI + shadcn/ui"]
    FEAuth["Auth Client"]
    FEAPI["API Client"]
  end

  subgraph Backend ["Backend: Node + Hono"]
    API["REST API"]
    WS["WebSocket"]
    SVC_USER["User / Profile Service"]
    SVC_WORKOUT["Workout Service"]
    SVC_NUTR["Nutrition Service"]
    SVC_SOCIAL["Social Service"]
    SVC_CHAT["Chat Orchestrator"]
    SVC_REC["Recommendation Proxy"]
  end

  subgraph Plataforma ["Plataforma"]
    SUPA["Supabase: Postgres / Auth / Storage"]
    N8N["n8n Workflows"]
    TELEGRAM["Telegram Bot"]
    DIFY["Dify AI"]
    MAIL["Proton Mail"]
    OBS["Prometheus / Grafana / Promtail"]
  end

  UI --> FEAPI
  FEAPI --> API
  FEAuth --> API

  API --> SVC_USER --> SUPA
  API --> SVC_WORKOUT --> SUPA
  API --> SVC_NUTR --> SUPA
  API --> SVC_SOCIAL --> SUPA
  API --> SVC_CHAT --> N8N
  API --> SVC_REC --> DIFY
  N8N --> MAIL
  N8N --> TELEGRAM
</div></code></pre>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "ğŸ¯ GymPal Platform"
        subgraph "Frontend Layer"
            A[React/Next.js Web App]
            B[PWA Mobile App]
            C[Admin Dashboard]
        end
        
        subgraph "API Layer"
            D[Hono API Gateway<br/>31 Endpoints]
            E[Authentication<br/>JWT + RLS]
            F[Rate Limiting<br/>100 req/min]
            G[Validation<br/>Zod Schemas]
        end
        
        subgraph "Business Logic"
            H[User Management<br/>9 Handlers]
            I[Workout System<br/>Routines + Exercises]
            J[Social Features<br/>Posts + Interactions]
            K[AI Integration<br/>Dify Platform]
            L[Analytics<br/>Dashboard + Stats]
        end
        
        subgraph "Data Layer"
            M[Supabase PostgreSQL<br/>17 Tables]
            N[Supabase Auth<br/>User Management]
            O[Supabase Storage<br/>Media Files]
            P[Redis Cache<br/>Performance]
        end
        
        subgraph "External Services"
            Q[Dify AI<br/>Recommendations]
            R[n8n Workflows<br/>Automation]
            S[Email Service<br/>Notifications]
            T[Push Notifications<br/>Real-time]
        end
    end
    
    %% Connections
    A --> D
    B --> D
    C --> D
    
    D --> E
    E --> F
    F --> G
    G --> H
    G --> I
    G --> J
    G --> K
    G --> L
    
    H --> M
    I --> M
    J --> M
    K --> Q
    L --> M
    
    H --> N
    I --> O
    J --> P
    
    D --> R
    D --> S
    D --> T
    
    %% Styling
    classDef frontend fill:#e1f5fe
    classDef api fill:#f3e5f5
    classDef business fill:#e8f5e8
    classDef data fill:#fff3e0
    classDef external fill:#fce4ec
    
    class A,B,C frontend
    class D,E,F,G api
    class H,I,J,K,L business
    class M,N,O,P data
    class Q,R,S,T external
</div></code></pre>
<hr>
<h3 id="frontend-architecture-feature-slice">Frontend Architecture (Feature-Slice)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Frontend Application (Next.js + shadcn/ui)"
    subgraph "Pages"
      HOME[Home]
      FEED[Social Feed]
      WORKOUTS[Workouts]
      DIETS[Diets]
      PROFILE[Profile]
      CHAT[AI Chat]
    end

    subgraph "Feature Modules"
      AUTH_MOD[Auth Module]
      WORKOUT_MOD[Workout Module]
      NUTR_MOD[Nutrition Module]
      SOCIAL_MOD[Social Module]
      AI_MOD[AI Module]
      NOTIF_MOD[Notifications]
    end

    subgraph "Core Components"
      NAV[Navigation]
      LAYOUT[Layout]
      THEME[Theme]
      FORM[Forms]
      CHARTS[Charts]
    end

    subgraph "State and Services"
      QUERY[React Query]
      STORE[Zustand]
      API_CLIENT[API Client]
      AUTH_CLIENT[Auth Client]
    end
  end

  HOME & FEED & WORKOUTS & DIETS & PROFILE & CHAT --> LAYOUT
  AUTH_MOD & WORKOUT_MOD & NUTR_MOD & SOCIAL_MOD & AI_MOD & NOTIF_MOD --> API_CLIENT
  API_CLIENT --> QUERY
  AUTH_CLIENT --> AUTH_MOD
  QUERY --> STORE
  THEME --> LAYOUT
  FORM --> WORKOUT_MOD & NUTR_MOD & SOCIAL_MOD
  CHARTS --> PROFILE
</div></code></pre>
<h3 id="frontend-directory-structure">Frontend Directory Structure</h3>
<pre class="hljs"><code><div>frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/            # Auth routes group
â”‚   â”‚   â”œâ”€â”€ (dashboard)/       # Protected routes
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/            # React components
â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn components
â”‚   â”‚   â”œâ”€â”€ workout/          # Domain components
â”‚   â”‚   â”œâ”€â”€ social/
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”œâ”€â”€ lib/                   # Utilities
â”‚   â”‚   â”œâ”€â”€ api/              # API client
â”‚   â”‚   â”œâ”€â”€ auth/             # Auth helpers
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”œâ”€â”€ hooks/                 # Custom React hooks
â”‚   â”œâ”€â”€ stores/                # Zustand stores
â”‚   â””â”€â”€ types/                 # TypeScript types
â”œâ”€â”€ public/
â””â”€â”€ package.json
</div></code></pre>
<hr>
<h3 id="microservices-communication-async--sync">Microservices Communication (async + sync)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  API[API Gateway] -- REST --> USER
  API -- REST --> WORKOUT
  API -- REST --> NUTR
  API -- REST --> SOCIAL
  API -- REST --> RECO
  SOCIAL -- Event(NewPost) --> BUS[(Event Bus)]
  BUS --> N8N
  BUS --> NOTIF
  RECO -- REST --> DIFY
  NOTIF -- SMTP --> MAIL

### Event Flow: Workout Progress
```mermaid
sequenceDiagram
  participant FE as Frontend
  participant API as API Gateway
  participant WO as Workout Service
  participant BUS as Event Bus
  participant RECO as Reco Service
  FE->>API: POST /workouts/{id}/logs
  API->>WO: Register set
  WO-->>API: OK
  WO->>BUS: Event(WorkoutProgressLogged)
  BUS->>RECO: Consume event
  RECO->>RECO: Recalculate recommendations
  RECO-->>API: Updated metrics
</div></code></pre>
<hr>
<h3 id="user-state">User State</h3>
<pre><code class="language-mermaid"><div class="mermaid">stateDiagram-v2
  [*] --> Guest
  Guest --> Registering: Start registration
  Registering --> Authenticated: Registration OK
  Registering --> Guest: Error
  Guest --> LoggingIn: Login
  LoggingIn --> Authenticated: OK
  LoggingIn --> Guest: Error
  Authenticated --> UpdatingProfile: Edit profile/goals
  UpdatingProfile --> Authenticated: Saved
  Authenticated --> Planning: Generate plan (workout/diet)
  Planning --> FollowingPlan: Assigned plan
  FollowingPlan --> LoggingProgress: Log progress
  LoggingProgress --> FollowingPlan: Update metrics
  Authenticated --> Socializing: Post/Comment
  Socializing --> Authenticated
  Authenticated --> [*]: Logout
</div></code></pre>
<h3 id="ai-chatbot-state">AI Chatbot State</h3>
<pre><code class="language-mermaid"><div class="mermaid">stateDiagram-v2
  [*] --> Idle
  Idle --> SessionInit: User opens chat
  SessionInit --> ContextLoad: Load context (profile/last messages)
  ContextLoad --> WaitingPrompt
  WaitingPrompt --> Thinking: Receive prompt
  Thinking --> ToolUse: Use tools (reco/exercises/macros)
  ToolUse --> Responding
  Thinking --> Responding
  Responding --> WaitingPrompt
  WaitingPrompt --> Closing: Inactivity/end
  Closing --> [*]
</div></code></pre>
<h3 id="client-server-communication-login--data-fetch">Client-Server Communication (Login + Data Fetch)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
    participant U as User
  participant FE as Frontend
  participant API as API Gateway
    participant US as User Service
  U->>FE: Enter credentials
  FE->>API: POST /auth/login
  API->>US: Validate
  US-->>API: JWT + basic profile
  API-->>FE: 200 + tokens
  FE->>API: GET /users/{id}/summary (Bearer)
  API->>US: Get summary
  US-->>API: Summary JSON
  API-->>FE: 200 Summary
</div></code></pre>
<h3 id="backend-frontend-communication-ssrcsr">Backend-Frontend Communication (SSR/CSR)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph Frontend
    NEXT[Next.js App Router]
    CSR[CSR Fetch]
    SSR[SSR on server]
  end
  subgraph Backend
    API[REST API]
    AUTH[Auth Provider]
  end
  NEXT --> SSR --> API
  NEXT --> CSR --> API
  API --> AUTH
</div></code></pre>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Frontend (Next.js)"
        COMPONENT[React Component]
        ZUSTAND[Zustand Store]
        API_CLIENT[API Client]
    end
    
    subgraph "Backend (Hono)"
        ROUTES[Hono Routes]
        SERVICES[Business Services]
        DATABASE[(Supabase)]
    end
    
    COMPONENT --> ZUSTAND
    ZUSTAND --> API_CLIENT
    API_CLIENT --> ROUTES
    ROUTES --> SERVICES
    SERVICES --> DATABASE
</div></code></pre>
<h3 id="realtime-via-websocket-notifications">Realtime via WebSocket (notifications)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant FE as Frontend
  participant WS as WebSocket Gateway
  participant NOTIF as Notification Service
  FE->>WS: CONNECT /ws
  NOTIF->>WS: send(NewComment on postId)
  WS-->>FE: event:new_comment { postId, author, text }
</div></code></pre>
<h3 id="api-request-lifecycle">API Request Lifecycle</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  REQ[HTTP Request] --> EDGE[Ingress/NGINX]
  EDGE --> GATE[API Gateway]
  GATE --> AUTHZ[AuthZ + RateLimit]
  AUTHZ --> HANDLER[Route Handler]
  HANDLER --> SERVICE[Domain Service]
  SERVICE --> DB[(Postgres)]
  SERVICE --> EXT[Ext: Dify/n8n]
  DB --> SERVICE
  SERVICE --> RESP[Response DTO]
  RESP --> GATE --> EDGE --> RES[HTTP Response]
</div></code></pre>
<h3 id="session-lifecycle-tokens">Session Lifecycle (tokens)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant FE as Frontend
  participant API as API Gateway
  participant AUTH as Auth Provider
  FE->>API: POST /auth/login
  API->>AUTH: Verify credentials
  AUTH-->>API: access, refresh
  API-->>FE: tokens + cookie (optional)
  FE->>API: Request with Bearer
  API-->>FE: 200
  FE->>API: POST /auth/refresh (refresh token)
  API->>AUTH: Rotate
  AUTH-->>API: new access
  API-->>FE: 200 new access
</div></code></pre>
<h3 id="backend-architecture-layers">Backend Architecture (Layers)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph API_Layer
    HONO[Hono Controllers]
    MIDDLE["Middleware: auth, rate limit, validation"]
  end
  subgraph Application_Layer
    USER_SVC[UserService]
    WORKOUT_SVC[WorkoutService]
    DIET_SVC[DietService]
    SOCIAL_SVC[SocialService]
    AI_SVC[AI Orchestrator]
  end
  subgraph Domain_Layer
    ENTITIES["Entities / Value Objects"]
    RULES[Domain Rules]
  end
  subgraph Infrastructure_Layer
    REPOS["Repositories (Supabase/Postgres)"]
    CACHE["Redis (optional)"]
    MQ["Event Bus (optional)"]
  end
  subgraph External_Services
    SUPA[Supabase]
    DIFY[Dify AI]
    N8N[n8n]
    SMTP["Proton Mail / SMTP"]
  end

  HONO --> MIDDLE
  MIDDLE --> USER_SVC
  MIDDLE --> WORKOUT_SVC
  MIDDLE --> DIET_SVC
  MIDDLE --> SOCIAL_SVC
  MIDDLE --> AI_SVC
  USER_SVC --> ENTITIES
  WORKOUT_SVC --> ENTITIES
  DIET_SVC --> ENTITIES
  SOCIAL_SVC --> ENTITIES
  ENTITIES --> RULES
  ENTITIES --> REPOS
  REPOS --> SUPA
  CACHE -. optional .-> REPOS
  AI_SVC --> DIFY
  SOCIAL_SVC --> MQ
  MQ --> N8N
  SOCIAL_SVC --> SMTP
</div></code></pre>
<h3 id="detailed-service-communication-flow-with-queues">Detailed Service Communication Flow (with queues)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant FE as Frontend
    participant API as API Gateway
  participant US as User Service
  participant SO as Social Service
  participant BUS as Event Bus
  participant N8 as n8n
  FE->>API: POST /posts
  API->>SO: Create Post
  SO-->>API: 201
  SO->>BUS: Event(PostCreated)
  BUS->>N8: Trigger notification flow
  N8-->>BUS: OK
</div></code></pre>
<h3 id="ai-recommendation-system-flow">AI Recommendation System Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph Data
    USAGE[User usage: exercises, diets, posts]
    PROFILE[Profile/goals/metrics]
    SOCIAL[Social interactions]
  end
  subgraph Processing
    FEATURES[Feature extraction]
    EMB[Embeddings]
    CF[Collaborative]
  end
  subgraph Engine
    DIFY[Dify Orchestrator]
    RANK[Ranking/Exploration]
  end
  subgraph Delivery
    API[API Recommendations]
    UI[UI Cards]
  end
  USAGE & PROFILE & SOCIAL --> FEATURES --> EMB & CF --> DIFY --> RANK --> API --> UI
</div></code></pre>
<h3 id="auth-security-validation-and-authentication-flow">AUTH Security Validation and Authentication Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    LOGIN["Login Request"]
    VALIDATE["Credential validation"]
    TOKENS["Issue JWT (access/refresh)"]
    HEADERS["Security Headers (CSP, HSTS)"]
    POLICIES["RBAC / ABAC"] 
    RATE["Rate Limit"]
    AUDIT["Audit"]
    RESP["200 OK"]

    LOGIN --> VALIDATE --> TOKENS
    TOKENS --> HEADERS
    TOKENS --> POLICIES --> RATE --> AUDIT --> RESP

</div></code></pre>
<h3 id="real-time-events-and-websocket-communication-flow">Real-time Events and WebSocket Communication Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  FE[Frontend WS Client] -- CONNECT --> WSGW[WS Gateway]
  WSGW --> TOPIC[(Rooms/Topics)]
  NOTIF[Notification Service] --> WSGW
  SOCIAL[Social Service] --> WSGW
  WORKOUT[Workout Service] --> WSGW
  WSGW -- event --> FE
</div></code></pre>
<h3 id="admin-management-and-monitoring-flow">Admin Management and Monitoring Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  ADMIN[Admin Panel] --> METRICS[Grafana Dashboards]
  ADMIN --> USERS_MGMT[User management]
  ADMIN --> CONTENT_MGMT[Content moderation]
  ADMIN --> ALERTS[Alerts/Incidents]
  METRICS --> PROM[Prometheus]
  ALERTS --> N8N[n8n Runbooks]
</div></code></pre>
<h3 id="scalability-and-load-balancing-flow">Scalability and Load Balancing Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid"> graph TD
  LOGIN[Login Request]
  CDN[CDN]
  LB[Load Balancer]
  INGRESS[Ingress NGINX]
  API["API Pods (HPA)"]
  SVCs["Services (HPA)"]
  DB["Postgres Read Replicas"]
  CACHE["Redis"]

  CDN --> LB --> INGRESS --> API --> SVCs
  SVCs --> DB
  SVCs --> CACHE 

  VALIDATE["Credential validation"]
  TOKENS["Issue JWT (access/refresh)"]
  HEADERS["Security Headers: CSP, HSTS"]
  POLICIES["RBAC / ABAC"]
  RATE["Rate Limit"]
  AUDIT["Audit"]
  RESP["200 OK"]

  LOGIN --> VALIDATE --> TOKENS
  TOKENS --> HEADERS
  TOKENS --> POLICIES --> RATE --> AUDIT --> RESP
</div></code></pre>
<h3 id="microservices-architecture">Microservices Architecture</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Gateway"
    GATE[API Gateway\nHono]
    WS_GW[WebSocket Gateway]
  end

  subgraph "Core Services"
    S_USER[User/Profile Service]
    S_WORKOUT[Workout Service]
    S_NUTR[Nutrition Service]
    S_SOCIAL[Social Service]
    S_CHAT[Chat Service]
    S_RECO[Recommendation Proxy]
    S_NOTIF[Notification Service]
  end

  subgraph "Platform and Data"
    DB[(PostgreSQL - Supabase)]
    STORAGE[(Storage - Supabase)]
    N8N[n8n Workflows]
    DIFY[Dify AI]
    MAIL[Proton Mail/SMTP]
    CACHE[(Optional Redis)]
  end

  GATE --> S_USER
  GATE --> S_WORKOUT
  GATE --> S_NUTR
  GATE --> S_SOCIAL
  GATE --> S_CHAT
  GATE --> S_RECO
  GATE --> S_NOTIF

  S_USER --> DB
  S_WORKOUT --> DB
  S_NUTR --> DB
  S_SOCIAL --> DB
  S_CHAT --> N8N
  S_RECO --> DIFY
  S_NOTIF --> MAIL

  S_USER --> STORAGE
  S_SOCIAL --> STORAGE
  S_CHAT -. optional .-> CACHE
</div></code></pre>
<h3 id="complete-data-flow">Complete Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SVC as Microservice
  participant DB as PostgreSQL
  participant CACHE as Redis (optional)
  participant EXT as External Service
  participant WS as WebSocket
  participant N8N as n8n
  
  U->>FE: User action
  FE->>API: HTTP/WebSocket request
  API->>API: Auth validation + rate limit
  API->>SVC: Process request
  alt Redis (optional)
  SVC->>CACHE: Check cache
  alt Cache miss
    SVC->>DB: Query data
    DB-->>SVC: Data
    SVC->>CACHE: Update cache
  else Cache hit
    CACHE-->>SVC: Cached data
    end
  else Without Redis
    SVC->>DB: Query data directly
    DB-->>SVC: Data
  end
  
  alt External service required
    SVC->>EXT: External API call
    EXT-->>SVC: Response
  end
  
  SVC-->>API: Processed response
  API-->>FE: JSON Response
  
  alt Real-time event
    SVC->>WS: Emit event
    WS-->>FE: Push notification
  end
  
  alt n8n Workflow
    SVC->>N8N: Trigger workflow
    N8N->>N8N: Process workflow
  end
  
  FE-->>U: Update UI
</div></code></pre>
<h3 id="schedule-and-calendar-flow">Schedule and Calendar Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SCHEDULE as Schedule Service
  participant WORKOUT as Workout Service
  participant DIET as Diet Service
  participant DB as PostgreSQL
  participant WS as WebSocket
  
  U->>FE: Create/View schedule
  FE->>API: GET/POST /schedules
  API->>SCHEDULE: Process request
  
  alt Create schedule
    SCHEDULE->>DB: Save schedule
    SCHEDULE->>WORKOUT: Link workouts
    SCHEDULE->>DIET: Link diets
  else View schedule
    SCHEDULE->>DB: Query schedule
    SCHEDULE->>WORKOUT: Get workouts
    SCHEDULE->>DIET: Get diets
  end
  
  SCHEDULE-->>API: Complete schedule
  API-->>FE: JSON Response
  FE-->>U: Display calendar
  
  alt Weekly/monthly view
    SCHEDULE->>WS: Emit update
    WS-->>FE: Real-time update
  end
</div></code></pre>
<h3 id="calorie-tracker-flow">Calorie Tracker Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant CALORIE as Calorie Service
  participant FOOD as Food Service
  participant DB as PostgreSQL
  participant N8N as n8n Workflows
  
  U->>FE: Log calories
  FE->>API: POST /calories/log
  API->>CALORIE: Process log
  
  CALORIE->>FOOD: Search food
  FOOD->>DB: Query database
  DB-->>FOOD: Nutrition data
  FOOD-->>CALORIE: Food info
  
  CALORIE->>DB: Save log
  CALORIE->>CALORIE: Calculate totals
  
  alt Goal achieved
    CALORIE->>N8N: Trigger congratulations
    N8N->>N8N: Send notification
  end
  
  CALORIE-->>API: Log saved
  API-->>FE: JSON Response
  FE-->>U: Update dashboard
</div></code></pre>
<h3 id="weekly-calendar-view">Weekly Calendar View</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Weekly View"
    MONDAY[Monday]
    TUESDAY[Tuesday]
    WEDNESDAY[Wednesday]
    THURSDAY[Thursday]
    FRIDAY[Friday]
    SATURDAY[Saturday]
    SUNDAY[Sunday]
  end
  
  subgraph "Day Elements"
    WORKOUT_ITEM["Workout"]
    DIET_ITEM["Diet"]
    REST_ITEM["Rest"]
    CUSTOM_ITEM["Custom"]
  end
  
  subgraph "Actions"
    ADD["+ Add"]
    EDIT["Edit"]
    DELETE["Delete"]
    DRAG["Drag"]
  end
  
  MONDAY --> WORKOUT_ITEM
  MONDAY --> DIET_ITEM
  TUESDAY --> WORKOUT_ITEM
  TUESDAY --> REST_ITEM
  WEDNESDAY --> WORKOUT_ITEM
  WEDNESDAY --> DIET_ITEM
  THURSDAY --> WORKOUT_ITEM
  THURSDAY --> REST_ITEM
  FRIDAY --> WORKOUT_ITEM
  FRIDAY --> DIET_ITEM
  SATURDAY --> CUSTOM_ITEM
  SUNDAY --> REST_ITEM
  
  WORKOUT_ITEM --> ADD
  DIET_ITEM --> EDIT
  CUSTOM_ITEM --> DELETE
  REST_ITEM --> DRAG
</div></code></pre>
<h3 id="calorie-tracker-dashboard">Calorie Tracker Dashboard</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Main Dashboard"
    DAILY_GOAL[Daily Goal: 2000 cal]
    CONSUMED[Consumed: 1500 cal]
    REMAINING[Remaining: 500 cal]
    PROGRESS[Progress: 75%]
  end
  
  subgraph "Macros"
    PROTEIN[Protein: 120g]
    CARBS[Carbs: 200g]
    FAT[Fats: 65g]
  end
  
  subgraph "Meals of the Day"
    BREAKFAST[Breakfast: 400 cal]
    LUNCH[Lunch: 600 cal]
    DINNER[Dinner: 500 cal]
    SNACKS[Snacks: 0 cal]
  end
  
  subgraph "Quick Actions"
    ADD_FOOD[+ Add Food]
    SEARCH["Search Food"]
    SCAN["Scan Code"]
    QUICK_LOG["Quick Log"]
  end
  
  DAILY_GOAL --> CONSUMED
  CONSUMED --> REMAINING
  REMAINING --> PROGRESS
  
  CONSUMED --> PROTEIN
  CONSUMED --> CARBS
  CONSUMED --> FAT
  
  CONSUMED --> BREAKFAST
  CONSUMED --> LUNCH
  CONSUMED --> DINNER
  CONSUMED --> SNACKS
  
  ADD_FOOD --> SEARCH
  SEARCH --> SCAN
  SCAN --> QUICK_LOG
</div></code></pre>
<hr>
<h4 id="user-journey-diagram">User Journey Diagram</h4>
<pre><code class="language-mermaid"><div class="mermaid">journey
    title User Journey in GymPal
    section Registration
      Create account: 5: User
      Complete profile: 4: User
      Set goals: 3: User
    section Daily Use
      View dashboard: 5: User
      Create routine: 4: User
      Do workout: 5: User
      Share progress: 4: User
    section Social
      Follow users: 3: User
      Interact with posts: 4: User
      Receive AI recommendations: 5: User
    section Analytics
      View stats: 4: User
      Adjust settings: 3: User
      Export data: 2: User
</div></code></pre>
<h3 id="detailed-typescript-types">Detailed TypeScript Types</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// shared/types/user.types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> UserProfile {
  id: <span class="hljs-built_in">string</span>;
  email: <span class="hljs-built_in">string</span>;
  displayName: <span class="hljs-built_in">string</span>;
  avatarUrl?: <span class="hljs-built_in">string</span>;
  profile: {
    bio?: <span class="hljs-built_in">string</span>;
    gender?: <span class="hljs-string">'male'</span> | <span class="hljs-string">'female'</span> | <span class="hljs-string">'other'</span>;
    birthDate?: <span class="hljs-built_in">string</span>;
  };
  metrics: {
    heightCm: <span class="hljs-built_in">number</span>;
    weightKg: <span class="hljs-built_in">number</span>;
    bodyFatPct?: <span class="hljs-built_in">number</span>;
  };
  goals: {
    objective: <span class="hljs-string">'lose_weight'</span> | <span class="hljs-string">'gain_muscle'</span> | <span class="hljs-string">'maintain'</span> | <span class="hljs-string">'improve_endurance'</span>;
    weeklySessions: <span class="hljs-built_in">number</span>;
    experienceLevel: <span class="hljs-string">'beginner'</span> | <span class="hljs-string">'intermediate'</span> | <span class="hljs-string">'advanced'</span>;
  };
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// shared/types/workout.types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Exercise {
  id: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  muscleGroup: <span class="hljs-string">'chest'</span> | <span class="hljs-string">'back'</span> | <span class="hljs-string">'legs'</span> | <span class="hljs-string">'shoulders'</span> | <span class="hljs-string">'arms'</span> | <span class="hljs-string">'core'</span>;
  equipment?: <span class="hljs-built_in">string</span>;
  sets?: <span class="hljs-built_in">number</span>;
  reps?: <span class="hljs-built_in">number</span>;
  weightKg?: <span class="hljs-built_in">number</span>;
  durationSec?: <span class="hljs-built_in">number</span>;
  restSec?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> WorkoutPlan {
  id: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  description?: <span class="hljs-built_in">string</span>;
  difficulty: <span class="hljs-string">'beginner'</span> | <span class="hljs-string">'intermediate'</span> | <span class="hljs-string">'advanced'</span>;
  plan: {
    weeks: <span class="hljs-built_in">number</span>;
    daysPerWeek: <span class="hljs-built_in">number</span>;
    sessions: {
      dayOfWeek: <span class="hljs-built_in">number</span>;
      exercises: Exercise[];
    }[];
  };
  progress: {
    completedSessions: <span class="hljs-built_in">number</span>;
    totalSessions: <span class="hljs-built_in">number</span>;
    lastCompletedDate?: <span class="hljs-built_in">string</span>;
  };
  isPublic: <span class="hljs-built_in">boolean</span>;
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> WorkoutLog {
  id: <span class="hljs-built_in">string</span>;
  workoutId: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  logDate: <span class="hljs-built_in">string</span>;
  exercises: Exercise[];
  durationMinutes: <span class="hljs-built_in">number</span>;
  notes?: <span class="hljs-built_in">string</span>;
  createdAt: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// shared/types/social.types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> PostType = <span class="hljs-string">'achievement'</span> | <span class="hljs-string">'routine'</span> | <span class="hljs-string">'progress'</span> | <span class="hljs-string">'tip'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Post {
  id: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">type</span>: PostType;
  content: <span class="hljs-built_in">string</span>;
  mediaUrls: <span class="hljs-built_in">string</span>[];
  likesCount: <span class="hljs-built_in">number</span>;
  commentsCount: <span class="hljs-built_in">number</span>;
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-comment">// Populated fields</span>
  author?: Pick&lt;UserProfile, <span class="hljs-string">'id'</span> | <span class="hljs-string">'displayName'</span> | <span class="hljs-string">'avatarUrl'</span>&gt;;
  isLiked?: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Comment {
  id: <span class="hljs-built_in">string</span>;
  postId: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  content: <span class="hljs-built_in">string</span>;
  createdAt: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-comment">// Populated</span>
  author?: Pick&lt;UserProfile, <span class="hljs-string">'id'</span> | <span class="hljs-string">'displayName'</span> | <span class="hljs-string">'avatarUrl'</span>&gt;;
}
</div></code></pre>
<h3 id="domain-models-typescript">Domain Models (TypeScript)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/domain/user/User.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Gender = <span class="hljs-string">'male'</span> | <span class="hljs-string">'female'</span> | <span class="hljs-string">'other'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> BodyMetrics {
  heightCm: <span class="hljs-built_in">number</span>;
  weightKg: <span class="hljs-built_in">number</span>;
  bodyFatPct?: <span class="hljs-built_in">number</span>;
  bmi?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> UserGoals {
  objective: <span class="hljs-string">'lose_weight'</span> | <span class="hljs-string">'gain_muscle'</span> | <span class="hljs-string">'maintain'</span>;
  weeklySessions: <span class="hljs-built_in">number</span>;
  dietPreference?: <span class="hljs-string">'keto'</span> | <span class="hljs-string">'mediterranean'</span> | <span class="hljs-string">'balanced'</span> | <span class="hljs-string">'vegan'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> UserProfile {
  id: <span class="hljs-built_in">string</span>;
  email: <span class="hljs-built_in">string</span>;
  displayName: <span class="hljs-built_in">string</span>;
  gender?: Gender;
  birthDate?: <span class="hljs-built_in">string</span>;
  metrics: BodyMetrics;
  goals: UserGoals;
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// backend/src/domain/workout/Workout.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Exercise {
  id: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  muscleGroup: <span class="hljs-string">'chest'</span> | <span class="hljs-string">'back'</span> | <span class="hljs-string">'legs'</span> | <span class="hljs-string">'arms'</span> | <span class="hljs-string">'shoulders'</span> | <span class="hljs-string">'core'</span> | <span class="hljs-string">'cardio'</span>;
  equipment?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> WorkoutSet {
  exerciseId: <span class="hljs-built_in">string</span>;
  reps?: <span class="hljs-built_in">number</span>;
  weightKg?: <span class="hljs-built_in">number</span>;
  durationSec?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> WorkoutDayPlan {
  dayOfWeek: <span class="hljs-number">1</span>|<span class="hljs-number">2</span>|<span class="hljs-number">3</span>|<span class="hljs-number">4</span>|<span class="hljs-number">5</span>|<span class="hljs-number">6</span>|<span class="hljs-number">7</span>;
  sets: WorkoutSet[];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> WorkoutPlan {
  id: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  weeks: <span class="hljs-built_in">number</span>;
  schedule: WorkoutDayPlan[];
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// backend/src/domain/nutrition/Diet.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> FoodItem {
  id: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  calories: <span class="hljs-built_in">number</span>;
  proteinGrams: <span class="hljs-built_in">number</span>;
  carbsGrams: <span class="hljs-built_in">number</span>;
  fatGrams: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> DietDay {
  dayOfWeek: <span class="hljs-number">1</span>|<span class="hljs-number">2</span>|<span class="hljs-number">3</span>|<span class="hljs-number">4</span>|<span class="hljs-number">5</span>|<span class="hljs-number">6</span>|<span class="hljs-number">7</span>;
  meals: { time: <span class="hljs-built_in">string</span>; items: { foodId: <span class="hljs-built_in">string</span>; grams: <span class="hljs-built_in">number</span> }[] }[];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> DietPlan {
  id: <span class="hljs-built_in">string</span>;
  userId: <span class="hljs-built_in">string</span>;
  name: <span class="hljs-built_in">string</span>;
  targetCaloriesPerDay: <span class="hljs-built_in">number</span>;
  macroSplitPct: { protein: <span class="hljs-built_in">number</span>; carbs: <span class="hljs-built_in">number</span>; fat: <span class="hljs-built_in">number</span> };
  schedule: DietDay[];
  createdAt: <span class="hljs-built_in">string</span>;
  updatedAt: <span class="hljs-built_in">string</span>;
}
</div></code></pre>
<h3 id="repositories-supabasepostgres">Repositories (Supabase/Postgres)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/infrastructure/repos/UserRepository.ts</span>
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { UserProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../domain/user/User'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> UserRepository {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> supabase = createClient(process.env.SUPABASE_URL!, process.env.SUPABASE_KEY!)</span>) {}

  <span class="hljs-keyword">async</span> findById(id: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">Promise</span>&lt;UserProfile | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.supabase.from(<span class="hljs-string">'users'</span>).select(<span class="hljs-string">'*'</span>).eq(<span class="hljs-string">'id'</span>, id).maybeSingle();
    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
    <span class="hljs-keyword">return</span> data <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> UserProfile | <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">async</span> upsert(profile: UserProfile): <span class="hljs-built_in">Promise</span>&lt;UserProfile&gt; {
    <span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.supabase.from(<span class="hljs-string">'users'</span>).upsert(profile).select(<span class="hljs-string">'*'</span>).single();
    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
    <span class="hljs-keyword">return</span> data <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> UserProfile;
  }
}
</div></code></pre>
<h3 id="services-bussiness">Services (Bussiness)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/application/UserService.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { UserProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">'../domain/user/User'</span>;
<span class="hljs-keyword">import</span> { UserRepository } <span class="hljs-keyword">from</span> <span class="hljs-string">'../infrastructure/repos/UserRepository'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> UserService {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> users = <span class="hljs-keyword">new</span> UserRepository()</span>) {}

  <span class="hljs-keyword">async</span> getUserSummary(id: <span class="hljs-built_in">string</span>) {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.users.findById(id);
    <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'USER_NOT_FOUND'</span>);
    <span class="hljs-keyword">const</span> bmi = user.metrics.bmi ?? (user.metrics.weightKg / <span class="hljs-built_in">Math</span>.pow(user.metrics.heightCm / <span class="hljs-number">100</span>, <span class="hljs-number">2</span>));
    <span class="hljs-keyword">return</span> { id: user.id, displayName: user.displayName, objective: user.goals.objective, bmi };
  }
}

<span class="hljs-comment">// backend/src/application/WorkoutService.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { WorkoutPlan } <span class="hljs-keyword">from</span> <span class="hljs-string">'../domain/workout/Workout'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> WorkoutService {
  <span class="hljs-keyword">async</span> generatePlanForUser(userId: <span class="hljs-built_in">string</span>, weeks: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">Promise</span>&lt;WorkoutPlan&gt; {
    <span class="hljs-keyword">const</span> schedule = <span class="hljs-built_in">Array</span>.from({ length: <span class="hljs-number">3</span> }).map(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({ dayOfWeek: (i + <span class="hljs-number">1</span>) <span class="hljs-keyword">as</span> <span class="hljs-number">1</span>|<span class="hljs-number">2</span>|<span class="hljs-number">3</span>|<span class="hljs-number">4</span>|<span class="hljs-number">5</span>|<span class="hljs-number">6</span>|<span class="hljs-number">7</span>, sets: [] }));
    <span class="hljs-keyword">return</span> { id: crypto.randomUUID(), userId, name: <span class="hljs-string">'Starter Plan'</span>, weeks, schedule, createdAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString(), updatedAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString() };
  }
}
</div></code></pre>
<h3 id="controllers-hono">Controllers (Hono)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/interfaces/http/routes.ts</span>
<span class="hljs-keyword">import</span> { Hono } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;
<span class="hljs-keyword">import</span> { UserService } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../application/UserService'</span>;
<span class="hljs-keyword">import</span> { WorkoutService } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../application/WorkoutService'</span>;

<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> Hono();
<span class="hljs-keyword">const</span> userService = <span class="hljs-keyword">new</span> UserService();
<span class="hljs-keyword">const</span> workoutService = <span class="hljs-keyword">new</span> WorkoutService();

<span class="hljs-keyword">const</span> CreateWorkoutSchema = z.object({ userId: z.string().uuid(), weeks: z.number().int().min(<span class="hljs-number">1</span>).max(<span class="hljs-number">12</span>) });

api.get(<span class="hljs-string">'/auth/me'</span>, <span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.json({ user: c.get(<span class="hljs-string">'user'</span>) }));

api.get(<span class="hljs-string">'/users/:id/summary'</span>, <span class="hljs-keyword">async</span> c =&gt; {
  <span class="hljs-keyword">const</span> id = c.req.param(<span class="hljs-string">'id'</span>);
  <span class="hljs-keyword">return</span> c.json(<span class="hljs-keyword">await</span> userService.getUserSummary(id));
});

api.post(<span class="hljs-string">'/workouts'</span>, <span class="hljs-keyword">async</span> c =&gt; {
  <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> c.req.json();
  <span class="hljs-keyword">const</span> input = CreateWorkoutSchema.parse(body);
  <span class="hljs-keyword">const</span> plan = <span class="hljs-keyword">await</span> workoutService.generatePlanForUser(input.userId, input.weeks);
  <span class="hljs-keyword">return</span> c.json(plan, <span class="hljs-number">201</span>);
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> api;
</div></code></pre>
<h3 id="ai-orchestration-n8ndify">AI Orchestration (n8n/Dify)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  REQ[Evento: crear plan] --> N8N[n8n Workflow]
  N8N --> DIFY[Prompt Dify: generar plan]
  DIFY --> N8N
  N8N --> API[PATCH /workouts/:id con plan IA]
</div></code></pre>
<hr>
<h2 id="33-detailed-backend-structure">3.3 Detailed Backend Structure</h2>
<h3 id="configuration-config">Configuration (config/)</h3>
<h4 id="envts---gesti%C3%B3n-de-variables-de-entorno">env.ts - GestiÃ³n de Variables de Entorno</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// config/env.ts</span>
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">const</span> envSchema = z.object({
  NODE_ENV: z.enum([<span class="hljs-string">'development'</span>, <span class="hljs-string">'production'</span>, <span class="hljs-string">'test'</span>]).default(<span class="hljs-string">'development'</span>),
  PORT: z.string().default(<span class="hljs-string">'3000'</span>),
  SUPABASE_URL: z.string().url(),
  SUPABASE_ANON_KEY: z.string(),
  SUPABASE_SERVICE_KEY: z.string(),
  JWT_SECRET: z.string().min(<span class="hljs-number">32</span>),
  JWT_EXPIRY: z.string().default(<span class="hljs-string">'7d'</span>),
  SMTP_HOST: z.string().optional(),
  SMTP_PORT: z.string().optional(),
  SMTP_USER: z.string().optional(),
  SMTP_PASS: z.string().optional(),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> env = envSchema.parse(process.env);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Env = z.infer&lt;<span class="hljs-keyword">typeof</span> envSchema&gt;;
</div></code></pre>
<h3 id="documentation-doc">Documentation (doc/)</h3>
<h4 id="schemasts---api-documentation-schemas">schemas.ts - API Documentation Schemas</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// doc/schemas.ts</span>
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-comment">// Common response schemas</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ApiResponseSchema = z.object({
  success: z.boolean(),
  data: z.any().optional(),
  error: z.string().optional(),
  message: z.string().optional(),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PaginationSchema = z.object({
  page: z.number().min(<span class="hljs-number">1</span>).default(<span class="hljs-number">1</span>),
  limit: z.number().min(<span class="hljs-number">1</span>).max(<span class="hljs-number">100</span>).default(<span class="hljs-number">20</span>),
  total: z.number().optional(),
  totalPages: z.number().optional(),
});

<span class="hljs-comment">// Main endpoint schemas</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> AuthSchemas = {
  register: z.object({
    email: z.string().email(),
    password: z.string().min(<span class="hljs-number">8</span>),
    username: z.string().min(<span class="hljs-number">3</span>).max(<span class="hljs-number">30</span>),
    full_name: z.string().optional(),
  }),
  login: z.object({
    email: z.string().email(),
    password: z.string().min(<span class="hljs-number">8</span>),
  }),
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UserSchemas = {
  profile: z.object({
    id: z.string().uuid(),
    username: z.string(),
    full_name: z.string().nullable(),
    avatar_url: z.string().nullable(),
    bio: z.string().nullable(),
    fitness_level: z.enum([<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>]),
    created_at: z.string().datetime(),
  }),
  updateProfile: z.object({
    full_name: z.string().optional(),
    bio: z.string().max(<span class="hljs-number">500</span>).optional(),
    fitness_level: z.enum([<span class="hljs-string">'beginner'</span>, <span class="hljs-string">'intermediate'</span>, <span class="hljs-string">'advanced'</span>]).optional(),
  }),
};
</div></code></pre>
<h3 id="libraries-lib">Libraries (lib/)</h3>
<h4 id="dbts---database-client">db.ts - Database Client</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// lib/db.ts</span>
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;
<span class="hljs-keyword">import</span> { env } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config/env'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Database } <span class="hljs-keyword">from</span> <span class="hljs-string">'./types'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> supabase = createClient&lt;Database&gt;(
  env.SUPABASE_URL,
  env.SUPABASE_ANON_KEY
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> supabaseAdmin = createClient&lt;Database&gt;(
  env.SUPABASE_URL,
  env.SUPABASE_SERVICE_KEY,
  {
    auth: {
      autoRefreshToken: <span class="hljs-literal">false</span>,
      persistSession: <span class="hljs-literal">false</span>
    }
  }
);

<span class="hljs-comment">// Automatically generated database types</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Database = {
  <span class="hljs-keyword">public</span>: {
    Tables: {
      profiles: {
        Row: {
          id: <span class="hljs-built_in">string</span>;
          username: <span class="hljs-built_in">string</span>;
          full_name: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
          avatar_url: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
          bio: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
          fitness_level: <span class="hljs-string">'beginner'</span> | <span class="hljs-string">'intermediate'</span> | <span class="hljs-string">'advanced'</span>;
          created_at: <span class="hljs-built_in">string</span>;
          updated_at: <span class="hljs-built_in">string</span>;
        };
        Insert: Omit&lt;Database[<span class="hljs-string">'public'</span>][<span class="hljs-string">'Tables'</span>][<span class="hljs-string">'profiles'</span>][<span class="hljs-string">'Row'</span>], <span class="hljs-string">'id'</span> | <span class="hljs-string">'created_at'</span> | <span class="hljs-string">'updated_at'</span>&gt;;
        Update: Partial&lt;Database[<span class="hljs-string">'public'</span>][<span class="hljs-string">'Tables'</span>][<span class="hljs-string">'profiles'</span>][<span class="hljs-string">'Insert'</span>]&gt;;
      };
      <span class="hljs-comment">// ... other table types</span>
    };
  };
};
</div></code></pre>
<h4 id="mailerts---email-service">mailer.ts - Email Service</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// lib/mailer.ts</span>
<span class="hljs-keyword">import</span> nodemailer <span class="hljs-keyword">from</span> <span class="hljs-string">'nodemailer'</span>;
<span class="hljs-keyword">import</span> { env } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config/env'</span>;

<span class="hljs-keyword">const</span> transporter = nodemailer.createTransporter({
  host: env.SMTP_HOST,
  port: <span class="hljs-built_in">parseInt</span>(env.SMTP_PORT || <span class="hljs-string">'587'</span>),
  secure: <span class="hljs-literal">false</span>,
  auth: {
    user: env.SMTP_USER,
    pass: env.SMTP_PASS,
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> EmailOptions {
  to: <span class="hljs-built_in">string</span>;
  subject: <span class="hljs-built_in">string</span>;
  html: <span class="hljs-built_in">string</span>;
  text?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendEmail</span>(<span class="hljs-params">options: EmailOptions</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> transporter.sendMail({
      <span class="hljs-keyword">from</span>: <span class="hljs-string">`"GymPal" &lt;<span class="hljs-subst">${env.SMTP_USER}</span>&gt;`</span>,
      ...options,
    });
    <span class="hljs-keyword">return</span> { success: <span class="hljs-literal">true</span>, messageId: result.messageId };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error sending email:'</span>, error);
    <span class="hljs-keyword">return</span> { success: <span class="hljs-literal">false</span>, error: error.message };
  }
}

<span class="hljs-comment">// Email templates</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> emailTemplates = {
  welcome: <span class="hljs-function">(<span class="hljs-params">username: <span class="hljs-built_in">string</span></span>) =&gt;</span> ({
    subject: <span class="hljs-string">'Welcome to GymPal!'</span>,
    html: <span class="hljs-string">`
      &lt;h1&gt;Hello <span class="hljs-subst">${username}</span>!&lt;/h1&gt;
      &lt;p&gt;Welcome to GymPal, your personal fitness companion.&lt;/p&gt;
      &lt;p&gt;Start your journey towards a healthier life!&lt;/p&gt;
    `</span>,
  }),
  workoutReminder: <span class="hljs-function">(<span class="hljs-params">workoutName: <span class="hljs-built_in">string</span></span>) =&gt;</span> ({
    subject: <span class="hljs-string">'Workout Reminder'</span>,
    html: <span class="hljs-string">`
      &lt;h1&gt;It's time to train!&lt;/h1&gt;
      &lt;p&gt;You have scheduled: &lt;strong&gt;<span class="hljs-subst">${workoutName}</span>&lt;/strong&gt;&lt;/p&gt;
      &lt;p&gt;Don't forget to stay hydrated!&lt;/p&gt;
    `</span>,
  }),
};
</div></code></pre>
<h3 id="controllers-srchandler">Controllers (src/handler/)</h3>
<h4 id="authhandlerts---authentication-controllers">auth.handler.ts - Authentication Controllers</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// src/handler/auth.handler.ts</span>
<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { supabase, supabaseAdmin } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../lib/db'</span>;
<span class="hljs-keyword">import</span> { sendEmail, emailTemplates } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../lib/mailer'</span>;
<span class="hljs-keyword">import</span> { AuthSchemas } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../doc/schemas'</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params">c: Context</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> c.req.json();
    <span class="hljs-keyword">const</span> validated = AuthSchemas.register.parse(body);
    
    <span class="hljs-comment">// 1. Create user in Supabase Auth</span>
    <span class="hljs-keyword">const</span> { data: authData, error: authError } = <span class="hljs-keyword">await</span> supabase.auth.signUp({
      email: validated.email,
      password: validated.password,
    });
    
    <span class="hljs-keyword">if</span> (authError) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: authError.message 
      }, <span class="hljs-number">400</span>);
    }
    
    <span class="hljs-comment">// 2. Create profile in the database</span>
    <span class="hljs-keyword">const</span> { data: profile, error: profileError } = <span class="hljs-keyword">await</span> supabaseAdmin
      .from(<span class="hljs-string">'profiles'</span>)
      .insert({
        id: authData.user!.id,
        username: validated.username,
        full_name: validated.full_name,
        fitness_level: <span class="hljs-string">'beginner'</span>,
      })
      .select()
      .single();
    
    <span class="hljs-keyword">if</span> (profileError) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: profileError.message 
      }, <span class="hljs-number">400</span>);
    }
    
    <span class="hljs-comment">// 3. Send welcome email</span>
    <span class="hljs-keyword">await</span> sendEmail({
      to: validated.email,
      ...emailTemplates.welcome(validated.username),
    });
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">true</span>, 
      data: { user: authData.user, profile } 
    }, <span class="hljs-number">201</span>);
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> z.ZodError) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: <span class="hljs-string">'Invalid input data'</span>,
        details: error.errors 
      }, <span class="hljs-number">400</span>);
    }
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">false</span>, 
      error: <span class="hljs-string">'Internal server error'</span> 
    }, <span class="hljs-number">500</span>);
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">c: Context</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> c.req.json();
    <span class="hljs-keyword">const</span> validated = AuthSchemas.login.parse(body);
    
    <span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> supabase.auth.signInWithPassword({
      email: validated.email,
      password: validated.password,
    });
    
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: <span class="hljs-string">'Invalid credentials'</span> 
      }, <span class="hljs-number">401</span>);
    }
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">true</span>, 
      data: { user: data.user, session: data.session } 
    });
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">false</span>, 
      error: <span class="hljs-string">'Internal server error'</span> 
    }, <span class="hljs-number">500</span>);
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getProfile</span>(<span class="hljs-params">c: Context</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> userId = c.get(<span class="hljs-string">'userId'</span>);
    
    <span class="hljs-keyword">const</span> { data: profile, error } = <span class="hljs-keyword">await</span> supabase
      .from(<span class="hljs-string">'profiles'</span>)
      .select(<span class="hljs-string">'*'</span>)
      .eq(<span class="hljs-string">'id'</span>, userId)
      .single();
    
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: <span class="hljs-string">'Profile not found'</span> 
      }, <span class="hljs-number">404</span>);
    }
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">true</span>, 
      data: profile 
    });
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">false</span>, 
      error: <span class="hljs-string">'Internal server error'</span> 
    }, <span class="hljs-number">500</span>);
  }
}
</div></code></pre>
<h4 id="userhandlerts---user-controllers">user.handler.ts - User Controllers</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// src/handler/user.handler.ts</span>
<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { supabase } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../lib/db'</span>;
<span class="hljs-keyword">import</span> { UserSchemas } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../doc/schemas'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUserProfile</span>(<span class="hljs-params">c: Context</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> userId = c.req.param(<span class="hljs-string">'id'</span>);
    
    <span class="hljs-keyword">const</span> { data: profile, error } = <span class="hljs-keyword">await</span> supabase
      .from(<span class="hljs-string">'profiles'</span>)
      .select(<span class="hljs-string">'id, username, full_name, avatar_url, bio, fitness_level, created_at'</span>)
      .eq(<span class="hljs-string">'id'</span>, userId)
      .single();
    
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: <span class="hljs-string">'User not found'</span> 
      }, <span class="hljs-number">404</span>);
    }
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">true</span>, 
      data: profile 
    });
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">false</span>, 
      error: <span class="hljs-string">'Internal server error'</span> 
    }, <span class="hljs-number">500</span>);
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateProfile</span>(<span class="hljs-params">c: Context</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> userId = c.get(<span class="hljs-string">'userId'</span>);
    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> c.req.json();
    <span class="hljs-keyword">const</span> validated = UserSchemas.updateProfile.parse(body);
    
    <span class="hljs-keyword">const</span> { data: profile, error } = <span class="hljs-keyword">await</span> supabase
      .from(<span class="hljs-string">'profiles'</span>)
      .update(validated)
      .eq(<span class="hljs-string">'id'</span>, userId)
      .select()
      .single();
    
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> c.json({ 
        success: <span class="hljs-literal">false</span>, 
        error: error.message 
      }, <span class="hljs-number">400</span>);
    }
    
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">true</span>, 
      data: profile 
    });
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> c.json({ 
      success: <span class="hljs-literal">false</span>, 
      error: <span class="hljs-string">'Internal server error'</span> 
    }, <span class="hljs-number">500</span>);
  }
}
</div></code></pre>
<h3 id="routes-srcroutes">Routes (src/routes/)</h3>
<h4 id="authroutests---authentication-routes">auth.routes.ts - Authentication Routes</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// src/routes/auth.routes.ts</span>
<span class="hljs-keyword">import</span> { Hono } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { register, login, getProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">'../handler/auth.handler'</span>;
<span class="hljs-keyword">import</span> { authMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'../middleware/auth'</span>;

<span class="hljs-keyword">const</span> authRoutes = <span class="hljs-keyword">new</span> Hono();

<span class="hljs-comment">// Public routes</span>
authRoutes.post(<span class="hljs-string">'/register'</span>, register);
authRoutes.post(<span class="hljs-string">'/login'</span>, login);

<span class="hljs-comment">// Protected routes</span>
authRoutes.get(<span class="hljs-string">'/me'</span>, authMiddleware, getProfile);

<span class="hljs-keyword">export</span> { authRoutes };
</div></code></pre>
<h4 id="userroutests---user-routes">user.routes.ts - User Routes</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// src/routes/user.routes.ts</span>
<span class="hljs-keyword">import</span> { Hono } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { getUserProfile, updateProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">'../handler/user.handler'</span>;
<span class="hljs-keyword">import</span> { authMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'../middleware/auth'</span>;

<span class="hljs-keyword">const</span> userRoutes = <span class="hljs-keyword">new</span> Hono();

<span class="hljs-comment">// Public routes</span>
userRoutes.get(<span class="hljs-string">'/:id'</span>, getUserProfile);

<span class="hljs-comment">// Protected routes</span>
userRoutes.put(<span class="hljs-string">'/:id'</span>, authMiddleware, updateProfile);

<span class="hljs-keyword">export</span> { userRoutes };
</div></code></pre>
<hr>
<h3 id="ai-and-recommendations">AI and Recommendations</h3>
<pre class="hljs"><code><div>POST /api/v1/ai/chat
Body: {
  message: <span class="hljs-built_in">string</span>;
  sessionId?: <span class="hljs-built_in">string</span>;
  context?: {
    workoutId?: <span class="hljs-built_in">string</span>;
    userId?: <span class="hljs-built_in">string</span>;
  }
}
Response: {
  data: {
    message: <span class="hljs-built_in">string</span>;
    sessionId: <span class="hljs-built_in">string</span>;
    suggestions?: <span class="hljs-built_in">string</span>[];
  }
}

GET /api/v1/ai/recommendations
Query: {
  <span class="hljs-keyword">type</span>: <span class="hljs-string">'workouts'</span> | <span class="hljs-string">'users'</span> | <span class="hljs-string">'posts'</span>;
  limit?: <span class="hljs-built_in">number</span>;
}
Response: {
  data: (WorkoutPlan | UserProfile | Post)[]
}

POST /api/v1/ai/generate-workout
Body: {
  userId: <span class="hljs-built_in">string</span>;
  preferences: {
    duration: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// weeks</span>
    daysPerWeek: <span class="hljs-built_in">number</span>;
    difficulty: <span class="hljs-built_in">string</span>;
    equipment?: <span class="hljs-built_in">string</span>[];
  }
}
Response: { data: WorkoutPlan }
</div></code></pre>
<hr>
<h2 id="41-frontend-api-client">4.1 Frontend API Client</h2>
<pre class="hljs"><code><div><span class="hljs-comment">// frontend/src/shared/api/client.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ApiClient {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> baseUrl = '/api', <span class="hljs-keyword">private</span> getToken?: () =&gt; <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span></span>) {}

  <span class="hljs-keyword">private</span> headers() {
    <span class="hljs-keyword">const</span> h: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> };
    <span class="hljs-keyword">const</span> t = <span class="hljs-keyword">this</span>.getToken?.();
    <span class="hljs-keyword">if</span> (t) h.Authorization = <span class="hljs-string">`Bearer <span class="hljs-subst">${t}</span>`</span>;
    <span class="hljs-keyword">return</span> h;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">get</span>&lt;T&gt;(path: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.baseUrl}</span><span class="hljs-subst">${path}</span>`</span>, { headers: <span class="hljs-keyword">this</span>.headers() });
    <span class="hljs-keyword">if</span> (!res.ok) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-keyword">await</span> res.text());
    <span class="hljs-keyword">return</span> res.json();
  }

  <span class="hljs-keyword">async</span> post&lt;T&gt;(path: <span class="hljs-built_in">string</span>, body: unknown): <span class="hljs-built_in">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.baseUrl}</span><span class="hljs-subst">${path}</span>`</span>, { method: <span class="hljs-string">'POST'</span>, headers: <span class="hljs-keyword">this</span>.headers(), body: <span class="hljs-built_in">JSON</span>.stringify(body) });
    <span class="hljs-keyword">if</span> (!res.ok) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-keyword">await</span> res.text());
    <span class="hljs-keyword">return</span> res.json();
  }
}
</div></code></pre>
<hr>
<h2 id="43-testing-strategy">4.3 Testing Strategy</h2>
<h3 id="testing-pyramid">Testing Pyramid</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Testing Pyramid"
    E2E[E2E Tests<br/>Cypress/Playwright<br/>5%]
    INTEGRATION[Integration Tests<br/>API + DB<br/>25%]
    UNIT[Unit Tests<br/>Jest/Vitest<br/>70%]
  end
  
  subgraph "Frontend Testing"
    COMPONENT[Component Tests<br/>React Testing Library]
    HOOK[Hook Tests<br/>Custom Hooks]
    UTIL[Utility Tests<br/>Pure Functions]
  end
  
  subgraph "Backend Testing"
    SERVICE[Service Tests<br/>Business Logic]
    REPO[Repository Tests<br/>Data Layer]
    ROUTE[Route Tests<br/>API Endpoints]
  end
  
  E2E --> INTEGRATION
  INTEGRATION --> UNIT
  UNIT --> COMPONENT
  UNIT --> HOOK
  UNIT --> UTIL
  UNIT --> SERVICE
  UNIT --> REPO
  UNIT --> ROUTE
</div></code></pre>
<h3 id="layered-testing-strategy">Layered Testing Strategy</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Frontend Testing Strategy"
    UNIT_FE[Unit Tests<br/>Components, Hooks, Utils]
    INTEGRATION_FE[Integration Tests<br/>API Client, State Management]
    E2E_FE[E2E Tests<br/>User Journeys]
  end
  
  subgraph "Backend Testing Strategy"
    UNIT_BE[Unit Tests<br/>Services, Repositories, Utils]
    INTEGRATION_BE[Integration Tests<br/>API + Database]
    CONTRACT[Contract Tests<br/>API Contracts]
  end
  
  subgraph "Testing Tools"
    JEST[Jest - Unit Testing]
    RTL[React Testing Library]
    CYPRESS[Cypress - E2E]
    SUPABASE[Supabase Test Client]
    MOCK[Mock Service Worker]
  end
  
  UNIT_FE --> JEST
  UNIT_FE --> RTL
  INTEGRATION_FE --> MOCK
  E2E_FE --> CYPRESS
  
  UNIT_BE --> JEST
  INTEGRATION_BE --> SUPABASE
  CONTRACT --> JEST
</div></code></pre>
<h3 id="testing-flow-in-cicd">Testing Flow in CI/CD</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant DEV as Developer
  participant GIT as Git
  participant CI as GitHub Actions
  participant TEST as Test Suite
  participant BUILD as Build
  participant DEPLOY as Deploy
  
  DEV->>GIT: Push code
  GIT->>CI: Trigger workflow
  
  CI->>TEST: Run Unit Tests
  TEST-->>CI: âœ… Pass
  
  CI->>TEST: Run Integration Tests
  TEST-->>CI: âœ… Pass
  
  CI->>TEST: Run E2E Tests
  TEST-->>CI: âœ… Pass
  
  CI->>BUILD: Build Docker Images
  BUILD-->>CI: âœ… Success
  
  CI->>DEPLOY: Deploy to Environment
  DEPLOY-->>CI: âœ… Deployed
</div></code></pre>
<h3 id="testing-coverage">Testing Coverage</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Target Coverage"
    UNIT_COV[Unit Tests: 80%+]
    INTEGRATION_COV[Integration: 60%+]
    E2E_COV[E2E: Critical Paths]
  end
  
  subgraph "Quality Metrics"
    COVERAGE[Code Coverage]
    MUTATION[Mutation Testing]
    PERFORMANCE[Performance Tests]
    SECURITY[Security Tests]
  end
  
  subgraph "Measurement Tools"
    JEST_COV[Jest Coverage]
    STRYKER[Stryker Mutator]
    LIGHTHOUSE[Lighthouse CI]
    SNYK[Snyk Security]
  end
  
  UNIT_COV --> COVERAGE
  INTEGRATION_COV --> COVERAGE
  E2E_COV --> COVERAGE
  
  COVERAGE --> JEST_COV
  MUTATION --> STRYKER
  PERFORMANCE --> LIGHTHOUSE
  SECURITY --> SNYK
</div></code></pre>
<h3 id="test-examples">Test Examples</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// frontend/src/components/__tests__/chat-interface.test.tsx</span>
<span class="hljs-keyword">import</span> { render, screen, fireEvent, waitFor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@testing-library/react'</span>;
<span class="hljs-keyword">import</span> { ChatInterface } <span class="hljs-keyword">from</span> <span class="hljs-string">'../ai/chat-interface'</span>;
<span class="hljs-keyword">import</span> { apiClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/api/client'</span>;

jest.mock(<span class="hljs-string">'@/lib/api/client'</span>);
<span class="hljs-keyword">const</span> mockApiClient = apiClient <span class="hljs-keyword">as</span> jest.Mocked&lt;<span class="hljs-keyword">typeof</span> apiClient&gt;;

describe(<span class="hljs-string">'ChatInterface'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    jest.clearAllMocks();
  });

  it(<span class="hljs-string">'should send message and display response'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    mockApiClient.post.mockResolvedValue({
      message: <span class="hljs-string">'Test response'</span>,
      sessionId: <span class="hljs-string">'test-session'</span>
    });

    render(&lt;ChatInterface /&gt;);
    
    <span class="hljs-keyword">const</span> input = screen.getByPlaceholderText(<span class="hljs-string">'Type your message...'</span>);
    <span class="hljs-keyword">const</span> sendButton = screen.getByText(<span class="hljs-string">'Send'</span>);
    
    fireEvent.change(input, { target: { value: <span class="hljs-string">'Test message'</span> } });
    fireEvent.click(sendButton);
    
    <span class="hljs-keyword">await</span> waitFor(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      expect(screen.getByText(<span class="hljs-string">'Test message'</span>)).toBeInTheDocument();
      expect(screen.getByText(<span class="hljs-string">'Test response'</span>)).toBeInTheDocument();
    });
    
    expect(mockApiClient.post).toHaveBeenCalledWith(<span class="hljs-string">'/ai/chat'</span>, {
      message: <span class="hljs-string">'Test message'</span>,
      sessionId: <span class="hljs-literal">undefined</span>
    });
  });
});
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/modules/workouts/__tests__/workouts.service.test.ts</span>
<span class="hljs-keyword">import</span> { WorkoutService } <span class="hljs-keyword">from</span> <span class="hljs-string">'../workouts.service'</span>;
<span class="hljs-keyword">import</span> { WorkoutRepository } <span class="hljs-keyword">from</span> <span class="hljs-string">'../workouts.repository'</span>;

jest.mock(<span class="hljs-string">'../workouts.repository'</span>);
<span class="hljs-keyword">const</span> mockRepository = WorkoutRepository <span class="hljs-keyword">as</span> jest.MockedClass&lt;<span class="hljs-keyword">typeof</span> WorkoutRepository&gt;;

describe(<span class="hljs-string">'WorkoutService'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> service: WorkoutService;
  <span class="hljs-keyword">let</span> mockRepo: jest.Mocked&lt;WorkoutRepository&gt;;

  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    mockRepo = <span class="hljs-keyword">new</span> mockRepository() <span class="hljs-keyword">as</span> jest.Mocked&lt;WorkoutRepository&gt;;
    service = <span class="hljs-keyword">new</span> WorkoutService();
    (service <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).repo = mockRepo;
  });

  describe(<span class="hljs-string">'createWorkout'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    it(<span class="hljs-string">'should create workout with correct progress calculation'</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> workoutData = {
        name: <span class="hljs-string">'Test Workout'</span>,
        difficulty: <span class="hljs-string">'beginner'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
        plan: {
          weeks: <span class="hljs-number">4</span>,
          daysPerWeek: <span class="hljs-number">3</span>,
          sessions: []
        },
        isPublic: <span class="hljs-literal">false</span>
      };

      <span class="hljs-keyword">const</span> expectedWorkout = {
        ...workoutData,
        userId: <span class="hljs-string">'user-123'</span>,
        progress: {
          completedSessions: <span class="hljs-number">0</span>,
          totalSessions: <span class="hljs-number">12</span> <span class="hljs-comment">// 4 weeks * 3 days</span>
        }
      };

      mockRepo.create.mockResolvedValue(expectedWorkout <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);

      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> service.createWorkout(<span class="hljs-string">'user-123'</span>, workoutData);

      expect(mockRepo.create).toHaveBeenCalledWith(expectedWorkout);
      expect(result).toEqual(expectedWorkout);
    });
  });
});
</div></code></pre>
<hr>
<h2 id="5-ai-integration-detailed">5. AI Integration (Detailed)</h2>
<h3 id="dify-client">Dify Client</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/modules/ai/dify.client.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> DifyClient {
  <span class="hljs-keyword">private</span> apiKey: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">private</span> baseUrl = <span class="hljs-string">'https://api.dify.ai/v1'</span>;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">apiKey: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">this</span>.apiKey = apiKey;
  }

  <span class="hljs-keyword">async</span> chat(params: {
    query: <span class="hljs-built_in">string</span>;
    user: <span class="hljs-built_in">string</span>;
    conversationId?: <span class="hljs-built_in">string</span>;
    inputs?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  }) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.baseUrl}</span>/chat-messages`</span>, {
      method: <span class="hljs-string">'POST'</span>,
      headers: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-keyword">this</span>.apiKey}</span>`</span>,
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
      },
      body: <span class="hljs-built_in">JSON</span>.stringify({
        query: params.query,
        user: params.user,
        conversation_id: params.conversationId,
        inputs: params.inputs || {},
        response_mode: <span class="hljs-string">'blocking'</span>
      })
    });

    <span class="hljs-keyword">if</span> (!response.ok) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Dify API error: <span class="hljs-subst">${response.status}</span>`</span>);
    }

    <span class="hljs-keyword">return</span> response.json();
  }

  <span class="hljs-keyword">async</span> completion(params: {
    prompt: <span class="hljs-built_in">string</span>;
    user: <span class="hljs-built_in">string</span>;
    inputs?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  }) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.baseUrl}</span>/completion-messages`</span>, {
      method: <span class="hljs-string">'POST'</span>,
      headers: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-keyword">this</span>.apiKey}</span>`</span>,
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
      },
      body: <span class="hljs-built_in">JSON</span>.stringify({
        inputs: { prompt: params.prompt, ...params.inputs },
        user: params.user,
        response_mode: <span class="hljs-string">'blocking'</span>
      })
    });

    <span class="hljs-keyword">if</span> (!response.ok) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Dify API error: <span class="hljs-subst">${response.status}</span>`</span>);
    }

    <span class="hljs-keyword">return</span> response.json();
  }
}
</div></code></pre>
<h3 id="context-builder">Context Builder</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/modules/ai/context.builder.ts</span>
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ContextBuilder {
  <span class="hljs-keyword">private</span> supabase;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">this</span>.supabase = createClient(
      process.env.SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_KEY!
    );
  }

  <span class="hljs-keyword">async</span> buildForUser(userId: <span class="hljs-built_in">string</span>) {
    <span class="hljs-comment">// Get user profile</span>
    <span class="hljs-keyword">const</span> { data: profile } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.supabase
      .from(<span class="hljs-string">'users'</span>)
      .select(<span class="hljs-string">'*'</span>)
      .eq(<span class="hljs-string">'id'</span>, userId)
      .single();

    <span class="hljs-comment">// Get recent workouts (last 5)</span>
    <span class="hljs-keyword">const</span> { data: recentWorkouts } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.supabase
      .from(<span class="hljs-string">'workout_logs'</span>)
      .select(<span class="hljs-string">'*'</span>)
      .eq(<span class="hljs-string">'user_id'</span>, userId)
      .order(<span class="hljs-string">'log_date'</span>, { ascending: <span class="hljs-literal">false</span> })
      .limit(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// Get active workout plan</span>
    <span class="hljs-keyword">const</span> { data: activeWorkout } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.supabase
      .from(<span class="hljs-string">'workouts'</span>)
      .select(<span class="hljs-string">'*'</span>)
      .eq(<span class="hljs-string">'user_id'</span>, userId)
      .order(<span class="hljs-string">'created_at'</span>, { ascending: <span class="hljs-literal">false</span> })
      .limit(<span class="hljs-number">1</span>)
      .single();

    <span class="hljs-keyword">return</span> {
      profile: profile || {},
      recentWorkouts: recentWorkouts || [],
      activeWorkout: activeWorkout || <span class="hljs-literal">null</span>,
      goals: profile?.goals || {}
    };
  }
}
</div></code></pre>
<h3 id="frontend-chat-component">Frontend Chat Component</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// frontend/src/components/ai/chat-interface.tsx</span>
<span class="hljs-string">'use client'</span>;

<span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { Button } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/button'</span>;
<span class="hljs-keyword">import</span> { Input } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/input'</span>;
<span class="hljs-keyword">import</span> { ScrollArea } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/scroll-area'</span>;
<span class="hljs-keyword">import</span> { apiClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/api/client'</span>;

<span class="hljs-keyword">interface</span> Message {
  role: <span class="hljs-string">'user'</span> | <span class="hljs-string">'assistant'</span>;
  content: <span class="hljs-built_in">string</span>;
  timestamp: <span class="hljs-built_in">Date</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ChatInterface</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;Message[]&gt;([]);
  <span class="hljs-keyword">const</span> [input, setInput] = useState(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = useState(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [sessionId, setSessionId] = useState&lt;<span class="hljs-built_in">string</span>&gt;();
  <span class="hljs-keyword">const</span> scrollRef = useRef&lt;HTMLDivElement&gt;(<span class="hljs-literal">null</span>);

  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    scrollRef.current?.scrollIntoView({ behavior: <span class="hljs-string">'smooth'</span> });
  }, [messages]);

  <span class="hljs-keyword">const</span> sendMessage = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!input.trim()) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> userMessage: Message = {
      role: <span class="hljs-string">'user'</span>,
      content: input,
      timestamp: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    };

    setMessages(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, userMessage]);
    setInput(<span class="hljs-string">''</span>);
    setIsLoading(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> apiClient.post&lt;{
        message: <span class="hljs-built_in">string</span>;
        sessionId: <span class="hljs-built_in">string</span>;
        suggestions?: <span class="hljs-built_in">string</span>[];
      }&gt;(<span class="hljs-string">'/ai/chat'</span>, {
        message: input,
        sessionId
      });

      setSessionId(response.sessionId);

      <span class="hljs-keyword">const</span> assistantMessage: Message = {
        role: <span class="hljs-string">'assistant'</span>,
        content: response.message,
        timestamp: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
      };

      setMessages(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, assistantMessage]);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Chat error:'</span>, error);
      setMessages(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, {
        role: <span class="hljs-string">'assistant'</span>,
        content: <span class="hljs-string">'Sorry, an error occurred. Please try again.'</span>,
        timestamp: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
      }]);
    } <span class="hljs-keyword">finally</span> {
      setIsLoading(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    &lt;div className=<span class="hljs-string">"flex flex-col h-[600px] border rounded-lg"</span>&gt;
      &lt;div className=<span class="hljs-string">"p-4 border-b"</span>&gt;
        &lt;h2 className=<span class="hljs-string">"text-xl font-semibold"</span>&gt;AI Fitness Assistant&lt;<span class="hljs-regexp">/h2&gt;
        &lt;p className="text-sm text-muted-foreground"&gt;
          Ask about exercises, nutrition, or your progress
        &lt;/</span>p&gt;
      &lt;<span class="hljs-regexp">/div&gt;

      &lt;ScrollArea className="flex-1 p-4"&gt;
        &lt;div className="space-y-4"&gt;
          {messages.map((msg, idx) =&gt; (
            &lt;div
              key={idx}
              className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
            &gt;
              &lt;div
                className={`max-w-[80%] rounded-lg p-3 ${
                  msg.role === 'user'
                    ? 'bg-primary text-primary-foreground'
                    : 'bg-muted'
                }`}
              &gt;
                &lt;p className="text-sm"&gt;{msg.content}&lt;/</span>p&gt;
                &lt;span className=<span class="hljs-string">"text-xs opacity-70"</span>&gt;
                  {msg.timestamp.toLocaleTimeString()}
                &lt;<span class="hljs-regexp">/span&gt;
              &lt;/</span>div&gt;
            &lt;<span class="hljs-regexp">/div&gt;
          ))}
          {isLoading &amp;&amp; (
            &lt;div className="flex justify-start"&gt;
              &lt;div className="bg-muted rounded-lg p-3"&gt;
                &lt;div className="flex space-x-2"&gt;
                  &lt;div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce" /</span>&gt;
                  &lt;div className=<span class="hljs-string">"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"</span> /&gt;
                  &lt;div className=<span class="hljs-string">"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"</span> /&gt;
                &lt;<span class="hljs-regexp">/div&gt;
              &lt;/</span>div&gt;
            &lt;<span class="hljs-regexp">/div&gt;
          )}
          &lt;div ref={scrollRef} /</span>&gt;
        &lt;<span class="hljs-regexp">/div&gt;
      &lt;/</span>ScrollArea&gt;

      &lt;div className=<span class="hljs-string">"p-4 border-t"</span>&gt;
        &lt;form
          onSubmit={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
            e.preventDefault();
            sendMessage();
          }}
          className=<span class="hljs-string">"flex gap-2"</span>
        &gt;
          &lt;Input
            value={input}
            onChange={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> setInput(e.target.value)}
            placeholder=<span class="hljs-string">"Type your message..."</span>
            disabled={isLoading}
          /&gt;
          &lt;Button <span class="hljs-keyword">type</span>=<span class="hljs-string">"submit"</span> disabled={isLoading || !input.trim()}&gt;
            Send
          &lt;<span class="hljs-regexp">/Button&gt;
        &lt;/</span>form&gt;
      &lt;<span class="hljs-regexp">/div&gt;
    &lt;/</span>div&gt;
  );
}
</div></code></pre>
<hr>
<h2 id="6-security-and-compliance-%F0%9F%94%90">6. Security and Compliance ğŸ”</h2>
<h3 id="security-principles">Security Principles</h3>
<ul>
<li><strong>Defense in Depth</strong>: Multiple security layers</li>
<li><strong>Least Privilege</strong>: Minimum necessary permissions</li>
<li><strong>Secure by Default</strong>: Secure configuration by default</li>
<li><strong>Zero Trust</strong>: Always verify, never trust</li>
</ul>
<h3 id="authentication-and-authorization">Authentication and Authorization</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
    participant U as User
    participant FE as Frontend
    participant API as API Gateway
    participant AUTH as Auth Service
    participant DB as Database

    U->>FE: Login (email, password)
    FE->>API: POST /auth/login
    API->>AUTH: Validate credentials
    AUTH->>DB: Check user + hash
    DB-->>AUTH: User data
    AUTH->>AUTH: Generate JWT (15min) + Refresh (7d)
    AUTH-->>API: Tokens
    API-->>FE: Set httpOnly cookie + return tokens

    Note over FE,API: Subsequent requests
    FE->>API: Request + Bearer token
    API->>API: Verify JWT signature
    API->>API: Check expiration
    API->>API: Extract userId + permissions
    API->>API: Rate limit check
    API-->>FE: Response or 401
</div></code></pre>
<h3 id="auth-middleware-implementation">Auth Middleware Implementation</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/shared/middleware/auth.ts</span>
<span class="hljs-keyword">import</span> { Context, Next } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { verify } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/jwt'</span>;
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;

<span class="hljs-keyword">const</span> supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_KEY!
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authMiddleware</span>(<span class="hljs-params">c: Context, next: Next</span>) </span>{
  <span class="hljs-keyword">const</span> authHeader = c.req.header(<span class="hljs-string">'Authorization'</span>);

  <span class="hljs-keyword">if</span> (!authHeader?.startsWith(<span class="hljs-string">'Bearer '</span>)) {
    <span class="hljs-keyword">return</span> c.json(
      { error: { code: <span class="hljs-string">'UNAUTHORIZED'</span>, message: <span class="hljs-string">'Missing or invalid token'</span> } },
      <span class="hljs-number">401</span>
    );
  }

  <span class="hljs-keyword">const</span> token = authHeader.substring(<span class="hljs-number">7</span>);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// Verify JWT using Supabase</span>
    <span class="hljs-keyword">const</span> { data: { user }, error } = <span class="hljs-keyword">await</span> supabase.auth.getUser(token);

    <span class="hljs-keyword">if</span> (error || !user) {
      <span class="hljs-keyword">return</span> c.json(
        { error: { code: <span class="hljs-string">'UNAUTHORIZED'</span>, message: <span class="hljs-string">'Invalid token'</span> } },
        <span class="hljs-number">401</span>
      );
    }

    <span class="hljs-comment">// Set user context</span>
    c.set(<span class="hljs-string">'userId'</span>, user.id);
    c.set(<span class="hljs-string">'userEmail'</span>, user.email);

    <span class="hljs-keyword">await</span> next();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> c.json(
      { error: { code: <span class="hljs-string">'UNAUTHORIZED'</span>, message: <span class="hljs-string">'Token verification failed'</span> } },
      <span class="hljs-number">401</span>
    );
  }
}

<span class="hljs-comment">// Optional: Role-based authorization</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requireRole</span>(<span class="hljs-params">role: <span class="hljs-built_in">string</span></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (c: Context, next: Next) =&gt; {
    <span class="hljs-keyword">const</span> userId = c.get(<span class="hljs-string">'userId'</span>);

    <span class="hljs-keyword">const</span> { data: user } = <span class="hljs-keyword">await</span> supabase
      .from(<span class="hljs-string">'users'</span>)
      .select(<span class="hljs-string">'profile-&gt;role'</span>)
      .eq(<span class="hljs-string">'id'</span>, userId)
      .single();

    <span class="hljs-keyword">if</span> (user?.profile?.role !== role) {
      <span class="hljs-keyword">return</span> c.json(
        { error: { code: <span class="hljs-string">'FORBIDDEN'</span>, message: <span class="hljs-string">'Insufficient permissions'</span> } },
        <span class="hljs-number">403</span>
      );
    }

    <span class="hljs-keyword">await</span> next();
  };
}
</div></code></pre>
<h3 id="rate-limiting">Rate Limiting</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/shared/middleware/rate-limit.ts</span>
<span class="hljs-keyword">import</span> { Context, Next } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;

<span class="hljs-keyword">const</span> supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_KEY!
);

<span class="hljs-keyword">interface</span> RateLimitConfig {
  windowMs: <span class="hljs-built_in">number</span>;
  maxRequests: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> defaultConfig: RateLimitConfig = {
  windowMs: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 15 minutes</span>
  maxRequests: <span class="hljs-number">100</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rateLimitMiddleware</span>(<span class="hljs-params">config: RateLimitConfig = defaultConfig</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (c: Context, next: Next) =&gt; {
    <span class="hljs-keyword">const</span> userId = c.get(<span class="hljs-string">'userId'</span>) || c.req.header(<span class="hljs-string">'X-Real-IP'</span>) || <span class="hljs-string">'anonymous'</span>;
    <span class="hljs-keyword">const</span> key = <span class="hljs-string">`ratelimit:<span class="hljs-subst">${userId}</span>`</span>;

    <span class="hljs-comment">// Simple in-memory rate limiting (use Redis in production)</span>
    <span class="hljs-keyword">const</span> now = <span class="hljs-built_in">Date</span>.now();
    <span class="hljs-keyword">const</span> windowStart = now - config.windowMs;

    <span class="hljs-comment">// Check rate limit in database (simplified - use Redis for better performance)</span>
    <span class="hljs-keyword">const</span> { data: requests } = <span class="hljs-keyword">await</span> supabase
      .from(<span class="hljs-string">'rate_limits'</span>)
      .select(<span class="hljs-string">'count'</span>)
      .eq(<span class="hljs-string">'user_id'</span>, userId)
      .gte(<span class="hljs-string">'timestamp'</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(windowStart).toISOString())
      .single();

    <span class="hljs-keyword">const</span> currentCount = requests?.count || <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (currentCount &gt;= config.maxRequests) {
      <span class="hljs-keyword">return</span> c.json(
        {
          error: {
            code: <span class="hljs-string">'RATE_LIMIT_EXCEEDED'</span>,
            message: <span class="hljs-string">'Too many requests. Please try again later.'</span>
          }
        },
        <span class="hljs-number">429</span>
      );
    }

    <span class="hljs-comment">// Increment counter</span>
    <span class="hljs-keyword">await</span> supabase.from(<span class="hljs-string">'rate_limits'</span>).insert({
      user_id: userId,
      timestamp: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()
    });

    <span class="hljs-keyword">await</span> next();
  };
}
</div></code></pre>
<h3 id="input-validation">Input Validation</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/shared/middleware/validation.ts</span>
<span class="hljs-keyword">import</span> { Context, Next } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { z, ZodSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateBody</span>&lt;<span class="hljs-title">T</span> <span class="hljs-title">extends</span> <span class="hljs-title">ZodSchema</span>&gt;(<span class="hljs-params">schema: T</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (c: Context, next: Next) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> c.req.json();
      <span class="hljs-keyword">const</span> validated = schema.parse(body);
      c.set(<span class="hljs-string">'validatedBody'</span>, validated);
      <span class="hljs-keyword">await</span> next();
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> z.ZodError) {
        <span class="hljs-keyword">return</span> c.json(
          {
            error: {
              code: <span class="hljs-string">'VALIDATION_ERROR'</span>,
              message: <span class="hljs-string">'Invalid request body'</span>,
              details: error.errors
            }
          },
          <span class="hljs-number">400</span>
        );
      }
      <span class="hljs-keyword">throw</span> error;
    }
  };
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateQuery</span>&lt;<span class="hljs-title">T</span> <span class="hljs-title">extends</span> <span class="hljs-title">ZodSchema</span>&gt;(<span class="hljs-params">schema: T</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (c: Context, next: Next) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> query = c.req.query();
      <span class="hljs-keyword">const</span> validated = schema.parse(query);
      c.set(<span class="hljs-string">'validatedQuery'</span>, validated);
      <span class="hljs-keyword">await</span> next();
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> z.ZodError) {
        <span class="hljs-keyword">return</span> c.json(
          {
            error: {
              code: <span class="hljs-string">'VALIDATION_ERROR'</span>,
              message: <span class="hljs-string">'Invalid query parameters'</span>,
              details: error.errors
            }
          },
          <span class="hljs-number">400</span>
        );
      }
      <span class="hljs-keyword">throw</span> error;
    }
  };
}
</div></code></pre>
<h3 id="security-headers">Security Headers</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/shared/middleware/security-headers.ts</span>
<span class="hljs-keyword">import</span> { Context, Next } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">securityHeadersMiddleware</span>(<span class="hljs-params">c: Context, next: Next</span>) </span>{
  <span class="hljs-keyword">await</span> next();

  <span class="hljs-comment">// Content Security Policy</span>
  c.header(
    <span class="hljs-string">'Content-Security-Policy'</span>,
    <span class="hljs-string">"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;"</span>
  );

  <span class="hljs-comment">// Prevent XSS</span>
  c.header(<span class="hljs-string">'X-Content-Type-Options'</span>, <span class="hljs-string">'nosniff'</span>);
  c.header(<span class="hljs-string">'X-Frame-Options'</span>, <span class="hljs-string">'DENY'</span>);
  c.header(<span class="hljs-string">'X-XSS-Protection'</span>, <span class="hljs-string">'1; mode=block'</span>);

  <span class="hljs-comment">// HTTPS</span>
  c.header(<span class="hljs-string">'Strict-Transport-Security'</span>, <span class="hljs-string">'max-age=31536000; includeSubDomains'</span>);

  <span class="hljs-comment">// Referrer</span>
  c.header(<span class="hljs-string">'Referrer-Policy'</span>, <span class="hljs-string">'strict-origin-when-cross-origin'</span>);

  <span class="hljs-comment">// Permissions</span>
  c.header(<span class="hljs-string">'Permissions-Policy'</span>, <span class="hljs-string">'geolocation=(), microphone=(), camera=()'</span>);
}
</div></code></pre>
<h3 id="cors-configuration">CORS Configuration</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// backend/src/app.ts</span>
<span class="hljs-keyword">import</span> { Hono } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>;
<span class="hljs-keyword">import</span> { cors } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/cors'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Hono();

app.use(<span class="hljs-string">'*'</span>, cors({
  origin: process.env.FRONTEND_URL || <span class="hljs-string">'http://localhost:3000'</span>,
  credentials: <span class="hljs-literal">true</span>,
  allowMethods: [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'POST'</span>, <span class="hljs-string">'PUT'</span>, <span class="hljs-string">'PATCH'</span>, <span class="hljs-string">'DELETE'</span>, <span class="hljs-string">'OPTIONS'</span>],
  allowHeaders: [<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'Authorization'</span>],
  exposeHeaders: [<span class="hljs-string">'X-Total-Count'</span>],
  maxAge: <span class="hljs-number">86400</span>
}));
</div></code></pre>
<h3 id="additional-security-measures">Additional Security Measures</h3>
<ul>
<li><strong>OAuth2/OIDC + JWT</strong> with token rotation (Supabase/Auth.js). Web user sessions.</li>
<li><strong>HTTPS</strong> with TLS managed by Ingress + Cert-Manager. TLS secrets in K8s.</li>
<li><strong>NetworkPolicies</strong> to isolate pods by namespace/role.</li>
<li><strong>RBAC</strong> in Kubernetes and minimum DB privileges.</li>
<li><strong>Rate limiting</strong> and <strong>WAF</strong> at the gateway level (NGINX/Cloud provider).</li>
<li><strong>CSP, CSRF</strong>, input sanitization and schema validation (Zod/Valibot).</li>
<li><strong>Auditing and Traceability</strong>: structured logs, request correlation.</li>
<li><strong>GDPR</strong>: consent, data deletion, export (academic scope).</li>
</ul>
<hr>
<h2 id="7-devops-cicd-and-gitops-%F0%9F%9A%80">7. DevOps, CI/CD and GitOps ğŸš€</h2>
<ul>
<li>Repositories: <code>frontend/</code>, <code>backend/</code>, <code>infra/</code>.</li>
<li>CI with GitHub Actions: lint, test, build, docker build/push.</li>
<li>CD with <strong>ArgoCD</strong> synchronizing Helm/Kustomize manifests per environment.</li>
<li>Semantic versioning and environments: dev/staging/prod.</li>
<li>n8n jobs versioned (export JSON) and deployed as resource.</li>
</ul>
<h3 id="infrastructure-architecture">Infrastructure Architecture</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "GitHub"
        CODE[Source Code]
        ACTIONS[GitHub Actions]
    end

    subgraph "CI Pipeline"
        BUILD[Build & Test]
        DOCKER[Docker Build]
        PUSH[Push to Registry]
    end

    subgraph "Container Registry"
        GHCR[GitHub Container Registry]
    end

    subgraph "Kubernetes Cluster"
        ARGO[ArgoCD]

        subgraph "Namespaces"
            DEV[dev]
            STAGING[staging]
            PROD[production]
        end

        subgraph "Monitoring"
            PROM[Prometheus]
            GRAF[Grafana]
            LOKI[Loki]
        end
    end

    CODE --> ACTIONS
    ACTIONS --> BUILD
    BUILD --> DOCKER
    DOCKER --> PUSH
    PUSH --> GHCR
    GHCR --> ARGO
    ARGO --> DEV
    ARGO --> STAGING
    ARGO --> PROD

    DEV --> PROM
    STAGING --> PROM
    PROD --> PROM
    PROM --> GRAF
    LOKI --> GRAF
</div></code></pre>
<h3 id="cicd-pipeline">CI/CD Pipeline</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># .github/workflows/ci.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> <span class="hljs-string">[main,</span> <span class="hljs-string">develop]</span>
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> <span class="hljs-string">[main,</span> <span class="hljs-string">develop]</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test-frontend:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'20'</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span> <span class="hljs-string">--frozen-lockfile</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Lint</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">lint</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./frontend</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Type</span> <span class="hljs-string">check</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">type-check</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./frontend</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Unit</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./frontend</span>

  <span class="hljs-attr">test-backend:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'20'</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span> <span class="hljs-string">--frozen-lockfile</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Lint</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">lint</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./backend</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Type</span> <span class="hljs-string">check</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">type-check</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./backend</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Unit</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./backend</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Integration</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">run</span> <span class="hljs-string">test:integration</span>
        <span class="hljs-attr">working-directory:</span> <span class="hljs-string">./backend</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">SUPABASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_SUPABASE_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">SUPABASE_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_SUPABASE_KEY</span> <span class="hljs-string">}}</span>

  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">[test-frontend,</span> <span class="hljs-string">test-backend]</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">github.event_name</span> <span class="hljs-string">==</span> <span class="hljs-string">'push'</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-attr">service:</span> <span class="hljs-string">[frontend,</span> <span class="hljs-string">backend]</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Log</span> <span class="hljs-string">in</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Container</span> <span class="hljs-string">Registry</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/login-action@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">registry:</span> <span class="hljs-string">ghcr.io</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.actor</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Extract</span> <span class="hljs-string">metadata</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">meta</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/metadata-action@v5</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">images:</span> <span class="hljs-string">ghcr.io/${{</span> <span class="hljs-string">github.repository</span> <span class="hljs-string">}}/${{</span> <span class="hljs-string">matrix.service</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">tags:</span> <span class="hljs-string">|
            type=ref,event=branch
            type=sha,prefix={{branch}}-
</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/build-push-action@v5</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">context:</span> <span class="hljs-string">./${{</span> <span class="hljs-string">matrix.service</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">push:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">tags:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.meta.outputs.tags</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">labels:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.meta.outputs.labels</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">cache-from:</span> <span class="hljs-string">type=gha</span>
          <span class="hljs-attr">cache-to:</span> <span class="hljs-string">type=gha,mode=max</span>
</div></code></pre>
<h3 id="cd-pipeline">CD Pipeline</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># .github/workflows/cd-dev.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CD</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Development</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> <span class="hljs-string">[develop]</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Update</span> <span class="hljs-string">image</span> <span class="hljs-string">tags</span> <span class="hljs-string">in</span> <span class="hljs-string">kustomization</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          cd infra/kubernetes/overlays/dev
          kustomize edit set image \
            frontend=ghcr.io/${{ github.repository }}/frontend:develop-${{ github.sha }} \
            backend=ghcr.io/${{ github.repository }}/backend:develop-${{ github.sha }}
</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Commit</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add infra/kubernetes/overlays/dev/kustomization.yaml
          git commit -m "Update dev images to ${{ github.sha }}"
          git push
</span>
      <span class="hljs-comment"># ArgoCD will automatically sync changes</span>
</div></code></pre>
<h3 id="kubernetes-manifests">Kubernetes Manifests</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># infra/kubernetes/base/backend/deployment.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">backend:latest</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3001</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NODE_ENV</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">production</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PORT</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"3001"</span>
        <span class="hljs-attr">envFrom:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">backend-config</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">secretRef:</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">backend-secrets</span>
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"256Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"250m"</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"512Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"500m"</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">3001</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/health/ready</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">3001</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment"># infra/kubernetes/base/backend/service.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">3001</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">http</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment"># infra/kubernetes/base/ingress/ingress.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Ingress</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">gympal-ingress</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">cert-manager.io/cluster-issuer:</span> <span class="hljs-string">letsencrypt-prod</span>
    <span class="hljs-attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="hljs-string">"true"</span>
    <span class="hljs-attr">nginx.ingress.kubernetes.io/rate-limit:</span> <span class="hljs-string">"100"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">ingressClassName:</span> <span class="hljs-string">nginx</span>
  <span class="hljs-attr">tls:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">api.gympal.com</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">app.gympal.com</span>
    <span class="hljs-attr">secretName:</span> <span class="hljs-string">gympal-tls</span>
  <span class="hljs-attr">rules:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">api.gympal.com</span>
    <span class="hljs-attr">http:</span>
      <span class="hljs-attr">paths:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">/</span>
        <span class="hljs-attr">pathType:</span> <span class="hljs-string">Prefix</span>
        <span class="hljs-attr">backend:</span>
          <span class="hljs-attr">service:</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
            <span class="hljs-attr">port:</span>
              <span class="hljs-attr">number:</span> <span class="hljs-number">80</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">app.gympal.com</span>
    <span class="hljs-attr">http:</span>
      <span class="hljs-attr">paths:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">/</span>
        <span class="hljs-attr">pathType:</span> <span class="hljs-string">Prefix</span>
        <span class="hljs-attr">backend:</span>
          <span class="hljs-attr">service:</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
            <span class="hljs-attr">port:</span>
              <span class="hljs-attr">number:</span> <span class="hljs-number">80</span>
</div></code></pre>
<h3 id="kustomization">Kustomization</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># infra/kubernetes/overlays/dev/kustomization.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kustomize.config.k8s.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Kustomization</span>

<span class="hljs-attr">namespace:</span> <span class="hljs-string">gympal-dev</span>

<span class="hljs-attr">bases:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">../../base/backend</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">../../base/frontend</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">../../base/ingress</span>

<span class="hljs-attr">images:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">newName:</span> <span class="hljs-string">ghcr.io/your-org/gympal/backend</span>
    <span class="hljs-attr">newTag:</span> <span class="hljs-string">develop-latest</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
    <span class="hljs-attr">newName:</span> <span class="hljs-string">ghcr.io/your-org/gympal/frontend</span>
    <span class="hljs-attr">newTag:</span> <span class="hljs-string">develop-latest</span>

<span class="hljs-attr">replicas:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">count:</span> <span class="hljs-number">1</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
    <span class="hljs-attr">count:</span> <span class="hljs-number">1</span>

<span class="hljs-attr">configMapGenerator:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend-config</span>
    <span class="hljs-attr">literals:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">API_URL=https://api-dev.gympal.com</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">FRONTEND_URL=https://app-dev.gympal.com</span>

<span class="hljs-attr">secretGenerator:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend-secrets</span>
    <span class="hljs-attr">envs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">secrets.env</span>
</div></code></pre>
<h3 id="docker-compose-local-development">Docker Compose (Local Development)</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">frontend:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">./frontend</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile.dev</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3000:3000"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./frontend:/app</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/app/node_modules</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NEXT_PUBLIC_API_URL=http://localhost:3001</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attr">backend:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">./backend</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile.dev</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3001:3001"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./backend:/app</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/app/node_modules</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=development</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">PORT=3001</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SUPABASE_URL=${SUPABASE_URL}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SUPABASE_KEY=${SUPABASE_KEY}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DIFY_API_KEY=${DIFY_API_KEY}</span>
    <span class="hljs-attr">env_file:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">.env</span>

  <span class="hljs-attr">prometheus:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/prometheus:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9090:9090"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./infra/monitoring/prometheus:/etc/prometheus</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus-data:/prometheus</span>
    <span class="hljs-attr">command:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'--config.file=/etc/prometheus/prometheus.yml'</span>

  <span class="hljs-attr">grafana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/grafana:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3002:3000"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./infra/monitoring/grafana:/etc/grafana/provisioning</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">grafana-data:/var/lib/grafana</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SECURITY_ADMIN_PASSWORD=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_USERS_ALLOW_SIGN_UP=false</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">prometheus-data:</span>
  <span class="hljs-attr">grafana-data:</span>
</div></code></pre>
<h3 id="monitoring">Monitoring</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># infra/monitoring/prometheus/prometheus.yml</span>
<span class="hljs-attr">global:</span>
  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>
  <span class="hljs-attr">evaluation_interval:</span> <span class="hljs-string">15s</span>

<span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'kubernetes-apiservers'</span>
    <span class="hljs-attr">kubernetes_sd_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">endpoints</span>
    <span class="hljs-attr">scheme:</span> <span class="hljs-string">https</span>
    <span class="hljs-attr">tls_config:</span>
      <span class="hljs-attr">ca_file:</span> <span class="hljs-string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>
    <span class="hljs-attr">bearer_token_file:</span> <span class="hljs-string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>
    <span class="hljs-attr">relabel_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> <span class="hljs-string">[__meta_kubernetes_namespace,</span> <span class="hljs-string">__meta_kubernetes_service_name,</span> <span class="hljs-string">__meta_kubernetes_endpoint_port_name]</span>
      <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span>
      <span class="hljs-attr">regex:</span> <span class="hljs-string">default;kubernetes;https</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'backend'</span>
    <span class="hljs-attr">kubernetes_sd_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span>
    <span class="hljs-attr">relabel_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> <span class="hljs-string">[__meta_kubernetes_pod_label_app]</span>
      <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span>
      <span class="hljs-attr">regex:</span> <span class="hljs-string">backend</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> <span class="hljs-string">[__meta_kubernetes_pod_ip]</span>
      <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span>
      <span class="hljs-attr">replacement:</span> <span class="hljs-string">${1}:3001</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'frontend'</span>
    <span class="hljs-attr">kubernetes_sd_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span>
    <span class="hljs-attr">relabel_configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> <span class="hljs-string">[__meta_kubernetes_pod_label_app]</span>
      <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span>
      <span class="hljs-attr">regex:</span> <span class="hljs-string">frontend</span>
</div></code></pre>
<hr>
<h2 id="8-monitoring-and-observability-%F0%9F%93%88">8. Monitoring and Observability ğŸ“ˆ</h2>
<ul>
<li><strong>Prometheus</strong>: app, K8s and DB metrics.</li>
<li><strong>Grafana</strong>: business and system dashboards.</li>
<li><strong>Promtail</strong>: log collection (to Loki or equivalent system).</li>
<li>SLI alerts: API latency, 5xx errors, n8n queues, K8s resources.</li>
</ul>
<p>Dashboards:</p>
<ul>
<li>Active users, retention, post and comment creation.</li>
<li>AI generations/day, success rate, Dify latency.</li>
<li>Plan compliance: workouts/diets completed per week.</li>
</ul>
<hr>
<h2 id="9-work-plan-and-team-organization-%F0%9F%91%A5">9. Work Plan and Team Organization ğŸ‘¥</h2>
<h3 id="roles">Roles</h3>
<ul>
<li><strong>Frontend</strong>: Next.js, UI/UX, accessibility, state and SSR.</li>
<li><strong>Backend</strong>: Hono APIs, models, validation, performance.</li>
<li><strong>DevOps/SRE</strong>: K8s, ArgoCD, observability, cluster security.</li>
<li><strong>AI/Integrations</strong>: Dify, prompts, recommendations, evaluation; n8n chatbots.</li>
<li><strong>Product/QA</strong>: documentation, backlog, E2E tests, UX research.</li>
</ul>
<h3 id="roadmap-october---december-2025">Roadmap (October - December 2025)</h3>
<h4 id="phase-1-initial-setup-7-oct---3-nov">Phase 1: Initial Setup (7 Oct - 3 Nov)</h4>
<ul>
<li><strong>Week 1 (7-13 Oct)</strong>: Requirements analysis, domain design, architecture</li>
<li><strong>Week 2 (14-20 Oct)</strong>: Next.js + TypeScript + Tailwind CSS setup</li>
<li><strong>Week 3 (21-27 Oct)</strong>: Hono backend + Supabase setup</li>
<li><strong>Week 4 (28 Oct - 3 Nov)</strong>: Complete frontend-backend integration</li>
</ul>
<h4 id="phase-2-backend-core-4-nov---24-nov">Phase 2: Backend Core (4 Nov - 24 Nov)</h4>
<ul>
<li><strong>Week 5 (4-10 Nov)</strong>: REST APIs for users, authentication</li>
<li><strong>Week 6 (11-17 Nov)</strong>: Workout/Nutrition modules (CRUD)</li>
<li><strong>Week 7 (18-24 Nov)</strong>: Basic social, OpenAPI, progress presentation (24 Oct)</li>
<li><strong>Milestone</strong>: Progress presentation on October 24</li>
</ul>
<h4 id="phase-3-ai-integration-25-nov---8-dec">Phase 3: AI Integration (25 Nov - 8 Dec)</h4>
<ul>
<li><strong>Week 8 (25 Nov - 1 Dec)</strong>: Web chatbot + Dify AI, Demo 1 (25 Nov)</li>
<li><strong>Week 9 (2-8 Dec)</strong>: n8n workflows, recommendations, Demo 2 (28 Nov)</li>
<li><strong>Milestones</strong>: Project demos on November 25 and 28</li>
</ul>
<h4 id="phase-4-devops--scale-9-dec---19-dec">Phase 4: DevOps &amp; Scale (9 Dec - 19 Dec)</h4>
<ul>
<li><strong>Week 10 (9-12 Dec)</strong>: Kubernetes + ArgoCD, final delivery (9 Dec)</li>
<li><strong>Week 11 (13-16 Dec)</strong>: Observability, security hardening</li>
<li><strong>Week 12 (17-19 Dec)</strong>: UX polish, E2E tests, final documentation</li>
<li><strong>Milestones</strong>:
<ul>
<li>December 9: Final project delivery + draft report + final presentation</li>
<li>December 19: Project README + final report version</li>
</ul>
</li>
</ul>
<h3 id="delivery-schedule">Delivery Schedule</h3>
<ul>
<li><strong>October 24</strong>: Progress presentation</li>
<li><strong>November 25</strong>: Project demo (part 1)</li>
<li><strong>November 28</strong>: Project demo (part 2)</li>
<li><strong>December 9</strong>: Final delivery + draft report + final presentation</li>
<li><strong>December 19</strong>: README + final report</li>
</ul>
<hr>
<h2 id="10-methodology-standards-and-quality-%F0%9F%A7%AD">10. Methodology, Standards and Quality ğŸ§­</h2>
<ul>
<li><strong>Light SCRUM</strong>: 2-week sprints, brief dailies, review/retro.</li>
<li><strong>Conventions</strong>: Strict TypeScript, ESLint/Prettier, conventional commits.</li>
<li><strong>Testing</strong>: unit (Vitest/Jest), integration (Supertest), E2E (Playwright/Cypress).</li>
<li><strong>Docs</strong>: OpenAPI, ADRs, diagrams (Mermaid), service READMEs.</li>
</ul>
<hr>
<h2 id="11-communication-flows-and-orchestration-%F0%9F%94%84">11. Communication Flows and Orchestration ğŸ”„</h2>
<h3 id="diagram-registration-and-authentication-flow">Diagram: Registration and Authentication Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant AUTH as Auth Service
  U->>FE: Complete registration form
  FE->>API: POST /auth/register
  API->>AUTH: Validate and create user
  AUTH-->>API: User created + tokens
  API-->>FE: 201 Created + JWT
  FE->>API: POST /auth/login
  API->>AUTH: Validate credentials
  AUTH-->>API: JWT
  API-->>FE: 200 OK + tokens
</div></code></pre>
<h3 id="diagram-workout-routine-generation-and-tracking">Diagram: Workout Routine Generation and Tracking</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant WO as Workout Service
  participant D as Dify AI
  U->>FE: Request new routine
  FE->>API: POST /workouts (goals)
  API->>WO: Create routine
  WO->>D: AI suggestion
  D-->>WO: Routine generated
  WO-->>API: Routine saved
  API-->>FE: 201 Created (planId)
  FE->>API: POST /workouts/:id/logs
  API->>WO: Register progress
  WO-->>API: OK
  API-->>FE: Updated metrics
</div></code></pre>
<h3 id="diagram-social-interaction-follow-notify-feed">Diagram: Social Interaction (follow, notify, feed)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  participant NOTIF as Notification Service
  U->>FE: Follow another user
  FE->>API: POST /users/:id/follow
  API->>SO: Register follow
  SO-->>API: Updated state
  API-->>FE: Updated UI
  SO->>NOTIF: Notify followed
  NOTIF-->>FE: Push notification
  U->>FE: Open feed
  FE->>API: GET /feed
  API->>SO: Get posts
  SO-->>API: Posts
  API-->>FE: Render feed
</div></code></pre>
<h3 id="diagram-social-post-lifecycle">Diagram: Social Post Lifecycle</h3>
<pre><code class="language-mermaid"><div class="mermaid">stateDiagram-v2
  [*] --> Creation
  Creation --> Notification: Post created
  Notification --> Interaction: Likes/Comments
  Interaction --> Moderation: Report
  Moderation --> Review: Admin reviews
  Review --> Action: Delete/Warn/Hide
  Action --> [*]
</div></code></pre>
<h3 id="n8n-flows-examples">n8n Flows (examples)</h3>
<h4 id="1-workflow-telegram-chatbot">1. Workflow: Telegram Chatbot</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Telegram Bot Workflow"
    START[Webhook Telegram]
    PARSE[Parse Message]
    AUTH[Check User Auth]
    CONTEXT[Get User Context]
    DIFY[Call Dify AI]
    RESPONSE[Format Response]
    SEND[Send to Telegram]
    LOG[Log Interaction]
  end

  START --> PARSE
  PARSE --> AUTH
  AUTH --> CONTEXT
  CONTEXT --> DIFY
  DIFY --> RESPONSE
  RESPONSE --> SEND
  SEND --> LOG
</div></code></pre>
<h4 id="2-workflow-daily-reminders">2. Workflow: Daily Reminders</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Daily Reminder Workflow"
    CRON[Cron Trigger - 8:00 AM]
    USERS[Get Active Users]
    PROGRESS[Check Yesterday Progress]
    MOTIVATION[Generate Motivational Message]
    SEND_EMAIL[Send Email]
    SEND_TELEGRAM[Send Telegram]
    UPDATE_METRICS[Update Metrics]
  end

  CRON --> USERS
  USERS --> PROGRESS
  PROGRESS --> MOTIVATION
  MOTIVATION --> SEND_EMAIL
  MOTIVATION --> SEND_TELEGRAM
  SEND_EMAIL --> UPDATE_METRICS
  SEND_TELEGRAM --> UPDATE_METRICS
</div></code></pre>
<h4 id="3-workflow-content-moderation">3. Workflow: Content Moderation</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Content Moderation Workflow"
    TRIGGER[New Post/Comment]
    AI_CHECK[AI Content Check]
    FLAG_CHECK[Check for Flags]
    SCORE[Calculate Risk Score]
    DECISION{Score > Threshold?}
    AUTO_ACTION[Auto Action]
    MANUAL_REVIEW[Manual Review]
    NOTIFY[Notify Moderators]
  end

  TRIGGER --> AI_CHECK
  AI_CHECK --> FLAG_CHECK
  FLAG_CHECK --> SCORE
  SCORE --> DECISION
  DECISION -->|High| AUTO_ACTION
  DECISION -->|Medium| MANUAL_REVIEW
  DECISION -->|Low| NOTIFY
  AUTO_ACTION --> NOTIFY
  MANUAL_REVIEW --> NOTIFY
</div></code></pre>
<h4 id="4-workflow-ai-plan-generation">4. Workflow: AI Plan Generation</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "AI Plan Generation Workflow"
    REQUEST[Plan Generation Request]
    USER_DATA[Fetch User Data]
    PREFERENCES[Get Preferences]
    DIFY_CALL[Call Dify AI]
    VALIDATE[Validate Plan]
    SAVE[Save to Database]
    NOTIFY[Notify User]
    SCHEDULE[Add to Schedule]
  end

  REQUEST --> USER_DATA
  USER_DATA --> PREFERENCES
  PREFERENCES --> DIFY_CALL
  DIFY_CALL --> VALIDATE
  VALIDATE --> SAVE
  SAVE --> NOTIFY
  SAVE --> SCHEDULE
</div></code></pre>
<h4 id="5-workflow-calorie-tracking-notifications">5. Workflow: Calorie Tracking Notifications</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Calorie Tracking Workflow"
    LOG[Calorie Log Entry]
    GOAL_CHECK[Check Daily Goal]
    PROGRESS[Calculate Progress]
    ALERT{Goal Reached?}
    CONGRATULATE[Send Congratulations]
    REMINDER[Send Reminder]
    UPDATE_STREAK[Update Streak]
  end

  LOG --> GOAL_CHECK
  GOAL_CHECK --> PROGRESS
  PROGRESS --> ALERT
  ALERT -->|Yes| CONGRATULATE
  ALERT -->|No| REMINDER
  CONGRATULATE --> UPDATE_STREAK
  REMINDER --> UPDATE_STREAK
</div></code></pre>
<h4 id="6-workflow-social-engagement">6. Workflow: Social Engagement</h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Social Engagement Workflow"
    POST[New Post Created]
    FOLLOWERS[Get Followers]
    FILTER[Filter Active Users]
    NOTIFY[Send Notifications]
    TREND_CHECK[Check Trending]
    BOOST[Boost if Trending]
    ANALYTICS[Update Analytics]
  end

  POST --> FOLLOWERS
  FOLLOWERS --> FILTER
  FILTER --> NOTIFY
  POST --> TREND_CHECK
  TREND_CHECK --> BOOST
  BOOST --> ANALYTICS
  NOTIFY --> ANALYTICS
</div></code></pre>
<h3 id="sequence-web-ai-chat">Sequence (Web AI Chat)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant BE as Backend
  participant D as Dify
  U->>FE: Prompt
  FE->>BE: POST /ai/chat (JWT)
  BE->>D: Request (user context)
  D-->>BE: AI response
  BE-->>FE: Message + traces
</div></code></pre>
<h3 id="sequence-workout-plan-generation">Sequence (workout plan generation)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant WO as Workout Service
  participant D as Dify
  U->>FE: Request weekly plan
  FE->>API: POST /workouts (goals, time, level)
  API->>WO: Create/generate plan
  WO->>D: Request AI suggestion (template + progression)
  D-->>WO: Proposed plan
  WO->>API: Save plan in DB and return ID
  API-->>FE: 201 Created (planId)
  FE-->>U: Show plan and calendar
</div></code></pre>
<h3 id="sequence-social-post-and-notification">Sequence (social post and notification)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  participant N8 as n8n
  participant EM as Email/Telegram
  U->>FE: Write post with photo
  FE->>API: POST /posts
  API->>SO: Create post and save media
  SO-->>API: Post created
  API-->>FE: 201 Created
  API->>N8: New post event
  N8->>EM: Notify followers
</div></code></pre>
<hr>
<h3 id="social-interactions-post-feed-like-comment">Social Interactions: Post, Feed, Like, Comment</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  participant WS as WebSocket Gateway
  U->>FE: Create post (type: achievement/routine/tip/progress)
  FE->>API: POST /posts {type, content, media}
  API->>SO: Create post
  SO-->>API: 201 {postId}
  API-->>FE: 201 {postId}
  SO->>WS: event(PostCreated)
  WS-->>FE: push to followers
  U->>FE: Like post
  FE->>API: POST /posts/:id/like
  API->>SO: Register like
  SO->>WS: event(PostLiked)
  U->>FE: Comment post
  FE->>API: POST /posts/:id/comments {content}
  API->>SO: Create comment
  SO->>WS: event(CommentCreated)
</div></code></pre>
<h3 id="basic-moderation-reports">Basic Moderation (reports)</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API
  participant SO as Social Service
  participant ADMIN as Admin Panel
  U->>FE: Report post/comment
  FE->>API: POST /moderation/report {entity,id,reason}
  API->>SO: Save report (status: pending)
  ADMIN->>SO: Review report queue
  SO-->>ADMIN: Details
  ADMIN->>SO: Action (hide/delete/warn)
  SO-->>API: Updated status
</div></code></pre>
<h3 id="user-interaction-diagrams-mermaid">User Interaction Diagrams (Mermaid)</h3>
<h3 id="publish-post">Publish Post</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  U->>FE: Write new post
  FE->>API: POST /posts {content, media}
  API->>SO: Create post
  SO-->>API: Post created
  API-->>FE: 201 Created
  FE-->>U: Show post in feed
</div></code></pre>
<h3 id="view-feed">View Feed</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  U->>FE: Open feed
  FE->>API: GET /feed?type=all
  API->>SO: Get posts
  SO-->>API: List of posts
  API-->>FE: Posts and metadata
  FE-->>U: Render feed
</div></code></pre>
<h3 id="like-and-comment">Like and Comment</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  participant WS as WebSocket Gateway
  U->>FE: Like a post
  FE->>API: POST /posts/:id/like
  API->>SO: Register like
  SO->>WS: event(PostLiked)
  WS-->>FE: Update likes in real time
  U->>FE: Comment post
  FE->>API: POST /posts/:id/comments {content}
  API->>SO: Create comment
  SO->>WS: event(CommentCreated)
  WS-->>FE: Show new comment
</div></code></pre>
<h3 id="follow-user">Follow User</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  U->>FE: Click on follow user
  FE->>API: POST /users/:id/follow
  API->>SO: Register follow
  SO-->>API: Updated state
  API-->>FE: Update UI (following)
</div></code></pre>
<h3 id="content-moderation">Content Moderation</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as API Gateway
  participant SO as Social Service
  participant ADMIN as Admin Panel
  U->>FE: Report post/comment
  FE->>API: POST /moderation/report {entity, id, reason}
  API->>SO: Save report
  ADMIN->>SO: Review reports
  SO-->>ADMIN: Details and actions
  ADMIN->>SO: Action (hide/delete/warn)
  SO-->>API: Updated status
</div></code></pre>
<hr>
<h3 id="backend-class-diagram-social">Backend Class Diagram (Social)</h3>
<pre><code class="language-mermaid"><div class="mermaid">classDiagram
  %% === CORE SOCIAL ENTITIES ===
  class Post {
    +id: UUID
    +userId: UUID
    +content: string
    +postType: PostType
    +workoutId: UUID?
    +imageUrls: string[]
    +videoUrl: string?
    +hashtags: string[]
    +likesCount: number
    +commentsCount: number
    +sharesCount: number
    +repostsCount: number
    +isPublic: boolean
    +isOriginal: boolean
    +originalPostId: UUID?
    +sharedFromUserId: UUID?
    +createdAt: Date
    +updatedAt: Date
    +addComment(comment: Comment)
    +addLike(userId: UUID)
    +removeLike(userId: UUID)
    +addShare(userId: UUID)
    +addRepost(userId: UUID)
    +addMedia(media: Media)
    +updateCounts()
    +validateContent()
  }

  class PostComment {
    +id: UUID
    +postId: UUID
    +userId: UUID
    +content: string
    +parentCommentId: UUID?
    +createdAt: Date
    +updatedAt: Date
    +edit(newContent: string)
    +delete()
    +addReply(reply: PostComment)
    +validateContent()
  }

  class PostLike {
    +id: UUID
    +postId: UUID
    +userId: UUID
    +createdAt: Date
    +toggle()
    +isLikedBy(userId: UUID): boolean
  }

  class PostShare {
    +id: UUID
    +postId: UUID
    +sharedByUserId: UUID
    +sharedWithUserId: UUID
    +shareType: ShareType
    +sharedAt: Date
    +execute()
    +notifyRecipient()
  }

  class PostRepost {
    +id: UUID
    +originalPostId: UUID
    +repostedByUserId: UUID
    +repostedAt: Date
    +execute()
    +notifyOriginalAuthor()
  }

  class Follow {
    +id: UUID
    +followerId: UUID
    +followingId: UUID
    +createdAt: Date
    +follow()
    +unfollow()
    +isFollowing(userId: UUID): boolean
    +getFollowersCount(): number
    +getFollowingCount(): number
  }

  class Notification {
    +id: UUID
    +userId: UUID
    +type: NotificationType
    +title: string
    +content: string
    +data: JSON
    +isRead: boolean
    +createdAt: Date
    +markAsRead()
    +markAsUnread()
    +sendPush()
    +sendEmail()
  }

  class Media {
    +id: UUID
    +url: string
    +type: MediaType
    +size: number
    +mimeType: string
    +uploadedBy: UUID
    +uploadedAt: Date
    +process()
    +optimize()
    +generateThumbnail()
    +delete()
  }

  class ModerationReport {
    +id: UUID
    +entityType: EntityType
    +entityId: UUID
    +reportedBy: UUID
    +reason: ReportReason
    +description: string
    +status: ReportStatus
    +reviewedBy: UUID?
    +reviewedAt: Date?
    +createdAt: Date
    +submit()
    +review(reviewerId: UUID)
    +resolve(action: ModerationAction)
    +escalate()
  }

  class SocialService {
    +createPost(userId: UUID, postData: CreatePostDTO): Post
    +getFeed(userId: UUID, filters: FeedFilters): FeedResponse
    +likePost(userId: UUID, postId: UUID): PostLike
    +unlikePost(userId: UUID, postId: UUID): boolean
    +addComment(userId: UUID, postId: UUID, content: string): PostComment
    +followUser(followerId: UUID, followingId: UUID): Follow
    +unfollowUser(followerId: UUID, followingId: UUID): boolean
    +sharePost(userId: UUID, postId: UUID, shareData: ShareDTO): PostShare
    +repostPost(userId: UUID, originalPostId: UUID): PostRepost
    +reportContent(userId: UUID, reportData: ReportDTO): ModerationReport
    +getNotifications(userId: UUID): Notification[]
    +markNotificationAsRead(userId: UUID, notificationId: UUID): boolean
    +getUserFeed(userId: UUID, targetUserId: UUID): Post[]
    +searchPosts(query: string, filters: SearchFilters): Post[]
  }

  class PostType {
    <<enumeration>>
    ACHIEVEMENT
    ROUTINE
    TIP
    PROGRESS
    MOTIVATION
    QUESTION
    GENERAL
  }

  class ShareType {
    <<enumeration>>
    SHARE
    REPOST
    FORWARD
  }

  class NotificationType {
    <<enumeration>>
    LIKE
    COMMENT
    FOLLOW
    SHARE
    REPOST
    MENTION
    WORKOUT_COMPLETED
    ACHIEVEMENT_UNLOCKED
  }

  class ReportReason {
    <<enumeration>>
    SPAM
    HARASSMENT
    INAPPROPRIATE_CONTENT
    COPYRIGHT_VIOLATION
    FAKE_INFORMATION
    OTHER
  }

  %% === RELATIONSHIPS ===
  Post "1" --> "*" PostComment : "has comments"
  Post "1" --> "*" PostLike : "receives likes"
  Post "1" --> "*" PostShare : "is shared"
  Post "1" --> "*" PostRepost : "is reposted"
  Post "1" --> "*" ModerationReport : "can be reported"
  Post "1" --> "*" Media : "contains media"
  PostComment "1" --> "*" PostComment : "has replies"

  SocialService ..> Post
  SocialService ..> PostComment
  SocialService ..> PostLike
  SocialService ..> PostShare
  SocialService ..> PostRepost
  SocialService ..> Follow
  SocialService ..> Notification
  SocialService ..> ModerationReport
  SocialService ..> Media

  Post --> PostType
  PostShare --> ShareType
  Notification --> NotificationType
  ModerationReport --> ReportReason

</div></code></pre>
<h3 id="frontend-class-diagram-social">Frontend Class Diagram (Social)</h3>
<pre><code class="language-mermaid"><div class="mermaid">classDiagram
    class SocialApiClient {
        +string baseUrl
        +string authToken
        +get(string path, QueryParams params) Promise~T~
        +post(string path, any body) Promise~T~
        +put(string path, any body) Promise~T~
        +delete(string path) Promise~boolean~
        +uploadMedia(File file) Promise~MediaDTO~
        +setAuthToken(string token)
        +handleError(ApiError error)
    }

    class SocialStore {
        +Map~UUID, PostDTO~ posts
        +Map~UUID, UserDTO~ users
        +FeedItem[] feedItems
        +NotificationDTO[] notifications
        +boolean isLoading
        +string error
        +Date lastFetchTime
        +loadFeed(FeedFilters filters) Promise~void~
        +loadPost(UUID postId) Promise~PostDTO~
        +loadUser(UUID userId) Promise~UserDTO~
        +loadNotifications() Promise~void~
        +refreshFeed() Promise~void~
        +clearError()
        +reset()
    }

  class FeedStore {
        +FeedItem[] items
        +boolean hasMore
        +boolean isLoading
        +FeedFilters filters
        +loadFeed(FeedFilters filters) Promise~void~
        +loadMore() Promise~void~
        +refresh() Promise~void~
        +likePost(UUID postId) Promise~void~
        +unlikePost(UUID postId) Promise~void~
        +addComment(UUID postId, string content) Promise~void~
        +followUser(UUID userId) Promise~void~
        +unfollowUser(UUID userId) Promise~void~
        +sharePost(UUID postId, ShareDTO shareData) Promise~void~
        +repostPost(UUID postId) Promise~void~
        +reportPost(UUID postId, string reason) Promise~void~
        +updateItem(FeedItem item)
        +removeItem(UUID postId)
    +subscribeRealtime()
        +unsubscribeRealtime()
    }

    class NotificationStore {
        +NotificationDTO[] notifications
        +number unreadCount
        +boolean isLoading
        +loadNotifications() Promise~void~
        +markAsRead(UUID notificationId) Promise~void~
        +markAllAsRead() Promise~void~
        +deleteNotification(UUID notificationId) Promise~void~
        +subscribeRealtime()
        +unsubscribeRealtime()
        +updateUnreadCount()
    }

  class FeedItem {
        +PostDTO post
        +UserDTO author
        +CommentDTO[] comments
        +number likes
        +number shares
        +number reposts
        +MediaDTO[] media
        +boolean isLiked
        +boolean isShared
        +boolean isReposted
        +boolean isFollowed
        +boolean canEdit
        +boolean canDelete
        +onLike()
        +onComment()
        +onShare()
        +onRepost()
        +onFollow()
        +onReport()
        +onEdit()
        +onDelete()
        +render() JSX.Element
    }

    class PostComposer {
        +PostType type
        +string content
        +MediaDTO[] media
        +string[] hashtags
        +UUID workoutId
        +boolean isSubmitting
        +number charCount
        +number maxChars
        +setContent(string content)
        +setType(PostType type)
        +addMedia(MediaDTO media)
        +removeMedia(UUID mediaId)
        +addHashtag(string tag)
        +removeHashtag(string tag)
        +setWorkout(UUID workoutId)
        +clearWorkout()
        +submit() Promise~void~
        +validate() boolean
        +reset()
    }

    class CommentSection {
        +UUID postId
        +CommentDTO[] comments
        +boolean isLoading
        +boolean hasMore
        +string newComment
        +UUID replyingTo
        +loadComments() Promise~void~
        +loadMoreComments() Promise~void~
        +addComment(string content) Promise~void~
        +replyToComment(UUID commentId, string content) Promise~void~
        +editComment(UUID commentId, string content) Promise~void~
        +deleteComment(UUID commentId) Promise~void~
        +likeComment(UUID commentId) Promise~void~
        +setReplyingTo(UUID commentId)
        +render() JSX.Element
    }

  class RealtimeClient {
        +WebSocket socket
        +boolean isConnected
        +Set~string~ subscriptions
        +number reconnectAttempts
        +number maxReconnectAttempts
        +connect() Promise~void~
        +disconnect()
        +subscribe(string topic)
        +unsubscribe(string topic)
        +onEvent(RealtimeEvent event, Function callback)
        +offEvent(RealtimeEvent event, Function callback)
        +emit(string event, any data)
        +handleReconnect()
    }

    class PostDTO {
        +UUID id
        +UUID userId
        +string content
        +PostType postType
        +UUID workoutId
        +string[] imageUrls
        +string videoUrl
        +string[] hashtags
        +number likesCount
        +number commentsCount
        +number sharesCount
        +number repostsCount
        +boolean isPublic
        +boolean isOriginal
        +UUID originalPostId
        +UUID sharedFromUserId
        +Date createdAt
        +Date updatedAt
    }

    class UserDTO {
        +UUID id
        +string username
        +string fullName
        +string avatarUrl
        +string bio
        +string fitnessLevel
        +number followersCount
        +number followingCount
        +number postsCount
        +boolean isFollowing
        +boolean isFollowed
        +boolean isVerified
    }

    class CommentDTO {
        +UUID id
        +UUID postId
        +UUID userId
        +string content
        +UUID parentCommentId
        +number likesCount
        +number repliesCount
        +boolean isLiked
        +boolean canEdit
        +boolean canDelete
        +Date createdAt
        +Date updatedAt
        +UserDTO author
    }

    class MediaDTO {
        +UUID id
        +string url
        +MediaType type
        +number size
        +string mimeType
        +string thumbnailUrl
        +Date uploadedAt
    }

    class NotificationDTO {
        +UUID id
        +UUID userId
        +NotificationType type
        +string title
        +string content
        +JSON data
        +boolean isRead
        +Date createdAt
        +string actionUrl
    }

    class PostType {
        <<enumeration>>
        ACHIEVEMENT
        ROUTINE
        TIP
        PROGRESS
        MOTIVATION
        QUESTION
        GENERAL
    }

    class MediaType {
        <<enumeration>>
        IMAGE
        VIDEO
        GIF
        AUDIO
    }

    class NotificationType {
        <<enumeration>>
        LIKE
        COMMENT
        FOLLOW
        SHARE
        REPOST
        MENTION
        WORKOUT_COMPLETED
        ACHIEVEMENT_UNLOCKED
    }

    SocialApiClient ..> SocialStore : "uses"
    SocialApiClient ..> FeedStore : "uses"
    SocialApiClient ..> NotificationStore : "uses"
    SocialApiClient ..> PostComposer : "uses"

    RealtimeClient ..> SocialStore : "updates"
    RealtimeClient ..> FeedStore : "updates"
    RealtimeClient ..> NotificationStore : "updates"

    SocialStore o-- FeedStore : "contains"
    SocialStore o-- NotificationStore : "contains"

    FeedStore o-- FeedItem : "manages"
    FeedItem o-- CommentSection : "contains"

    FeedItem --> PostDTO : "displays"
    FeedItem --> UserDTO : "displays"
    FeedItem --> MediaDTO : "displays"

    CommentSection --> CommentDTO : "displays"
    CommentSection --> UserDTO : "displays"

    PostComposer --> PostType : "uses"
    PostComposer --> MediaDTO : "manages"

    NotificationStore --> NotificationDTO : "manages"
    NotificationDTO --> NotificationType : "uses"

    PostDTO --> PostType : "uses"
    MediaDTO --> MediaType : "uses"
</div></code></pre>
<hr>
<h3 id="er-training-data-flow">ER: Training Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
  USER ||--o{ WORKOUT : "has"
  WORKOUT ||--o{ WORKOUT_LOG : "logs"
  WORKOUT_LOG {
    uuid id PK
    uuid workout_id FK
    date log_date
    jsonb metrics
  }
  WORKOUT {
    uuid id PK
    uuid user_id FK
    jsonb plan
    jsonb progress
  }
  USER {
    uuid id PK
    text email
    text display_name
  }
</div></code></pre>
<h3 id="er-nutrition-data-flow">ER: Nutrition Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
  USER ||--o{ DIET : "has"
  DIET ||--o{ DIET_DAY : "plans"
  DIET_DAY ||--o{ MEAL : "includes"
  MEAL ||--o{ FOOD_ITEM : "contains"
  DIET {
    uuid id PK
    uuid user_id FK
    jsonb plan
  }
  DIET_DAY {
    uuid id PK
    uuid diet_id FK
    int day_of_week
  }
  MEAL {
    uuid id PK
    uuid diet_day_id FK
    time meal_time
  }
  FOOD_ITEM {
    uuid id PK
    text name
    int calories
    int proteinGrams
    int carbsGrams
    int fatGrams
  }
</div></code></pre>
<h3 id="er-social-data-flow">ER: Social Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
  USER ||--o{ POST : "writes"
  POST ||--o{ COMMENT : "has"
  POST ||--o{ LIKE : "receives"
  USER ||--o{ FOLLOW : "follows"
  POST {
    uuid id PK
    uuid user_id FK
    text content
    jsonb media
    int likes
  }
  COMMENT {
    uuid id PK
    uuid post_id FK
    uuid user_id FK
    text content
  }
  LIKE {
    uuid id PK
    uuid post_id FK
    uuid user_id FK
  }
  FOLLOW {
    uuid follower_id FK
    uuid followee_id FK
  }
</div></code></pre>
<h3 id="er-ai-recommendations-data-flow">ER: AI Recommendations Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
  USER ||--o{ RECOMMENDATION : "receives"
  RECOMMENDATION {
    uuid id PK
    uuid user_id FK
    text type
    text content
    date created_at
  }
</div></code></pre>
<h3 id="er-notifications-data-flow">ER: Notifications Data Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
  USER ||--o{ NOTIFICATION : "receives"
  NOTIFICATION {
    uuid id PK
    uuid user_id FK
    text type
    text content
    bool read
    date created_at
  }
</div></code></pre>
<hr>
<h3 id="dependencies-and-health-checks">Dependencies and Health Checks</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
  subgraph Externals
    SUPA[Supabase]
    DIFY[Dify]
    N8N[n8n]
    SMTP[SMTP]
  end

  subgraph Services
    API[API /health]
    USER[User /health]
    WORKOUT[Workout /health]
    NUTR[Nutrition /health]
    SOCIAL[Social /health]
    CHAT[Chat /health]
    RECO[Reco /health]
    NOTIF[Notif /health]
  end

  USER --> SUPA
  WORKOUT --> SUPA
  NUTR --> SUPA
  SOCIAL --> SUPA
  CHAT --> N8N
  RECO --> DIFY
  NOTIF --> SMTP
  API --> USER
  API --> WORKOUT
  API --> NUTR
  API --> SOCIAL
  API --> CHAT
  API --> RECO
  API --> NOTIF
</div></code></pre>
<hr>
<h3 id="threat-model-and-security">Threat Model and Security</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph Threats
    INJ[Injections]
    XSS[XSS]
    CSRF[CSRF]
    DDOS[DDoS]
    LEAK[Data Leak]
  end

  subgraph Controls
    WAF[WAF + Rate limit]
    AUTH[OAuth2/OIDC + JWT]
    VALID[Validation/Zod]
    TLS[TLS/HTTPS]
    RBAC[RBAC/K8s Policies]
    LOGS[Audit/Trace]
    CSP[CSP/Headers]
  end

  INJ --> VALID
  XSS --> CSP
  CSRF --> AUTH
  DDOS --> WAF
  LEAK --> RBAC
  AUTH --> LOGS
  TLS --> AUTH
</div></code></pre>
<hr>
<h3 id="monitoring--observability-stack">Monitoring &amp; Observability Stack</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph Metrics
    PROM[Prometheus]
    GRAF[Grafana]
    ALERT[Alertmanager]
  end
  subgraph Logs
    PROMTAIL[Promtail]
    LOKI[Loki]
  end
  subgraph Traces
    OTEL[OpenTelemetry]
    JAEGER[Jaeger (optional)]
  end

  PROM --> GRAF
  PROM --> ALERT
  PROMTAIL --> LOKI --> GRAF
  OTEL --> JAEGER
</div></code></pre>
<hr>
<h2 id="12-ai-integration-chatbot-and-recommender-%F0%9F%A4%96">12. AI Integration (Chatbot and Recommender) ğŸ¤–</h2>
<h3 id="ai-architecture">AI Architecture</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Frontend"
    CHAT_UI[Chat Interface]
    RECO_UI[Recommendation Cards]
  end
  
  subgraph "Backend AI Services"
    AI_GATEWAY[AI Gateway]
    CHAT_SVC[Chat Service]
    RECO_SVC[Recommendation Service]
    CONTEXT_SVC[Context Service]
  end
  
  subgraph "AI Platforms"
    DIFY[Dify AI Platform]
    N8N[n8n Workflows]
  end
  
  subgraph "Data Sources"
    USER_DATA[User Profile & History]
    WORKOUT_DATA[Workout Data]
    NUTR_DATA[Nutrition Data]
    SOCIAL_DATA[Social Interactions]
  end
  
  subgraph "External AI"
    OPENAI[OpenAI GPT]
    ANTHROPIC[Anthropic Claude]
    CUSTOM[Custom Models]
  end
  
  CHAT_UI --> AI_GATEWAY
  RECO_UI --> AI_GATEWAY
  
  AI_GATEWAY --> CHAT_SVC
  AI_GATEWAY --> RECO_SVC
  AI_GATEWAY --> CONTEXT_SVC
  
  CHAT_SVC --> DIFY
  RECO_SVC --> DIFY
  CONTEXT_SVC --> USER_DATA
  CONTEXT_SVC --> WORKOUT_DATA
  CONTEXT_SVC --> NUTR_DATA
  CONTEXT_SVC --> SOCIAL_DATA
  
  DIFY --> OPENAI
  DIFY --> ANTHROPIC
  DIFY --> CUSTOM
  
  N8N --> DIFY
</div></code></pre>
<h3 id="ai-chatbot-flow">AI Chatbot Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant AI as AI Gateway
  participant CTX as Context Service
  participant DIFY as Dify AI
  participant DB as Database
  
  U->>FE: Send message
  FE->>AI: POST /ai/chat {message, sessionId}
  AI->>CTX: Get user context
  CTX->>DB: Query profile + history
  DB-->>CTX: User data
  CTX-->>AI: Enriched context
  AI->>DIFY: Request with context
  DIFY->>DIFY: Process with LLM
  DIFY-->>AI: AI response
  AI->>DB: Save conversation
  AI-->>FE: Response + metadata
  FE-->>U: Show response
</div></code></pre>
<h3 id="recommendation-system">Recommendation System</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Input Data"
    PROFILE[User Profile]
    HISTORY[Activity History]
    SOCIAL[Social Interactions]
    PREFERENCES[Preferences]
  end
  
  subgraph "Processing"
    FEATURE[Feature Engineering]
    EMBED[Embeddings]
    COLLAB[Collaborative Filtering]
    CONTENT[Content Filtering]
  end
  
  subgraph "AI Models"
    DIFY[Dify AI Orchestrator]
    RANK[Ranking Algorithm]
    DIVERSITY[Diversity Filter]
  end
  
  subgraph "Output"
    ROUTINES[Recommended Routines]
    FOODS[Recommended Foods]
    USERS[Similar Users]
    POSTS[Relevant Posts]
  end
  
  PROFILE --> FEATURE
  HISTORY --> FEATURE
  SOCIAL --> FEATURE
  PREFERENCES --> FEATURE
  
  FEATURE --> EMBED
  FEATURE --> COLLAB
  FEATURE --> CONTENT
  
  EMBED --> DIFY
  COLLAB --> DIFY
  CONTENT --> DIFY
  
  DIFY --> RANK
  RANK --> DIVERSITY
  
  DIVERSITY --> ROUTINES
  DIVERSITY --> FOODS
  DIVERSITY --> USERS
  DIVERSITY --> POSTS
</div></code></pre>
<h3 id="ai-evaluation-and-metrics">AI Evaluation and Metrics</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Chatbot Metrics"
    RESPONSE_TIME[Response Time]
    SATISFACTION[User Satisfaction]
    TASK_COMPLETION[Task Completion]
    CONTEXT_ACCURACY[Contextual Accuracy]
  end
  
  subgraph "Recommendation Metrics"
    CLICK_THROUGH[Click-Through Rate]
    CONVERSION[Conversion to Plan]
    RETENTION[User Retention]
    DIVERSITY_SCORE[Diversity Score]
  end
  
  subgraph "Feedback Loop"
    IMPLICIT[Implicit Feedback]
    EXPLICIT[Explicit Feedback]
    A_B_TESTING[A/B Testing]
  end
  
  subgraph "Continuous Improvement"
    MODEL_UPDATE[Model Update]
    PROMPT_OPT[Prompt Optimization]
    FEATURE_ENG[Feature Engineering]
  end
  
  RESPONSE_TIME --> IMPLICIT
  SATISFACTION --> EXPLICIT
  TASK_COMPLETION --> A_B_TESTING
  CONTEXT_ACCURACY --> MODEL_UPDATE
  
  CLICK_THROUGH --> IMPLICIT
  CONVERSION --> EXPLICIT
  RETENTION --> A_B_TESTING
  DIVERSITY_SCORE --> MODEL_UPDATE
  
  IMPLICIT --> MODEL_UPDATE
  EXPLICIT --> PROMPT_OPT
  A_B_TESTING --> FEATURE_ENG
</div></code></pre>
<ul>
<li><strong>Chatbot</strong>: user sessions (web), history, tools (exercise search, macros, calendar).</li>
<li><strong>Recommender</strong>: hybrid signals (content + collaborative); Dify as orchestrator.</li>
<li><strong>Evaluation</strong>: prompt tests, implicit feedback (clicks/usage), explicit feedback (rating).</li>
</ul>
<hr>
<h2 id="13-startup-guide-%E2%9A%99%EF%B8%8F">13. Startup Guide âš™ï¸</h2>
<h3 id="development-flow">Development Flow</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Initial Setup"
    CLONE[Clone Repository]
    ENV[Configure Variables]
    DEPS[Install Dependencies]
  end
  
  subgraph "Local Services"
    DOCKER[Start Docker Compose]
    DB[Initialize Database]
  end
  
  subgraph "Development"
    DEV[Run in Development Mode]
    TEST[Run Tests]
    LINT[Linting and Formatting]
  end
  
  subgraph "Deployment"
    BUILD[Production Build]
    K8S[Deploy to Kubernetes]
    MONITOR[Configure Monitoring]
  end
  
  CLONE --> ENV
  ENV --> DEPS
  DEPS --> DOCKER
  DOCKER --> DB
  DB --> DEV
  DEV --> TEST
  TEST --> LINT
  LINT --> BUILD
  BUILD --> K8S
  K8S --> MONITOR
</div></code></pre>
<h3 id="development-urls">Development URLs</h3>
<h4 id="backend-api-port-3000"><strong>Backend API (Port 3000)</strong></h4>
<ul>
<li><strong>Main API</strong>: http://localhost:3000</li>
<li><strong>Interactive Docs</strong>: http://localhost:3000/reference</li>
<li><strong>OpenAPI Specification</strong>: http://localhost:3000/openapi.json</li>
<li><strong>Health Check</strong>: http://localhost:3000/health</li>
<li><strong>API Root Info</strong>: http://localhost:3000/</li>
</ul>
<h4 id="local-supabase-ports-54321-54329"><strong>Local Supabase (Ports 54321-54329)</strong></h4>
<ul>
<li><strong>Supabase Studio</strong>: http://localhost:54323</li>
<li><strong>API Gateway</strong>: http://localhost:54321</li>
<li><strong>Database</strong>: postgresql://postgres:postgres@localhost:54322/postgres</li>
<li><strong>Realtime</strong>: ws://localhost:54321/realtime/v1/</li>
<li><strong>Storage</strong>: http://localhost:54321/storage/v1/</li>
<li><strong>Auth</strong>: http://localhost:54321/auth/v1/</li>
<li><strong>Email Testing (Inbucket)</strong>: http://localhost:54324</li>
</ul>
<h4 id="specific-api-endpoints"><strong>Specific API Endpoints</strong></h4>
<ul>
<li><strong>Authentication</strong>: http://localhost:3000/api/v1/auth</li>
<li><strong>Users</strong>: http://localhost:3000/api/v1/users</li>
<li><strong>Workouts</strong>: http://localhost:3000/api/v1/workouts</li>
<li><strong>Social</strong>: http://localhost:3000/api/v1/social</li>
<li><strong>Posts</strong>: http://localhost:3000/api/v1/social/posts</li>
<li><strong>Routines</strong>: http://localhost:3000/api/v1/workouts/routines</li>
<li><strong>Dashboard</strong>: http://localhost:3000/api/v1/dashboard</li>
<li><strong>Settings</strong>: http://localhost:3000/api/v1/settings</li>
<li><strong>Personal Info</strong>: http://localhost:3000/api/v1/users/personal</li>
</ul>
<h4 id="testing-and-development"><strong>Testing and Development</strong></h4>
<ul>
<li><strong>Vitest UI</strong>: http://localhost:51204 (when running <code>npm run test:ui</code>)</li>
<li><strong>Coverage Report</strong>: Generated in <code>coverage/</code> after <code>npm run test:coverage</code></li>
</ul>
<h3 id="actual-backend-project-structure">Actual Backend Project Structure</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB  
  subgraph "backend/"
    ROOT["backend/"]
    
    subgraph "src/ - Source Code"
      INDEX["index.ts - Entry Point"]
      
      subgraph "modules/ - Business Modules"
        AUTH_MOD["auth/ - Authentication"]
        USER_MOD["users/ - User Management"]
        WORKOUT_MOD["workouts/ - Workouts"]
        SOCIAL_MOD["social/ - Social Features"]
      end
      
      subgraph "routes/ - Route Handlers"
        AUTH_HANDLER["auth.handler.ts"]
        USER_HANDLER["user.handler.ts"]
        WORKOUT_HANDLER["workout.handler.ts"]
        SOCIAL_HANDLER["social.handler.ts"]
        POSTS_HANDLER["posts.handler.ts"]
        ROUTINES_HANDLER["routines.handler.ts"]
        DASHBOARD_HANDLER["dashboard.handler.ts"]
        SETTINGS_HANDLER["settings.handler.ts"]
        PERSONAL_HANDLER["personal.handler.ts"]
      end
      
      subgraph "shared/ - Shared Utils"
        DB["db/ - DB Config"]
        MIDDLEWARE["middleware/ - Middlewares"]
        UTILS["utils/ - Utilities"]
      end
      
      subgraph "types/ - TypeScript Types"
        DB_TYPES["database.types.ts"]
        CUSTOM_TYPES["Custom Types"]
      end
    end
    
    subgraph "supabase/ - Database"
      CONFIG["config.toml - Config"]
      MIGRATIONS["migrations/ - SQL Migrations"]
    end
    
    subgraph "scripts/ - Automation Scripts"
      SETUP["setup-database.sh"]
      OPENAPI["generate-complete-openapi.js"]
    end
    
    subgraph "config/ - Configuration"
      ENV["env.ts - Env Variables"]
    end
    
    subgraph "tests/ - Testing"
      UNIT_TESTS["Unit Tests"]
      INTEGRATION_TESTS["Integration Tests"]
    end
    
    subgraph "docs/ - Documentation"
      API_DOCS["API Documentation"]
    end
    
    subgraph "Config Files"
      PACKAGE["package.json"]
      TSCONFIG["tsconfig.json"]
      VITEST["vitest.config.ts"]
      DOCKERFILE["Dockerfile"]
      GITIGNORE[".gitignore"]
      ENV_EXAMPLE["env.example"]
    end
  end
  
  %% Relationships
  INDEX --> AUTH_MOD
  INDEX --> USER_MOD
  INDEX --> WORKOUT_MOD
  INDEX --> SOCIAL_MOD
  
  AUTH_MOD --> AUTH_HANDLER
  USER_MOD --> USER_HANDLER
  WORKOUT_MOD --> WORKOUT_HANDLER
  SOCIAL_MOD --> SOCIAL_HANDLER
  
  AUTH_HANDLER --> MIDDLEWARE
  USER_HANDLER --> MIDDLEWARE
  WORKOUT_HANDLER --> MIDDLEWARE
  SOCIAL_HANDLER --> MIDDLEWARE
  
  MIDDLEWARE --> UTILS
  UTILS --> DB
  DB --> MIGRATIONS
</div></code></pre>
<h3 id="actual-frontend-project-structure">Actual Frontend Project Structure</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB  
  subgraph "frontend/"
    ROOT["frontend/"]
    
    subgraph "src/ - Source Code"
      APP["app/ - App Router (Next.js 14)"]
      
      subgraph "app/ - App Router"
        LAYOUT["layout.tsx - Main Layout"]
        PAGE["page.tsx - Home Page"]
        GLOBAL_CSS["globals.css - Global Styles"]
        
        subgraph "auth/ - Authentication"
          LOGIN_PAGE["login/page.tsx"]
          REGISTER_PAGE["register/page.tsx"]
          AUTH_LAYOUT["auth/layout.tsx"]
        end
        
        subgraph "dashboard/ - Main Dashboard"
          DASHBOARD_PAGE["dashboard/page.tsx"]
          DASHBOARD_LAYOUT["dashboard/layout.tsx"]
        end
        
        subgraph "workouts/ - Workouts"
          WORKOUTS_PAGE["workouts/page.tsx"]
          WORKOUT_DETAIL["workouts/[id]/page.tsx"]
          WORKOUT_CREATE["workouts/create/page.tsx"]
        end
        
        subgraph "social/ - Social Network"
          SOCIAL_PAGE["social/page.tsx"]
          POST_DETAIL["social/posts/[id]/page.tsx"]
          PROFILE_PAGE["social/profile/[id]/page.tsx"]
        end
        
        subgraph "api/ - API Routes"
          AUTH_API["api/auth/[...nextauth]/route.ts"]
          WORKOUT_API["api/workouts/route.ts"]
          SOCIAL_API["api/social/route.ts"]
        end
      end
      
      subgraph "components/ - Reusable Components"
        UI["ui/ - shadcn/ui components"]
        FORMS["forms/ - Forms"]
        LAYOUTS["layouts/ - Specific Layouts"]
        
        subgraph "ui/ - Base Components"
          BUTTON["button.tsx"]
          INPUT["input.tsx"]
          CARD["card.tsx"]
          DIALOG["dialog.tsx"]
          TOAST["toast.tsx"]
        end
        
        subgraph "forms/ - Forms"
          LOGIN_FORM["LoginForm.tsx"]
          WORKOUT_FORM["WorkoutForm.tsx"]
          POST_FORM["PostForm.tsx"]
        end
      end
      
      subgraph "lib/ - Utils and Config"
        AUTH_CONFIG["auth.ts - Auth.js config"]
        API_CLIENT["api-client.ts - API Client"]
        UTILS["utils.ts - General Utilities"]
        VALIDATIONS["validations.ts - Zod schemas"]
        CONSTANTS["constants.ts - Constants"]
      end
      
      subgraph "hooks/ - Custom Hooks"
        USE_AUTH["useAuth.ts"]
        USE_WORKOUTS["useWorkouts.ts"]
        USE_SOCIAL["useSocial.ts"]
        USE_API["useApi.ts"]
      end
      
      subgraph "stores/ - Global State (Zustand)"
        AUTH_STORE["authStore.ts"]
        WORKOUT_STORE["workoutStore.ts"]
        SOCIAL_STORE["socialStore.ts"]
        UI_STORE["uiStore.ts"]
      end
      
      subgraph "types/ - TypeScript Types"
        API_TYPES["api.types.ts"]
        COMPONENT_TYPES["component.types.ts"]
        STORE_TYPES["store.types.ts"]
      end
    end
    
    subgraph "public/ - Static Files"
      IMAGES["images/ - Images"]
      ICONS["icons/ - Icons"]
      FONTS["fonts/ - Custom Fonts"]
    end
    
    subgraph "styles/ - Styles"
      GLOBAL_CSS["globals.css"]
      COMPONENTS_CSS["components.css"]
      UTILITIES_CSS["utilities.css"]
    end
    
    subgraph "tests/ - Testing"
      UNIT_TESTS["__tests__/ - Unit Tests"]
      E2E_TESTS["e2e/ - E2E Tests"]
      TEST_UTILS["test-utils.tsx"]
    end
    
    subgraph "Config Files"
      PACKAGE["package.json"]
      NEXT_CONFIG["next.config.js"]
      TAILWIND_CONFIG["tailwind.config.js"]
      TSCONFIG["tsconfig.json"]
      ESLINT_CONFIG[".eslintrc.json"]
      PRETTIER_CONFIG[".prettierrc"]
      PLAYWRIGHT_CONFIG["playwright.config.ts"]
    end
  end
  
  %% Main Relationships
  LAYOUT --> AUTH_PAGE
  LAYOUT --> DASHBOARD_PAGE
  LAYOUT --> WORKOUTS_PAGE
  LAYOUT --> SOCIAL_PAGE
  
  AUTH_PAGE --> LOGIN_FORM
  WORKOUTS_PAGE --> WORKOUT_FORM
  SOCIAL_PAGE --> POST_FORM
  
  LOGIN_FORM --> AUTH_STORE
  WORKOUT_FORM --> WORKOUT_STORE
  POST_FORM --> SOCIAL_STORE
  
  AUTH_STORE --> API_CLIENT
  WORKOUT_STORE --> API_CLIENT
  SOCIAL_STORE --> API_CLIENT
  
  API_CLIENT --> AUTH_API
  API_CLIENT --> WORKOUT_API
  API_CLIENT --> SOCIAL_API
</div></code></pre>
<h3 id="module-structure-details">Module Structure Details</h3>
<h4 id="%F0%9F%93%81-frontend---nextjs-14-architecture"><strong>ğŸ“ Frontend - Next.js 14 Architecture</strong></h4>
<p><strong>App Router Structure:</strong></p>
<ul>
<li><strong><code>app/</code></strong>: Main directory with Next.js 14 App Router</li>
<li><strong><code>app/layout.tsx</code></strong>: Root layout with global providers</li>
<li><strong><code>app/page.tsx</code></strong>: Main landing/home page</li>
<li><strong><code>app/globals.css</code></strong>: Global styles using Tailwind CSS</li>
</ul>
<p><strong>Feature-based Routing:</strong></p>
<ul>
<li><strong><code>app/auth/</code></strong>: Authentication pages (login, register)</li>
<li><strong><code>app/dashboard/</code></strong>: Main user dashboard</li>
<li><strong><code>app/workouts/</code></strong>: Workout management</li>
<li><strong><code>app/social/</code></strong>: Social network and posts</li>
<li><strong><code>app/api/</code></strong>: Next.js API routes</li>
</ul>
<p><strong>Component Architecture:</strong></p>
<ul>
<li><strong><code>components/ui/</code></strong>: shadcn/ui base components</li>
<li><strong><code>components/forms/</code></strong>: Feature-specific forms</li>
<li><strong><code>components/layouts/</code></strong>: Specific layouts</li>
</ul>
<p><strong>State Management:</strong></p>
<ul>
<li><strong><code>stores/</code></strong>: Zustand stores by feature</li>
<li><strong><code>hooks/</code></strong>: Custom reusable hooks</li>
<li><strong><code>lib/</code></strong>: Utilities, config, and API clients</li>
</ul>
<h4 id="%F0%9F%93%81-backend---business-modules"><strong>ğŸ“ Backend - Business Modules</strong></h4>
<p>Each module follows the <strong>Service-Middleware-Types</strong> pattern:</p>
<pre><code class="language-mermaid"><div class="mermaid">graph LR
  subgraph "Module Pattern"
    SERVICE[service.ts - Business logic]
    MIDDLEWARE[middleware.ts - Validations]
    TYPES[types.ts - TypeScript interfaces]
    ROUTES[routes.ts - Route definitions]
  end
  
  ROUTES --> MIDDLEWARE
  MIDDLEWARE --> SERVICE
  SERVICE --> TYPES
</div></code></pre>
<p><strong>Implemented Modules:</strong></p>
<ul>
<li><strong><code>auth/</code></strong>: JWT authentication, registration, login, refresh tokens</li>
<li><strong><code>users/</code></strong>: User profile management, configuration</li>
<li><strong><code>workouts/</code></strong>: Workouts, exercises, sessions</li>
<li><strong><code>social/</code></strong>: Posts, likes, comments, social feed</li>
</ul>
<h4 id="%F0%9F%93%81-srcroutes---route-handlers"><strong>ğŸ“ src/routes/ - Route Handlers</strong></h4>
<p>Each handler manages a specific group of endpoints:</p>
<ul>
<li><strong><code>auth.handler.ts</code></strong>: <code>/api/v1/auth/*</code></li>
<li><strong><code>user.handler.ts</code></strong>: <code>/api/v1/users/*</code></li>
<li><strong><code>workout.handler.ts</code></strong>: <code>/api/v1/workouts/*</code></li>
<li><strong><code>social.handler.ts</code></strong>: <code>/api/v1/social/*</code></li>
<li><strong><code>posts.handler.ts</code></strong>: <code>/api/v1/social/posts/*</code></li>
<li><strong><code>routines.handler.ts</code></strong>: <code>/api/v1/workouts/routines/*</code></li>
<li><strong><code>dashboard.handler.ts</code></strong>: <code>/api/v1/dashboard/*</code></li>
<li><strong><code>settings.handler.ts</code></strong>: <code>/api/v1/settings/*</code></li>
<li><strong><code>personal.handler.ts</code></strong>: <code>/api/v1/users/personal/*</code></li>
</ul>
<h4 id="%F0%9F%93%81-srcshared---shared-utilities"><strong>ğŸ“ src/shared/ - Shared Utilities</strong></h4>
<p><strong><code>middleware/</code></strong>:</p>
<ul>
<li><code>auth.middleware.ts</code>: JWT verification</li>
<li><code>error.middleware.ts</code>: Global error handling</li>
<li><code>rate-limit.middleware.ts</code>: Rate limiting</li>
<li><code>validation.middleware.ts</code>: Data validation</li>
</ul>
<p><strong><code>utils/</code></strong> (25+ utilities):</p>
<ul>
<li><code>database.ts</code>: Supabase connection</li>
<li><code>validation.ts</code>: Zod validators</li>
<li><code>response.ts</code>: API response formatting</li>
<li><code>security.ts</code>: Security functions</li>
<li><code>logger.ts</code>: Logging system</li>
<li><code>cache.ts</code>: Cache management</li>
<li><code>email.ts</code>: Email sending</li>
<li><code>storage.ts</code>: File management</li>
<li>And 18+ more utilities...</li>
</ul>
<h4 id="%F0%9F%93%81-supabase---database"><strong>ğŸ“ supabase/ - Database</strong></h4>
<p><strong><code>migrations/</code></strong>:</p>
<ul>
<li><code>001_initial_schema.sql</code>: Initial schema</li>
<li><code>002_rls_policies.sql</code>: Security policies</li>
<li><code>003_seed_data.sql</code>: Test data</li>
<li><code>004_personal_info_and_enhanced_features.sql</code>: Advanced features</li>
</ul>
<p><strong><code>config.toml</code></strong>: Complete local Supabase config</p>
<h4 id="automation-scripts"><strong>Automation Scripts</strong></h4>
<ul>
<li><strong><code>setup-database.sh</code></strong>: Initial DB setup</li>
<li><strong><code>generate-openapi.js</code></strong>: Unified OpenAPI documentation generation</li>
</ul>
<h3 id="available-development-commands">Available Development Commands</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Development</span>
npm run dev              <span class="hljs-comment"># Server with hot-reload</span>
npm run serve            <span class="hljs-comment"># Local production server</span>
npm run build            <span class="hljs-comment"># Build for production</span>
npm run start            <span class="hljs-comment"># Start production server</span>

<span class="hljs-comment"># Database</span>
npm run db:start         <span class="hljs-comment"># Start local Supabase</span>
npm run db:stop          <span class="hljs-comment"># Stop local Supabase</span>
npm run db:reset         <span class="hljs-comment"># Reset database</span>
npm run db:migrate       <span class="hljs-comment"># Apply migrations</span>
npm run db:generate-types <span class="hljs-comment"># Generate TypeScript types</span>
npm run db:setup         <span class="hljs-comment"># Initial setup</span>

<span class="hljs-comment"># Testing</span>
npm run <span class="hljs-built_in">test</span>             <span class="hljs-comment"># Unit tests</span>
npm run <span class="hljs-built_in">test</span>:ui          <span class="hljs-comment"># Testing UI</span>
npm run <span class="hljs-built_in">test</span>:coverage    <span class="hljs-comment"># Coverage tests</span>

<span class="hljs-comment"># Code Quality</span>
npm run lint             <span class="hljs-comment"># Linting</span>
npm run lint:fix         <span class="hljs-comment"># Lint + fix</span>
npm run <span class="hljs-built_in">type</span>-check       <span class="hljs-comment"># Type checking</span>

<span class="hljs-comment"># Documentation</span>
npm run docs:generate          <span class="hljs-comment"># Generate complete OpenAPI</span>
npm run docs:serve             <span class="hljs-comment"># Serve documentation</span>
npm run docs:open              <span class="hljs-comment"># Open docs in browser</span>
</div></code></pre>
<h3 id="cicd-pipeline">CI/CD Pipeline</h3>
<h4 id="main-pipeline---push-to-main"><strong>Main Pipeline - Push to Main</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "ğŸš€ Trigger: Push to main"
    PUSH[Push to main branch]
  end
  
  subgraph "ğŸ” Stage 1: Validation & Preparation"
    CHECKOUT[Checkout Code]
    SETUP[Setup Node.js Environment]
    INSTALL[Install Dependencies]
    CACHE[Cache Dependencies]
  end
  
  subgraph "ğŸ§ª Stage 2: Testing"
    UNIT_TESTS[Unit Tests<br/>npm run test]
    INTEGRATION_TESTS[Integration Tests<br/>npm run test:integration]
    COVERAGE[Coverage Report<br/>npm run test:coverage]
    TEST_RESULTS[Test Results Analysis]
  end
  
  subgraph "ğŸ” Stage 3: Code Quality"
    LINT[Lint Code<br/>npm run lint]
    TYPE_CHECK[Type Check<br/>npm run type-check]
    SECURITY[Security Scan<br/>npm audit]
    VULNERABILITIES[Vulnerability Check]
  end
  
  subgraph "ğŸ—ï¸ Stage 4: Build"
    BUILD[Build Application<br/>npm run build]
    DOCKER_BUILD[Docker Build<br/>docker build -t gympal-backend]
    DOCKER_PUSH[Docker Push to Registry]
    IMAGE_TAG[Tag Image with Git SHA]
  end
  
  subgraph "ğŸš€ Stage 5: Deploy"
    ARGOCD_SYNC[ArgoCD Sync]
    K8S_DEPLOY[Kubernetes Deploy]
    HEALTH_CHECK[Health Check]
    ROLLBACK[Rollback if Failed]
  end
  
  subgraph "ğŸ“Š Stage 6: Post-Deploy"
    NOTIFY[Send Notifications]
    METRICS[Update Metrics]
    DOCS[Update Documentation]
  end
  
  %% Main Flow
  PUSH --> CHECKOUT
  CHECKOUT --> SETUP
  SETUP --> INSTALL
  INSTALL --> CACHE
  
  CACHE --> UNIT_TESTS
  CACHE --> INTEGRATION_TESTS
  UNIT_TESTS --> COVERAGE
  INTEGRATION_TESTS --> COVERAGE
  COVERAGE --> TEST_RESULTS
  
  TEST_RESULTS --> LINT
  LINT --> TYPE_CHECK
  TYPE_CHECK --> SECURITY
  SECURITY --> VULNERABILITIES
  
  VULNERABILITIES --> BUILD
  BUILD --> DOCKER_BUILD
  DOCKER_BUILD --> DOCKER_PUSH
  DOCKER_PUSH --> IMAGE_TAG
  
  IMAGE_TAG --> ARGOCD_SYNC
  ARGOCD_SYNC --> K8S_DEPLOY
  K8S_DEPLOY --> HEALTH_CHECK
  HEALTH_CHECK --> ROLLBACK
  
  HEALTH_CHECK --> NOTIFY
  NOTIFY --> METRICS
  METRICS --> DOCS
  
  %% Error Flows
  TEST_RESULTS -.->|âŒ Tests Failed| PUSH
  VULNERABILITIES -.->|âŒ Security Issues| PUSH
  HEALTH_CHECK -.->|âŒ Health Check Failed| ROLLBACK
  ROLLBACK -.->|âŒ Rollback Failed| NOTIFY
</div></code></pre>
<h4 id="detailed-testing-pipeline"><strong>Detailed Testing Pipeline</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "ğŸ§ª Testing Pipeline"
    START[Start Testing]
    
    subgraph "Unit Tests"
      UNIT_SETUP[Setup Test Environment]
      UNIT_RUN[Run Unit Tests<br/>vitest]
      UNIT_COVERAGE[Generate Coverage]
      UNIT_REPORT[Unit Test Report]
    end
    
    subgraph "Integration Tests"
      INT_SETUP[Setup Test Database]
      INT_RUN[Run Integration Tests<br/>vitest --config vitest.integration.config.ts]
      INT_CLEANUP[Cleanup Test Data]
      INT_REPORT[Integration Test Report]
    end
    
    subgraph "E2E Tests"
      E2E_SETUP[Setup E2E Environment]
      E2E_RUN[Run E2E Tests<br/>playwright]
      E2E_VIDEO[Record Test Videos]
      E2E_REPORT[E2E Test Report]
    end
    
    subgraph "Performance Tests"
      PERF_SETUP[Setup Performance Environment]
      PERF_RUN[Run Load Tests<br/>k6]
      PERF_METRICS[Performance Metrics]
      PERF_REPORT[Performance Report]
    end
    
    subgraph "Security Tests"
      SEC_SCAN[Security Scan<br/>npm audit]
      SEC_SAST[Static Analysis<br/>semgrep]
      SEC_DEPS[Dependency Check<br/>snyk]
      SEC_REPORT[Security Report]
    end
    
    RESULTS[Consolidate Results]
    NOTIFY_RESULTS[Notify Results]
  end
  
  START --> UNIT_SETUP
  START --> INT_SETUP
  START --> E2E_SETUP
  START --> PERF_SETUP
  START --> SEC_SCAN
  
  UNIT_SETUP --> UNIT_RUN
  UNIT_RUN --> UNIT_COVERAGE
  UNIT_COVERAGE --> UNIT_REPORT
  
  INT_SETUP --> INT_RUN
  INT_RUN --> INT_CLEANUP
  INT_CLEANUP --> INT_REPORT
  
  E2E_SETUP --> E2E_RUN
  E2E_RUN --> E2E_VIDEO
  E2E_VIDEO --> E2E_REPORT
  
  PERF_SETUP --> PERF_RUN
  PERF_RUN --> PERF_METRICS
  PERF_METRICS --> PERF_REPORT
  
  SEC_SCAN --> SEC_SAST
  SEC_SAST --> SEC_DEPS
  SEC_DEPS --> SEC_REPORT
  
  UNIT_REPORT --> RESULTS
  INT_REPORT --> RESULTS
  E2E_REPORT --> RESULTS
  PERF_REPORT --> RESULTS
  SEC_REPORT --> RESULTS
  
  RESULTS --> NOTIFY_RESULTS
</div></code></pre>
<h4 id="deploy-pipeline-with-argocd"><strong>Deploy Pipeline with ArgoCD</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "ğŸš€ ArgoCD Deploy Pipeline"
    ARGOCD_TRIGGER[ArgoCD Detects Changes]
    
    subgraph "Pre-Deploy Validation"
      VALIDATE_MANIFESTS[Validate K8s Manifests]
      CHECK_RESOURCES[Check Resource Requirements]
      VALIDATE_IMAGES[Validate Docker Images]
      SECURITY_SCAN[Security Scan Images]
    end
    
    subgraph "Deploy Strategy"
      BLUE_GREEN[Blue-Green Deployment]
      CANARY[Canary Deployment]
      ROLLING[Rolling Update]
    end
    
    subgraph "Deploy Process"
      CREATE_NAMESPACE[Create/Update Namespace]
      APPLY_CONFIGMAPS[Apply ConfigMaps]
      APPLY_SECRETS[Apply Secrets]
      DEPLOY_APP[Deploy Application]
      DEPLOY_SERVICES[Deploy Services]
      DEPLOY_INGRESS[Deploy Ingress]
    end
    
    subgraph "Post-Deploy Verification"
      HEALTH_CHECK[Health Check Endpoints]
      READINESS_CHECK[Readiness Probe]
      LIVENESS_CHECK[Liveness Probe]
      SMOKE_TESTS[Smoke Tests]
      PERFORMANCE_CHECK[Performance Check]
    end
    
    subgraph "Monitoring & Alerting"
      PROMETHEUS_METRICS[Prometheus Metrics]
      GRAFANA_DASHBOARD[Grafana Dashboard]
      ALERT_MANAGER[Alert Manager]
      LOG_AGGREGATION[Log Aggregation]
    end
    
    subgraph "Rollback Strategy"
      ROLLBACK_TRIGGER[Rollback Trigger]
      ROLLBACK_EXECUTE[Execute Rollback]
      ROLLBACK_VERIFY[Verify Rollback]
    end
  end
  
  ARGOCD_TRIGGER --> VALIDATE_MANIFESTS
  VALIDATE_MANIFESTS --> CHECK_RESOURCES
  CHECK_RESOURCES --> VALIDATE_IMAGES
  VALIDATE_IMAGES --> SECURITY_SCAN
  
  SECURITY_SCAN --> BLUE_GREEN
  BLUE_GREEN --> CANARY
  CANARY --> ROLLING
  
  ROLLING --> CREATE_NAMESPACE
  CREATE_NAMESPACE --> APPLY_CONFIGMAPS
  APPLY_CONFIGMAPS --> APPLY_SECRETS
  APPLY_SECRETS --> DEPLOY_APP
  DEPLOY_APP --> DEPLOY_SERVICES
  DEPLOY_SERVICES --> DEPLOY_INGRESS
  
  DEPLOY_INGRESS --> HEALTH_CHECK
  HEALTH_CHECK --> READINESS_CHECK
  READINESS_CHECK --> LIVENESS_CHECK
  LIVENESS_CHECK --> SMOKE_TESTS
  SMOKE_TESTS --> PERFORMANCE_CHECK
  
  PERFORMANCE_CHECK --> PROMETHEUS_METRICS
  PROMETHEUS_METRICS --> GRAFANA_DASHBOARD
  GRAFANA_DASHBOARD --> ALERT_MANAGER
  ALERT_MANAGER --> LOG_AGGREGATION
  
  HEALTH_CHECK -.->|âŒ Failed| ROLLBACK_TRIGGER
  READINESS_CHECK -.->|âŒ Failed| ROLLBACK_TRIGGER
  LIVENESS_CHECK -.->|âŒ Failed| ROLLBACK_TRIGGER
  SMOKE_TESTS -.->|âŒ Failed| ROLLBACK_TRIGGER
  PERFORMANCE_CHECK -.->|âŒ Failed| ROLLBACK_TRIGGER
  
  ROLLBACK_TRIGGER --> ROLLBACK_EXECUTE
  ROLLBACK_EXECUTE --> ROLLBACK_VERIFY
</div></code></pre>
<h4 id="code-quality-pipeline"><strong>Code Quality Pipeline</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "ğŸ” Code Quality Pipeline"
    CODE_CHANGES[Code Changes Detected]
    
    subgraph "Static Analysis"
      ESLINT[ESLint Analysis<br/>npm run lint]
      PRETTIER[Prettier Format Check<br/>npm run format:check]
      TSC[TypeScript Compilation<br/>npm run type-check]
      SONARQUBE[SonarQube Analysis]
    end
    
    subgraph "Security Analysis"
      NPM_AUDIT[NPM Audit<br/>npm audit]
      SNYK_SCAN[Snyk Security Scan]
      SEMGREP[Semgrep SAST]
      OWASP[OWASP Dependency Check]
    end
    
    subgraph "Code Metrics"
      COMPLEXITY[Cyclomatic Complexity]
      DUPLICATION[Code Duplication]
      MAINTAINABILITY[Maintainability Index]
      RELIABILITY[Reliability Rating]
    end
    
    subgraph "Documentation"
      JSDOC[JSDoc Validation]
      OPENAPI[OpenAPI Schema Validation]
      README[README Validation]
      CHANGELOG[Changelog Validation]
    end
    
    subgraph "Quality Gates"
      GATE_TESTS[Test Coverage > 80%]
      GATE_SECURITY[No High/Critical Vulnerabilities]
      GATE_DUPLICATION[Duplication < 3%]
      GATE_MAINTAINABILITY[Maintainability > B]
    end
    
    QUALITY_REPORT[Generate Quality Report]
    NOTIFY_QUALITY[Notify Quality Results]
  end
  
  CODE_CHANGES --> ESLINT
  CODE_CHANGES --> PRETTIER
  CODE_CHANGES --> TSC
  CODE_CHANGES --> SONARQUBE
  
  ESLINT --> NPM_AUDIT
  PRETTIER --> SNYK_SCAN
  TSC --> SEMGREP
  SONARQUBE --> OWASP
  
  NPM_AUDIT --> COMPLEXITY
  SNYK_SCAN --> DUPLICATION
  SEMGREP --> MAINTAINABILITY
  OWASP --> RELIABILITY
  
  COMPLEXITY --> JSDOC
  DUPLICATION --> OPENAPI
  MAINTAINABILITY --> README
  RELIABILITY --> CHANGELOG
  
  JSDOC --> GATE_TESTS
  OPENAPI --> GATE_SECURITY
  README --> GATE_DUPLICATION
  CHANGELOG --> GATE_MAINTAINABILITY
  
  GATE_TESTS --> QUALITY_REPORT
  GATE_SECURITY --> QUALITY_REPORT
  GATE_DUPLICATION --> QUALITY_REPORT
  GATE_MAINTAINABILITY --> QUALITY_REPORT
  
  QUALITY_REPORT --> NOTIFY_QUALITY
</div></code></pre>
<h4 id="monitoring--notifications-pipeline"><strong>Monitoring &amp; Notifications Pipeline</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "ğŸ“Š Monitoring & Notifications Pipeline"
    PIPELINE_EVENTS[Pipeline Events]
    
    subgraph "Notification Channels"
      SLACK[Slack Notifications]
      EMAIL[Email Notifications]
      TEAMS[Microsoft Teams]
      DISCORD[Discord Notifications]
    end
    
    subgraph "Monitoring Stack"
      PROMETHEUS[Prometheus Metrics]
      GRAFANA[Grafana Dashboards]
      JAEGER[Jaeger Tracing]
      ELK[ELK Stack Logs]
    end
    
    subgraph "Alerting Rules"
      DEPLOY_SUCCESS[Deploy Success Alert]
      DEPLOY_FAILURE[Deploy Failure Alert]
      TEST_FAILURE[Test Failure Alert]
      SECURITY_ALERT[Security Alert]
      PERFORMANCE_ALERT[Performance Alert]
    end
    
    subgraph "Metrics Collection"
      APP_METRICS[Application Metrics]
      INFRA_METRICS[Infrastructure Metrics]
      USER_METRICS[User Behavior Metrics]
      BUSINESS_METRICS[Business Metrics]
    end
    
    subgraph "Reporting"
      DAILY_REPORT[Daily Report]
      WEEKLY_REPORT[Weekly Report]
      MONTHLY_REPORT[Monthly Report]
      INCIDENT_REPORT[Incident Report]
    end
  end
  
  PIPELINE_EVENTS --> SLACK
  PIPELINE_EVENTS --> EMAIL
  PIPELINE_EVENTS --> TEAMS
  PIPELINE_EVENTS --> DISCORD
  
  SLACK --> PROMETHEUS
  EMAIL --> GRAFANA
  TEAMS --> JAEGER
  DISCORD --> ELK
  
  PROMETHEUS --> DEPLOY_SUCCESS
  GRAFANA --> DEPLOY_FAILURE
  JAEGER --> TEST_FAILURE
  ELK --> SECURITY_ALERT
  
  DEPLOY_SUCCESS --> APP_METRICS
  DEPLOY_FAILURE --> INFRA_METRICS
  TEST_FAILURE --> USER_METRICS
  SECURITY_ALERT --> BUSINESS_METRICS
  
  APP_METRICS --> DAILY_REPORT
  INFRA_METRICS --> WEEKLY_REPORT
  USER_METRICS --> MONTHLY_REPORT
  BUSINESS_METRICS --> INCIDENT_REPORT
</div></code></pre>
<hr>
<h2 id="14-kpis-and-success-metrics-%F0%9F%8E%AF">14. KPIs and Success Metrics ğŸ¯</h2>
<h3 id="metrics-dashboard">Metrics Dashboard</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "User Metrics"
    MAU[Monthly Active Users]
    DAU[Daily Active Users]
    RETENTION[30-day Retention]
    GROWTH[Monthly Growth]
  end
  
  subgraph "Product Metrics"
    PLAN_COMPLETION[% Plans Completed]
    AI_SATISFACTION[AI Satisfaction]
    SOCIAL_ENGAGEMENT[Social Engagement]
    FEATURE_USAGE[Feature Usage]
  end
  
  subgraph "Technical Metrics"
    API_LATENCY[API Latency]
    ERROR_RATE[Error Rate]
    UPTIME[Availability]
    RESPONSE_TIME[Response Time]
  end
  
  subgraph "Business Metrics"
    CONVERSION[Conversion to Premium Plans]
    CHURN[Churn Rate]
    LTV[Lifetime Value]
    CAC[Customer Acquisition Cost]
  end
  
  MAU --> GROWTH
  DAU --> RETENTION
  PLAN_COMPLETION --> AI_SATISFACTION
  SOCIAL_ENGAGEMENT --> FEATURE_USAGE
  API_LATENCY --> ERROR_RATE
  UPTIME --> RESPONSE_TIME
  CONVERSION --> LTV
  CHURN --> CAC
</div></code></pre>
<hr>
<h2 id="15-appendices-%F0%9F%93%8E">15. Appendices ğŸ“</h2>
<h3 id="blockchain-integration-optional">Blockchain Integration (Optional)</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
  subgraph "Application"
    ACHIEVEMENT[Major Achievement]
    HASH[Generate Hash]
    METADATA[Achievement Metadata]
  end
  
  subgraph "Blockchain"
    POLYGON[Polygon Testnet]
    SMART_CONTRACT[Smart Contract]
    NFT[NFT Certificate]
  end
  
  subgraph "Verification"
    VERIFY[Verify on Blockchain]
    CERTIFICATE[Digital Certificate]
    PROOF[Proof of Existence]
  end
  
  ACHIEVEMENT --> HASH
  HASH --> METADATA
  METADATA --> POLYGON
  POLYGON --> SMART_CONTRACT
  SMART_CONTRACT --> NFT
  NFT --> VERIFY
  VERIFY --> CERTIFICATE
  CERTIFICATE --> PROOF
</div></code></pre>
<h3 id="technology-roadmap">Technology Roadmap</h3>
<pre><code class="language-mermaid"><div class="mermaid">timeline
  title GymPal Technology Roadmap
  
  section Phase 1 (7 Oct - 3 Nov)
    Initial Setup : Next.js 14
                   : TypeScript
                   : Tailwind CSS
                   : Supabase
  
  section Phase 2 (4 Nov - 24 Nov)
    Backend Core : Hono Framework
                  : PostgreSQL
                  : Redis Cache
                  : JWT Auth
  
  section Phase 3 (25 Nov - 8 Dec)
    AI Integration : Dify AI
                    : n8n Workflows
                    : OpenAI/Anthropic
                    : Recommendation Engine
  
  section Phase 4 (9 Dec - 19 Dec)
    DevOps & Scale : Kubernetes
                    : ArgoCD
                    : Prometheus
                    : Grafana
</div></code></pre>
<h3 id="project-gantt-chart">Project Gantt Chart</h3>
<pre><code class="language-mermaid"><div class="mermaid">gantt
    title GymPal Project Schedule
    dateFormat  YYYY-MM-DD
    axisFormat  %d/%m
    
    section Phase 1 - Initial Setup
    Analysis and Design          :done, setup1, 2025-10-07, 2025-10-13
    Frontend Setup               :done, setup2, 2025-10-14, 2025-10-20
    Backend Setup                :done, setup3, 2025-10-21, 2025-10-27
    Supabase Integration         :done, setup4, 2025-10-28, 2025-11-03
    
    section Phase 2 - Backend Core
    REST APIs                    :active, api1, 2025-11-04, 2025-11-10
    Authentication               :active, api2, 2025-11-11, 2025-11-17
    Database                     :active, api3, 2025-11-18, 2025-11-24
    Progress Presentation        :milestone, pres1, 2025-10-24, 0d
    
    section Phase 3 - AI Integration
    Dify AI Setup                :ai1, 2025-11-25, 2025-12-01
    n8n Workflows                :ai2, 2025-12-02, 2025-12-08
    Demo 1                       :milestone, demo1, 2025-11-25, 0d
    Demo 2                       :milestone, demo2, 2025-11-28, 0d
    
    section Phase 4 - DevOps & Scale
    Kubernetes                   :dev1, 2025-12-09, 2025-12-12
    Monitoring                   :dev2, 2025-12-13, 2025-12-16
    Final Documentation          :dev3, 2025-12-17, 2025-12-19
    Final Delivery               :milestone, final, 2025-12-09, 0d
    Thesis Delivery              :milestone, memoria, 2025-12-19, 0d
</div></code></pre>
<pre><code class="language-mermaid"><div class="mermaid">gantt
    title GymPal Prioritized Roadmap (MVP-first)
    dateFormat YYYY-MM-DD
    
    section MVP Core (Critical)
    Auth + User Profile       :crit, mvp1, 2025-10-07, 3w
    Workout CRUD              :crit, mvp2, 2025-10-28, 2w
    Basic Social              :crit, mvp3, 2025-11-11, 2w
    
    section Added Value
    AI Chatbot Web            :ai1, 2025-11-25, 2w
    Basic Recommendations     :ai2, 2025-12-09, 1w
    
    section Nice-to-Have
    n8n Telegram Bot          :n8n1, 2025-12-16, 1w
    Schedule/Calendar         :extra, 2025-12-16, 1w
</div></code></pre>
<h3 id="roles-gantt-chart">Roles Gantt Chart</h3>
<pre><code class="language-mermaid"><div class="mermaid">gantt
    title Roles Gantt Chart - GymPal
    dateFormat  YYYY-MM-DD
    axisFormat  %d/%m
    
    section Frontend Developer
    Setup Next.js               :front1, 2025-10-07, 2025-10-20
    UI Components               :front2, 2025-10-21, 2025-11-10
    State Management            :front3, 2025-11-11, 2025-11-24
    Social Features UI          :front4, 2025-11-25, 2025-12-08
    Final Polish                :front5, 2025-12-09, 2025-12-19
    
    section Backend Developer
    API Design                  :back1, 2025-10-07, 2025-10-27
    Authentication              :back2, 2025-10-28, 2025-11-10
    CRUD Operations             :back3, 2025-11-11, 2025-11-24
    Social APIs                 :back4, 2025-11-25, 2025-12-08
    Performance Optimization    :back5, 2025-12-09, 2025-12-19
    
    section DevOps/SRE
    Infrastructure Setup        :devops1, 2025-10-07, 2025-11-03
    CI/CD Pipeline              :devops2, 2025-11-04, 2025-11-24
    Kubernetes Deployment       :devops3, 2025-11-25, 2025-12-12
    Monitoring Setup            :devops4, 2025-12-13, 2025-12-19
    
    section AI/Integrations
    Dify AI Integration         :ai1, 2025-10-28, 2025-11-24
    n8n Workflows               :ai2, 2025-11-25, 2025-12-08
    Recommendation Engine       :ai3, 2025-12-02, 2025-12-12
    AI Testing & Optimization   :ai4, 2025-12-13, 2025-12-19
    
    section Product/QA
    Requirements Analysis        :qa1, 2025-10-07, 2025-10-13
    Test Planning               :qa2, 2025-10-14, 2025-11-03
    E2E Testing                 :qa3, 2025-11-04, 2025-12-08
    Documentation & Final QA    :qa4, 2025-12-09, 2025-12-19
    
    section Milestones
    Progress Presentation       :milestone, pres1, 2025-10-24, 0d
    Demo 1                      :milestone, demo1, 2025-11-25, 0d
    Demo 2                      :milestone, demo2, 2025-11-28, 0d
    Final Delivery              :milestone, final, 2025-12-09, 0d
    Thesis Delivery             :milestone, memoria, 2025-12-19, 0d
</div></code></pre>
<h2 id="16-to-do-list-by-roles-%F0%9F%91%A5">16. TO-DO List by Roles ğŸ‘¥</h2>
<h3 id="%F0%9F%8E%A8-frontend-developer">ğŸ¨ Frontend Developer</h3>
<ul>
<li>
<p><input type="checkbox" id="checkbox0"><label for="checkbox0"></label><strong>Initial Setup (Week 1-2)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1">Configure Next.js 14 with App Router</label></li>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2">Install and configure Tailwind CSS + shadcn/ui</label></li>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3">Configure strict TypeScript</label></li>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4">Setup ESLint + Prettier</label></li>
<li><input type="checkbox" id="checkbox5"><label for="checkbox5">Configure Feature-Slice directory structure</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox6"><label for="checkbox6"></label><strong>Authentication and Base UI (Week 3-4)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7">Implement Auth.js with Supabase</label></li>
<li><input type="checkbox" id="checkbox8"><label for="checkbox8">Create login/registration components</label></li>
<li><input type="checkbox" id="checkbox9"><label for="checkbox9">Implement main layout with sidebar</label></li>
<li><input type="checkbox" id="checkbox10"><label for="checkbox10">Create navigation system</label></li>
<li><input type="checkbox" id="checkbox11"><label for="checkbox11">Implement light/dark theme</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox12"><label for="checkbox12"></label><strong>State Management (Week 5-6)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox13"><label for="checkbox13">Configure Zustand for global state (UI, modals, notifications)</label></li>
<li><input type="checkbox" id="checkbox14"><label for="checkbox14">Implement React Query for server state</label></li>
<li><input type="checkbox" id="checkbox15"><label for="checkbox15">Create stores for auth, workouts, social</label></li>
<li><input type="checkbox" id="checkbox16"><label for="checkbox16">Implement state persistence</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox17"><label for="checkbox17"></label><strong>Core Features (Week 7-10)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox18"><label for="checkbox18">Main dashboard with metrics</label></li>
<li><input type="checkbox" id="checkbox19"><label for="checkbox19">Workout CRUD (create, edit, delete)</label></li>
<li><input type="checkbox" id="checkbox20"><label for="checkbox20">Weekly/monthly calendar view</label></li>
<li><input type="checkbox" id="checkbox21"><label for="checkbox21">Calorie tracker with food search</label></li>
<li><input type="checkbox" id="checkbox22"><label for="checkbox22">Editable user profile</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox23"><label for="checkbox23"></label><strong>Social Features (Weeks 11-12)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox24"><label for="checkbox24">Post feed</label></li>
<li><input type="checkbox" id="checkbox25"><label for="checkbox25">Likes and comments system</label></li>
<li><input type="checkbox" id="checkbox26"><label for="checkbox26">User following</label></li>
<li><input type="checkbox" id="checkbox27"><label for="checkbox27">Real-time notifications</label></li>
<li><input type="checkbox" id="checkbox28"><label for="checkbox28">Content moderation</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox29"><label for="checkbox29"></label><strong>AI Integration (Weeks 13-14)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox30"><label for="checkbox30">Chat interface with AI</label></li>
<li><input type="checkbox" id="checkbox31"><label for="checkbox31">Recommendations component</label></li>
<li><input type="checkbox" id="checkbox32"><label for="checkbox32">Integration with Dify AI</label></li>
<li><input type="checkbox" id="checkbox33"><label for="checkbox33">Conversation history</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox34"><label for="checkbox34"></label><strong>Testing &amp; Optimization (Weeks 15-16)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox35"><label for="checkbox35">Unit tests with Jest + RTL</label></li>
<li><input type="checkbox" id="checkbox36"><label for="checkbox36">E2E tests with Cypress</label></li>
<li><input type="checkbox" id="checkbox37"><label for="checkbox37">Performance optimization</label></li>
<li><input type="checkbox" id="checkbox38"><label for="checkbox38">Accessibility (WCAG AA)</label></li>
<li><input type="checkbox" id="checkbox39"><label for="checkbox39">Responsive design</label></li>
</ul>
</li>
</ul>
<h3 id="%E2%9A%99%EF%B8%8F-backend-developer">âš™ï¸ Backend Developer</h3>
<ul>
<li>
<p><input type="checkbox" id="checkbox40"><label for="checkbox40"></label><strong>Initial Setup (Weeks 1-2)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox41"><label for="checkbox41">Configure Hono + TypeScript</label></li>
<li><input type="checkbox" id="checkbox42"><label for="checkbox42">Supabase client setup</label></li>
<li><input type="checkbox" id="checkbox43"><label for="checkbox43">Configure module structure</label></li>
<li><input type="checkbox" id="checkbox44"><label for="checkbox44">Setup validation with Zod</label></li>
<li><input type="checkbox" id="checkbox45"><label for="checkbox45">Configure logging and error handling</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox46"><label for="checkbox46"></label><strong>Authentication &amp; Security (Weeks 3-4)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox47"><label for="checkbox47">Implement auth middleware</label></li>
<li><input type="checkbox" id="checkbox48"><label for="checkbox48">Configure rate limiting</label></li>
<li><input type="checkbox" id="checkbox49"><label for="checkbox49">Input validation</label></li>
<li><input type="checkbox" id="checkbox50"><label for="checkbox50">Configure CORS and security headers</label></li>
<li><input type="checkbox" id="checkbox51"><label for="checkbox51">Setup JWT tokens</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox52"><label for="checkbox52"></label><strong>Core APIs (Weeks 5-8)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox53"><label for="checkbox53">CRUD for users and profiles</label></li>
<li><input type="checkbox" id="checkbox54"><label for="checkbox54">CRUD for workouts and logs</label></li>
<li><input type="checkbox" id="checkbox55"><label for="checkbox55">Nutrition and calorie tracking APIs</label></li>
<li><input type="checkbox" id="checkbox56"><label for="checkbox56">Calendar and schedule APIs</label></li>
<li><input type="checkbox" id="checkbox57"><label for="checkbox57">Implement pagination and filters</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox58"><label for="checkbox58"></label><strong>Social APIs (Weeks 9-10)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox59"><label for="checkbox59">CRUD for posts and comments</label></li>
<li><input type="checkbox" id="checkbox60"><label for="checkbox60">Likes and follows system</label></li>
<li><input type="checkbox" id="checkbox61"><label for="checkbox61">Feed with relevance algorithms</label></li>
<li><input type="checkbox" id="checkbox62"><label for="checkbox62">Push notifications</label></li>
<li><input type="checkbox" id="checkbox63"><label for="checkbox63">Moderation and reports</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox64"><label for="checkbox64"></label><strong>AI Integration (Weeks 11-12)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox65"><label for="checkbox65">Dify AI client</label></li>
<li><input type="checkbox" id="checkbox66"><label for="checkbox66">Context builder</label></li>
<li><input type="checkbox" id="checkbox67"><label for="checkbox67">Chat and recommendations APIs</label></li>
<li><input type="checkbox" id="checkbox68"><label for="checkbox68">AI response cache</label></li>
<li><input type="checkbox" id="checkbox69"><label for="checkbox69">AI usage metrics</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox70"><label for="checkbox70"></label><strong>Performance &amp; Scalability (Weeks 13-14)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox71"><label for="checkbox71">Implement Redis cache (optional)</label></li>
<li><input type="checkbox" id="checkbox72"><label for="checkbox72">Optimize database queries</label></li>
<li><input type="checkbox" id="checkbox73"><label for="checkbox73">Implement WebSockets for real-time</label></li>
<li><input type="checkbox" id="checkbox74"><label for="checkbox74">Configure load balancing</label></li>
<li><input type="checkbox" id="checkbox75"><label for="checkbox75">Implement circuit breakers</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox76"><label for="checkbox76"></label><strong>Testing &amp; Documentation (Weeks 15-16)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox77"><label for="checkbox77">Unit tests with Jest</label></li>
<li><input type="checkbox" id="checkbox78"><label for="checkbox78">Integration tests</label></li>
<li><input type="checkbox" id="checkbox79"><label for="checkbox79">OpenAPI documentation</label></li>
<li><input type="checkbox" id="checkbox80"><label for="checkbox80">Health checks and monitoring</label></li>
<li><input type="checkbox" id="checkbox81"><label for="checkbox81">Performance testing</label></li>
</ul>
</li>
</ul>
<h3 id="%F0%9F%9A%80-devopssre-engineer">ğŸš€ DevOps/SRE Engineer</h3>
<ul>
<li>
<p><input type="checkbox" id="checkbox82"><label for="checkbox82"></label><strong>Base Infrastructure (Weeks 1-4)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox83"><label for="checkbox83">Kubernetes setup (kind/minikube)</label></li>
<li><input type="checkbox" id="checkbox84"><label for="checkbox84">ArgoCD setup for GitOps</label></li>
<li><input type="checkbox" id="checkbox85"><label for="checkbox85">GitHub Container Registry setup</label></li>
<li><input type="checkbox" id="checkbox86"><label for="checkbox86">Namespace and RBAC configuration</label></li>
<li><input type="checkbox" id="checkbox87"><label for="checkbox87">Secrets management setup</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox88"><label for="checkbox88"></label><strong>CI/CD Pipeline (Weeks 5-8)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox89"><label for="checkbox89">GitHub Actions for CI</label></li>
<li><input type="checkbox" id="checkbox90"><label for="checkbox90">Docker multi-stage builds</label></li>
<li><input type="checkbox" id="checkbox91"><label for="checkbox91">Automated pipeline testing</label></li>
<li><input type="checkbox" id="checkbox92"><label for="checkbox92">Security scanning with Snyk</label></li>
<li><input type="checkbox" id="checkbox93"><label for="checkbox93">Automated deployments</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox94"><label for="checkbox94"></label><strong>Monitoring &amp; Observability (Weeks 9-12)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox95"><label for="checkbox95">Prometheus + Grafana setup</label></li>
<li><input type="checkbox" id="checkbox96"><label for="checkbox96">Loki + Promtail configuration</label></li>
<li><input type="checkbox" id="checkbox97"><label for="checkbox97">Business metrics dashboards</label></li>
<li><input type="checkbox" id="checkbox98"><label for="checkbox98">Alerts and notifications</label></li>
<li><input type="checkbox" id="checkbox99"><label for="checkbox99">Distributed tracing (optional)</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox100"><label for="checkbox100"></label><strong>Security &amp; Compliance (Weeks 13-14)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox101"><label for="checkbox101">TLS/HTTPS with cert-manager</label></li>
<li><input type="checkbox" id="checkbox102"><label for="checkbox102">Network policies</label></li>
<li><input type="checkbox" id="checkbox103"><label for="checkbox103">Security scanning</label></li>
<li><input type="checkbox" id="checkbox104"><label for="checkbox104">Backup and disaster recovery</label></li>
<li><input type="checkbox" id="checkbox105"><label for="checkbox105">Compliance checks</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox106"><label for="checkbox106"></label><strong>Scalability &amp; Performance (Weeks 15-16)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox107"><label for="checkbox107">Auto-scaling configuration</label></li>
<li><input type="checkbox" id="checkbox108"><label for="checkbox108">Load testing</label></li>
<li><input type="checkbox" id="checkbox109"><label for="checkbox109">Database optimization</label></li>
<li><input type="checkbox" id="checkbox110"><label for="checkbox110">CDN setup (optional)</label></li>
<li><input type="checkbox" id="checkbox111"><label for="checkbox111">Performance monitoring</label></li>
</ul>
</li>
</ul>
<h3 id="%F0%9F%A4%96-aiintegrations-developer">ğŸ¤– AI/Integrations Developer</h3>
<ul>
<li>
<p><input type="checkbox" id="checkbox112"><label for="checkbox112"></label><strong>AI Platform Setup (Weeks 1-2)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox113"><label for="checkbox113">Setup Dify AI platform</label></li>
<li><input type="checkbox" id="checkbox114"><label for="checkbox114">Setup API keys and configs</label></li>
<li><input type="checkbox" id="checkbox115"><label for="checkbox115">Create basic workflows</label></li>
<li><input type="checkbox" id="checkbox116"><label for="checkbox116">Configure AI models</label></li>
<li><input type="checkbox" id="checkbox117"><label for="checkbox117">Setup context management</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox118"><label for="checkbox118"></label><strong>Chatbot Implementation (Weeks 3-6)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox119"><label for="checkbox119">Design fitness prompts</label></li>
<li><input type="checkbox" id="checkbox120"><label for="checkbox120">Implement context builder</label></li>
<li><input type="checkbox" id="checkbox121"><label for="checkbox121">Create conversation flows</label></li>
<li><input type="checkbox" id="checkbox122"><label for="checkbox122">Integrate with backend APIs</label></li>
<li><input type="checkbox" id="checkbox123"><label for="checkbox123">Implement session management</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox124"><label for="checkbox124"></label><strong>Recommendation Engine (Weeks 7-10)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox125"><label for="checkbox125">Design recommendation algorithms</label></li>
<li><input type="checkbox" id="checkbox126"><label for="checkbox126">Implement feature engineering</label></li>
<li><input type="checkbox" id="checkbox127"><label for="checkbox127">Create hybrid models</label></li>
<li><input type="checkbox" id="checkbox128"><label for="checkbox128">Integrate with user data</label></li>
<li><input type="checkbox" id="checkbox129"><label for="checkbox129">Implement feedback loop</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox130"><label for="checkbox130"></label><strong>n8n Workflows (Weeks 11-12)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox131"><label for="checkbox131">Telegram chatbot (optional)</label></li>
<li><input type="checkbox" id="checkbox132"><label for="checkbox132">Automatic reminders</label></li>
<li><input type="checkbox" id="checkbox133"><label for="checkbox133">Content moderation</label></li>
<li><input type="checkbox" id="checkbox134"><label for="checkbox134">Generate AI plans</label></li>
<li><input type="checkbox" id="checkbox135"><label for="checkbox135">Calorie tracking notifications</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox136"><label for="checkbox136"></label><strong>Testing &amp; Optimization (Weeks 13-14)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox137"><label for="checkbox137">Prompt tests</label></li>
<li><input type="checkbox" id="checkbox138"><label for="checkbox138">Recommendation A/B testing</label></li>
<li><input type="checkbox" id="checkbox139"><label for="checkbox139">Satisfaction metrics</label></li>
<li><input type="checkbox" id="checkbox140"><label for="checkbox140">Cost optimization</label></li>
<li><input type="checkbox" id="checkbox141"><label for="checkbox141">Performance tuning</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox142"><label for="checkbox142"></label><strong>Production Ready (Weeks 15-16)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox143"><label for="checkbox143">AI monitoring</label></li>
<li><input type="checkbox" id="checkbox144"><label for="checkbox144">Robust error handling</label></li>
<li><input type="checkbox" id="checkbox145"><label for="checkbox145">AI rate limiting</label></li>
<li><input type="checkbox" id="checkbox146"><label for="checkbox146">Response cache</label></li>
<li><input type="checkbox" id="checkbox147"><label for="checkbox147">Full documentation</label></li>
</ul>
</li>
</ul>
<h3 id="%F0%9F%93%8B-productqa-engineer">ğŸ“‹ Product/QA Engineer</h3>
<ul>
<li>
<p><input type="checkbox" id="checkbox148"><label for="checkbox148"></label><strong>Analysis &amp; Planning (Weeks 1-2)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox149"><label for="checkbox149">Detailed requirements analysis</label></li>
<li><input type="checkbox" id="checkbox150"><label for="checkbox150">User stories and acceptance criteria</label></li>
<li><input type="checkbox" id="checkbox151"><label for="checkbox151">Complete test planning</label></li>
<li><input type="checkbox" id="checkbox152"><label for="checkbox152">Define KPIs and metrics</label></li>
<li><input type="checkbox" id="checkbox153"><label for="checkbox153">QA tooling setup</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox154"><label for="checkbox154"></label><strong>Testing Strategy (Weeks 3-6)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox155"><label for="checkbox155">Unit test plan</label></li>
<li><input type="checkbox" id="checkbox156"><label for="checkbox156">Integration test plan</label></li>
<li><input type="checkbox" id="checkbox157"><label for="checkbox157">E2E test plan</label></li>
<li><input type="checkbox" id="checkbox158"><label for="checkbox158">Testing environment setup</label></li>
<li><input type="checkbox" id="checkbox159"><label for="checkbox159">Automated testing</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox160"><label for="checkbox160"></label><strong>Quality Assurance (Weeks 7-12)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox161"><label for="checkbox161">Core feature testing</label></li>
<li><input type="checkbox" id="checkbox162"><label for="checkbox162">Social features testing</label></li>
<li><input type="checkbox" id="checkbox163"><label for="checkbox163">AI integration testing</label></li>
<li><input type="checkbox" id="checkbox164"><label for="checkbox164">Performance testing</label></li>
<li><input type="checkbox" id="checkbox165"><label for="checkbox165">Security testing</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox166"><label for="checkbox166"></label><strong>User Experience (Weeks 13-14)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox167"><label for="checkbox167">Usability testing</label></li>
<li><input type="checkbox" id="checkbox168"><label for="checkbox168">Accessibility testing</label></li>
<li><input type="checkbox" id="checkbox169"><label for="checkbox169">Responsive design testing</label></li>
<li><input type="checkbox" id="checkbox170"><label for="checkbox170">User feedback collection</label></li>
<li><input type="checkbox" id="checkbox171"><label for="checkbox171">UX improvements</label></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="checkbox172"><label for="checkbox172"></label><strong>Documentation &amp; Release (Weeks 15-16)</strong></p>
<ul>
<li><input type="checkbox" id="checkbox173"><label for="checkbox173">User documentation</label></li>
<li><input type="checkbox" id="checkbox174"><label for="checkbox174">Technical documentation</label></li>
<li><input type="checkbox" id="checkbox175"><label for="checkbox175">Release notes</label></li>
<li><input type="checkbox" id="checkbox176"><label for="checkbox176">Training materials</label></li>
<li><input type="checkbox" id="checkbox177"><label for="checkbox177">Final QA and sign-off</label></li>
</ul>
</li>
</ul>
<hr>
<h2 id="%F0%9F%8E%AF-weekly-objectives">ğŸ¯ Weekly Objectives</h2>
<h3 id="week-1-7-13-oct">Week 1 (7-13 Oct)</h3>
<ul>
<li><strong>Frontend</strong>: Setup Next.js + TypeScript</li>
<li><strong>Backend</strong>: Setup Hono + Supabase</li>
<li><strong>DevOps</strong>: Local Kubernetes setup</li>
<li><strong>AI</strong>: Dify AI platform setup</li>
<li><strong>QA</strong>: Requirements analysis</li>
</ul>
<h3 id="week-2-14-20-oct">Week 2 (14-20 Oct)</h3>
<ul>
<li><strong>Frontend</strong>: Base UI components</li>
<li><strong>Backend</strong>: Auth middleware</li>
<li><strong>DevOps</strong>: ArgoCD setup</li>
<li><strong>AI</strong>: Basic workflows</li>
<li><strong>QA</strong>: Test planning</li>
</ul>
<h3 id="week-3-21-27-oct">Week 3 (21-27 Oct)</h3>
<ul>
<li><strong>Frontend</strong>: Complete Auth UI</li>
<li><strong>Backend</strong>: Basic core APIs</li>
<li><strong>DevOps</strong>: CI/CD pipeline</li>
<li><strong>AI</strong>: Basic chatbot</li>
<li><strong>QA</strong>: Testing environments</li>
</ul>
<h3 id="week-4-28-oct---3-nov">Week 4 (28 Oct - 3 Nov)</h3>
<ul>
<li><strong>Frontend</strong>: Main dashboard</li>
<li><strong>Backend</strong>: Full CRUD</li>
<li><strong>DevOps</strong>: Monitoring setup</li>
<li><strong>AI</strong>: Recommendation engine</li>
<li><strong>QA</strong>: Automated tests</li>
</ul>
<hr>

</body>
</html>
