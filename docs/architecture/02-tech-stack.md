# 2. Stack Tecnol√≥gico Propuesto üíª

## Mejoras y Correcciones Implementadas

### Correcciones a la Documentaci√≥n Actual

1. **Inconsistencia en Stack Tecnol√≥gico**: Los documentos mencionan tanto casino/blockchain como fitness. Nos enfocamos exclusivamente en GymPal fitness.

2. **Complejidad Innecesaria Inicial**: 
   - Kafka puede ser reemplazado por Redis Pub/Sub inicialmente
   - Service mesh (Istio) es overkill para el MVP
   - Kubernetes puede diferirse hasta fase de producci√≥n

3. **Falta de Especificaciones**:
   - No hay esquema detallado de base de datos ejecutable
   - Faltan migraciones iniciales de Supabase
   - No hay ejemplos concretos de implementaci√≥n de servicios

4. **Mejoras Recomendadas**:
   - Estructura de backend modular y escalable
   - Implementar tipos compartidos para reutilizaci√≥n
   - Definir contratos de API con Zod para validaci√≥n runtime
   - Configurar testing desde d√≠a 1
   - Implementar observabilidad b√°sica (logging estructurado)

## Decisi√≥n Final

| Capa | Tecnolog√≠a | Justificaci√≥n |
|------|------------|---------------|
| **Frontend** | Next.js 14 (App Router) + Zustand | SSR, SEO, File-based routing |
| **UI Components** | shadcn/ui + Tailwind | Moderno, accesible, customizable |
| **Backend** | Hono + TypeScript | 10x m√°s r√°pido que Express, TS-first |
| **Database** | Supabase (Postgres) | BaaS completo, Auth integrado |
| **Auth** | Supabase Auth (OAuth2) | OAuth2/OIDC out-of-the-box |
| **Storage** | Supabase Storage | S3-compatible, integrado con Auth |
| **AI Platform** | Dify AI | Orchestraci√≥n LLM, prompts management |
| **Containerization** | Docker | Standard de facto |
| **Orchestration** | Kubernetes (kind local) | Requisito acad√©mico |
| **GitOps** | ArgoCD | Declarative deployments |
| **Monitoring** | Prometheus + Grafana | Metrics y dashboards |
| **Logs** | Loki + Promtail | Agregaci√≥n de logs |
| **Package Manager** | npm/yarn | Gesti√≥n de dependencias |
| **Testing** | Vitest + Supertest | Testing moderno y r√°pido |
| **Validation** | Zod | Validaci√≥n runtime type-safe |

## Frontend

- **Next.js 14** (App Router) + **TypeScript**.
- **Tailwind CSS** + **shadcn/ui** para UI moderna y accesible.
- **Auth** con OAuth2/OIDC v√≠a Supabase Auth o Auth.js.
- **Estado**: React Query/Server Actions, Zustand donde convenga.
- **SSR/ISR** para SEO y rendimiento.

## Backend

- **Node.js + TypeScript** con **Hono** para APIs REST y WebSocket.
- **Supabase** (PostgreSQL, Auth, Storage, Realtime) como backend acelerador.
- **n8n** para orquestaci√≥n de flujos (chatbots en Telegram/WhatsApp, emails, cron).
- **Dify AI** para recomendador y flujos de IA; integraci√≥n v√≠a API.
- **Proton Mail** (o SMTP compatible) para emails.

## Arquitectura Backend Simplificada

### Estructura del Proyecto Backend

```
backend/
‚îú‚îÄ‚îÄ config/           # Configuraci√≥n de variables de entorno
‚îÇ   ‚îî‚îÄ‚îÄ env.ts        # Validaci√≥n de variables con Zod
‚îú‚îÄ‚îÄ doc/             # Esquemas de documentaci√≥n API
‚îÇ   ‚îî‚îÄ‚îÄ schemas.ts    # Esquemas Zod para validaci√≥n
‚îú‚îÄ‚îÄ lib/             # Librer√≠as compartidas
‚îÇ   ‚îú‚îÄ‚îÄ db.ts        # Cliente Supabase con helpers
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts      # Utilidades de autenticaci√≥n JWT
‚îÇ   ‚îú‚îÄ‚îÄ mailer.ts    # Servicio de email con Nodemailer
‚îÇ   ‚îî‚îÄ‚îÄ types.ts     # Tipos de base de datos
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/      # üéØ Controladores profesionales (Handlers)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.handler.ts          # Autenticaci√≥n con OpenAPI docs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.handler.ts          # Gesti√≥n de usuarios con validaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workout.handler.ts       # Entrenamientos y ejercicios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social.handler.ts        # Funcionalidades sociales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ personal.handler.ts      # Informaci√≥n personal del usuario
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routines.handler.ts      # Rutinas personalizadas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ posts.handler.ts         # Posts sociales avanzados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.handler.ts     # Analytics y estad√≠sticas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.handler.ts      # Configuraci√≥n de usuario
‚îÇ   ‚îú‚îÄ‚îÄ modules/     # üì¶ M√≥dulos de funcionalidad (Servicios)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/    # M√≥dulo de autenticaci√≥n completo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts    # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.types.ts      # Tipos espec√≠ficos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.ts # Middleware espec√≠fico
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/   # M√≥dulo de usuarios completo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.service.ts    # L√≥gica de usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.types.ts      # Tipos de usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.middleware.ts # Validaci√≥n de usuarios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workouts/ # M√≥dulo de entrenamientos completo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workout.service.ts    # L√≥gica de workouts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workout.types.ts      # Tipos de workouts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workout.middleware.ts # Validaci√≥n de workouts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social/   # M√≥dulo social completo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social.service.ts    # L√≥gica social
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social.types.ts      # Tipos sociales
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ social.middleware.ts # Validaci√≥n social
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai/       # M√≥dulo de IA (pendiente)
‚îÇ   ‚îú‚îÄ‚îÄ shared/      # üîß Utilidades compartidas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/ # Middlewares globales
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error.middleware.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate-limit.middleware.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.middleware.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/   # Utilidades comunes
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ helpers.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ constants.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ response.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts     # üöÄ Punto de entrada optimizado
‚îú‚îÄ‚îÄ supabase/        # Configuraci√≥n de Supabase
‚îÇ   ‚îú‚îÄ‚îÄ migrations/  # Migraciones de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ config.toml  # Configuraci√≥n de Supabase
‚îÇ   ‚îî‚îÄ‚îÄ seed.sql     # Datos de prueba
‚îú‚îÄ‚îÄ tests/           # Tests del proyecto
‚îú‚îÄ‚îÄ docs/            # Documentaci√≥n del proyecto
‚îÇ   ‚îú‚îÄ‚îÄ README.md              # Documentaci√≥n de la API
‚îÇ   ‚îî‚îÄ‚îÄ OPENAPI_DOCUMENTATION.md # Resumen de documentaci√≥n OpenAPI
‚îú‚îÄ‚îÄ scripts/         # Scripts de utilidad
‚îÇ   ‚îú‚îÄ‚îÄ generate-openapi.js          # Generaci√≥n OpenAPI b√°sica
‚îÇ   ‚îî‚îÄ‚îÄ generate-complete-openapi-v2.js # Generaci√≥n OpenAPI completa
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ vitest.config.ts
‚îú‚îÄ‚îÄ openapi.json     # Especificaci√≥n OpenAPI 3.1 
‚îú‚îÄ‚îÄ env.example      # Variables de entorno de ejemplo
‚îî‚îÄ‚îÄ Dockerfile
```

### Configuraci√≥n Base

- **Runtime**: Node.js 20 LTS
- **Framework**: Hono (ligero y r√°pido)
- **TypeScript**: 5.3+ con strict mode
- **ES Modules**: Configuraci√≥n moderna con `"type": "module"`
- **OpenAPI 3.1**: Documentaci√≥n autom√°tica con Scalar
- **Validaci√≥n**: Zod para validaci√≥n robusta de datos

### Mejoras Implementadas Recientemente

**üèóÔ∏è Arquitectura Profesional:**
- **Separaci√≥n clara**: Controladores (routes) vs Servicios (modules)
- **Handlers profesionales**: Documentaci√≥n OpenAPI integrada
- **Servicios modulares**: L√≥gica de negocio encapsulada
- **Middleware especializado**: Validaci√≥n por m√≥dulo
- **Tipos TypeScript**: Completos y consistentes

**üìä Funcionalidades Avanzadas:**
- **Informaci√≥n personal detallada** (edad, peso, altura, BMI, grasa corporal)
- **Objetivos de fitness** (nivel de experiencia, metas, frecuencia)
- **Preferencias diet√©ticas** (restricciones, alergias, objetivos nutricionales)
- **Rutinas personalizadas** (creaci√≥n, b√∫squeda, compartici√≥n)
- **Posts sociales avanzados** (tipos, hashtags, trending, b√∫squeda)
- **Dashboard anal√≠tico** (estad√≠sticas, actividad reciente)
- **Configuraci√≥n de usuario** (notificaciones, privacidad, preferencias)

**üîß Herramientas de Desarrollo:**
- **Supabase CLI**: Migraciones y tipos generados autom√°ticamente
- **Vitest**: Testing completo con cobertura
- **ESLint + Prettier**: Linting y formateo autom√°tico
- **Scripts OpenAPI**: Generaci√≥n autom√°tica de documentaci√≥n
- **Documentaci√≥n Interactiva**: Scalar API Reference integrada

## Diagrama de Arquitectura Tecnol√≥gica

```mermaid
graph TB
  subgraph "Frontend Layer"
    NEXT[Next.js 14 App Router]
    TAILWIND[Tailwind CSS + shadcn/ui]
    ZUSTAND[Zustand State Management]
    REACT_QUERY[React Query]
  end
  
  subgraph "Backend Layer"
    HONO[Hono Framework]
    TYPESCRIPT[TypeScript 5.3+]
    ZOD[Zod Validation]
    VITEST[Vitest Testing]
  end
  
  subgraph "Database Layer"
    SUPABASE[Supabase PostgreSQL]
    RLS[Row Level Security]
    MIGRATIONS[Database Migrations]
  end
  
  subgraph "AI & External Services"
    DIFY[Dify AI Platform]
    N8N[n8n Workflow Engine]
    PROTON[Proton Mail]
  end
  
  subgraph "Infrastructure"
    DOCKER[Docker Containers]
    K8S[Kubernetes]
    ARGOCD[ArgoCD GitOps]
  end
  
  subgraph "Monitoring"
    PROMETHEUS[Prometheus]
    GRAFANA[Grafana]
    LOKI[Loki + Promtail]
  end
  
  NEXT --> HONO
  TAILWIND --> NEXT
  ZUSTAND --> NEXT
  REACT_QUERY --> NEXT
  
  HONO --> SUPABASE
  HONO --> DIFY
  HONO --> N8N
  HONO --> PROTON
  
  SUPABASE --> RLS
  SUPABASE --> MIGRATIONS
  
  HONO --> DOCKER
  DOCKER --> K8S
  K8S --> ARGOCD
  
  HONO --> PROMETHEUS
  PROMETHEUS --> GRAFANA
  HONO --> LOKI
```

## Comparaci√≥n de Tecnolog√≠as

### Framework Backend: Hono vs Express

```mermaid
graph LR
  subgraph "Hono Advantages"
    H1[10x m√°s r√°pido]
    H2[TypeScript-first]
    H3[OpenAPI integrado]
    H4[Middleware moderno]
    H5[WebSocket nativo]
  end
  
  subgraph "Express Advantages"
    E1[Ecosistema maduro]
    E2[Documentaci√≥n extensa]
    E3[Comunidad grande]
    E4[Plugins abundantes]
  end
  
  H1 --> DECISION[Decisi√≥n: Hono]
  H2 --> DECISION
  H3 --> DECISION
  H4 --> DECISION
  H5 --> DECISION
```

### Base de Datos: Supabase vs Prisma + PostgreSQL

```mermaid
graph TB
  subgraph "Supabase Benefits"
    S1[Auth integrado]
    S2[Real-time subscriptions]
    S3[Storage integrado]
    S4[RLS autom√°tico]
    S5[API REST autom√°tica]
    S6[Dashboard admin]
  end
  
  subgraph "Prisma Benefits"
    P1[Type safety completo]
    P2[Query builder potente]
    P3[Migraciones avanzadas]
    P4[Multi-database support]
  end
  
  S1 --> CHOICE[Elegido: Supabase]
  S2 --> CHOICE
  S3 --> CHOICE
  S4 --> CHOICE
  S5 --> CHOICE
  S6 --> CHOICE
```

